<?php





if (! empty($var_0->var_1->var_2))     require_once var_3.'/comm/propal/class/propal.class.php';
if (! empty($var_0->var_4->var_2))    require_once var_3.'/compta/facture/class/facture.class.php';
if (! empty($var_0->var_5->var_2))   require_once var_3.'/commande/class/commande.class.php';
if (! empty($var_0->var_6->var_2)) require_once var_3.'/core/lib/accounting.lib.php';
if (! empty($var_0->var_6->var_2)) require_once var_3.'/core/class/html.formaccounting.class.php';
if (! empty($var_0->var_6->var_2)) require_once var_3.'/accountancy/class/accountingaccount.class.php';

$var_7->load("products");
$var_7->load("other");
if (! empty($var_0->var_9->var_2)) $var_7->load("stocks");
if (! empty($var_0->var_4->var_2)) $var_7->load("bills");
if (! empty($var_0->var_10->var_2)) $var_7->load("productbatch");

$var_11=''; $var_12=0; $var_13=array();

$var_14=0;

$var_15=GETPOST('id', 'int');
$var_16=GETPOST('ref', 'alpha');
$var_17=GETPOST('type','int');
$var_18=(GETPOST('action','alpha') ? GETPOST('action','alpha') : 'view');
$var_19=GETPOST('cancel','alpha');
$var_20=GETPOST('confirm','alpha');
$var_21=GETPOST('socid','int');
$var_22 = GETPOST('duration_value');
$var_23 = GETPOST('duration_unit');
if (! empty($var_24->var_25)) $var_21=$var_24->var_25;

$var_26 = new class_0($var_28);
$var_26->var_17 = $var_17;	
$var_29 = new class_1($var_28);


$var_30=$var_29->fetch_name_optionals_label($var_26->var_32);

if ($var_15 > 0 || ! empty($var_16))
{
    $var_33 = $var_26->fetch($var_15, $var_16);

    if (! empty($var_0->var_35->var_2)) $var_36 = $var_0->var_35->multidir_output[$var_26->entity].'/'.get_exdir(0, 0, 0, 0, $var_26, 'product').dol_sanitizeFileName($var_26->var_16);
    elseif (! empty($var_0->var_37->var_2)) $var_36 = $var_0->var_37->multidir_output[$var_26->entity].'/'.get_exdir(0, 0, 0, 0, $var_26, 'product').dol_sanitizeFileName($var_26->var_16);

    if (! empty($var_0->var_38->var_39))    
    {
        if (! empty($var_0->var_35->var_2)) $var_40 = $var_0->var_35->multidir_output[$var_26->entity].'/'.substr(substr("000".$var_26->var_15, -2),1,1).'/'.substr(substr("000".$var_26->var_15, -2),0,1).'/'.$var_26->var_15."/photos";
        else $var_40 = $var_0->var_37->multidir_output[$var_26->entity].'/'.substr(substr("000".$var_26->var_15, -2),1,1).'/'.substr(substr("000".$var_26->var_15, -2),0,1).'/'.$var_26->var_15."/photos";
    }
}

$var_41='product';


$var_42 = !empty($var_26->var_42)?$var_26->var_42:GETPOST("canvas");
$var_43=null;
if (! empty($var_42))
{
    $var_43 = new class_2($var_28,$var_18);
    $var_43->getCanvas('product','card',$var_42);
}


$var_45 = (! empty($var_15) ? $var_15 : (! empty($var_16) ? $var_16 : ''));
$var_46 = (! empty($var_15) ? 'rowid' : 'ref');
$var_33=restrictedArea($var_24,'produit|service',$var_45,'product&product','','',$var_46,$var_43);


$var_47->initHooks(array('productcard','globalcard'));





if ($var_19) $var_18 = '';

$var_49 = (($var_26->var_17 == var_27::var_50 && $var_24->var_51->var_52->var_53) || ($var_26->var_17 == var_27::var_54 && $var_24->var_51->var_37->var_53));
$var_55 = (($var_26->var_17 == var_27::var_50 && $var_24->var_51->var_52->var_56) || ($var_26->var_17 == var_27::var_54 && $var_24->var_51->var_37->var_56));
$var_57 = (($var_26->var_17 == var_27::var_50 && $var_24->var_51->var_52->var_58) || ($var_26->var_17 == var_27::var_54 && $var_24->var_51->var_37->var_58));
$var_59=empty($var_0->var_60->var_2)?0:1;
if (! empty($var_0->var_38->var_61) && empty($var_24->var_51->var_60->var_62)) $var_59=0;

$var_63=array('id'=>$var_15, 'ref'=>$var_16, 'objcanvas'=>$var_43);
$var_64=$var_47->executeHooks('doActions',$var_63,$var_26,$var_18);    
if ($var_64 < 0) setEventMessages($var_47->var_12, $var_47->var_13, 'errors');

if (empty($var_64))
{
    
	if ($var_18 == 'setfk_product_type' && $var_55)
    {
    	$var_33 = $var_26->setValueFrom('fk_product_type', GETPOST('fk_product_type'), '', null, 'text', '', $var_24, 'PRODUCT_MODIFY');
    	header("Location: ".$_SERVER['PHP_SELF']."?id=".$var_26->var_15);
    	var_67;
    }

    
    $var_36 = $var_0->var_52->var_68;
    $var_69 = $var_55;


    
    if ($var_18 ==	'setfk_barcode_type' && $var_59)
    {
        $var_33 = $var_26->setValueFrom('fk_barcode_type', GETPOST('fk_barcode_type'), '', null, 'text', '', $var_24, 'PRODUCT_MODIFY');
    	header("Location: ".$_SERVER['PHP_SELF']."?id=".$var_26->var_15);
    	var_67;
    }

    
    if ($var_18 ==	'setbarcode' && $var_59)
    {
    	$var_33=$var_26->check_barcode(GETPOST('barcode'),GETPOST('barcode_type_code'));

		if ($var_33 >= 0)
		{
	    	$var_33 = $var_26->setValueFrom('barcode', GETPOST('barcode'));
	    	header("Location: ".$_SERVER['PHP_SELF']."?id=".$var_26->var_15);
	    	var_67;
		}
		else
		{
			$var_7->load("errors");
        	if ($var_33 == -1) $var_13[] = 'ErrorBadBarCodeSyntax';
        	else if ($var_33 == -2) $var_13[] = 'ErrorBarCodeRequired';
        	else if ($var_33 == -3) $var_13[] = 'ErrorBarCodeAlreadyUsed';
        	else $var_13[] = 'FailedToValidateBarCode';

			$var_12++;
			setEventMessages($var_13, null, 'errors');
		}
    }

    
    if ($var_18 == 'add' && $var_55)
    {
        $var_12=0;

        if (! GETPOST('label'))
        {
            setEventMessages($var_7->trans('ErrorFieldRequired',$var_7->transnoentities('Label')), null, 'errors');
            $var_18 = "create";
            $var_12++;
        }
        if (empty($var_16))
        {
            setEventMessages($var_7->trans('ErrorFieldRequired',$var_7->transnoentities('Ref')), null, 'errors');
            $var_18 = "create";
            $var_12++;
        }
        if (! empty($var_22) && empty($var_23))
        {
            setEventMessages($var_7->trans('ErrorFieldRequired',$var_7->transnoentities('Unit')), null, 'errors');
            $var_18 = "create";
            $var_12++;
        }

        if (! $var_12)
        {
	        $var_73 = GETPOST('units', 'int');

            $var_26->var_16                   = $var_16;
            $var_26->var_74                 = GETPOST('label');
            $var_26->var_75       = GETPOST('price_base_type');

            if ($var_26->var_75 == 'TTC')
            	$var_26->var_76 = GETPOST('price');
            else
            	$var_26->var_77 = GETPOST('price');
            if ($var_26->var_75 == 'TTC')
            	$var_26->var_78 = GETPOST('price_min');
            else
            	$var_26->var_79 = GETPOST('price_min');

	        $var_80 = GETPOST('tva_tx', 'alpha');           

	        
	        $var_81 = '';
	        $var_82 = preg_replace('/[^0-9\.].*$/', '', $var_80);     
	        $var_83 = preg_match('/\*/', $var_80) ? 1 : 0;
	        $var_84 = 0; $var_85 = 0; $var_86 = '0'; $var_87 = '0';
	        
	        if (preg_match('/\((.*)\)/', $var_80, $var_88))
	        {
	            
	            $var_81=$var_88[1];
	            
	            $var_89 = "SELECT t.rowid, t.code, t.recuperableonly, t.localtax1, t.localtax2, t.localtax1_type, t.localtax2_type";
	            $var_89.= " FROM ".var_90."c_tva as t, ".var_90."c_country as c";
	            $var_89.= " WHERE t.fk_pays = c.rowid AND c.code = '".$var_91->var_92."'";
	            $var_89.= " AND t.taux = ".((float) $var_82)." AND t.active = 1";
	            $var_89.= " AND t.code ='".$var_81."'";
	            $var_93=$var_28->query($var_89);
	            if ($var_93)
	            {
	                $var_95 = $var_28->fetch_object($var_93);
	                $var_83 = $var_95->var_97;
	                $var_84 = $var_95->var_84;
	                $var_85 = $var_95->var_85;
	                $var_86 = $var_95->var_86;
	                $var_87 = $var_95->var_87;
	            }
	        }

	        $var_26->var_98 = $var_81;
	        $var_26->var_82 = $var_82;
	        $var_26->var_99 = $var_83;
	        $var_26->var_100 = $var_84;
	        $var_26->var_101 = $var_85;
	        $var_26->var_86 = $var_86;
	        $var_26->var_87 = $var_87;

            $var_26->var_17               	 = $var_17;
            $var_26->var_102             	 = GETPOST('statut');
            $var_26->var_103            = GETPOST('statut_buy');
			$var_26->var_104          	= GETPOST('status_batch');

            $var_26->var_105          = GETPOST('fk_barcode_type');
            $var_26->var_60		           = GETPOST('barcode');
            
            $var_106=new class_3($var_28);
    	    $var_106->var_107='product';
            $var_106->var_105=GETPOST('fk_barcode_type');
            $var_33=$var_106->fetch_barcode();
            if ($var_33 < 0)
            {
            	$var_12++;
            	$var_11='Failed to get bar code type information ';
            	setEventMessages($var_11.$var_106->var_12, $var_11.$var_106->var_13, 'errors');
            }
            $var_26->var_109      = $var_106->var_109;
            $var_26->var_110     = $var_106->var_110;
            $var_26->var_111     = $var_106->var_111;

            $var_26->var_112        	 = dol_htmlcleanlastbr(GETPOST('desc','none'));
            $var_26->var_113					 = GETPOST('url');
            $var_26->var_114          	 = dol_htmlcleanlastbr(GETPOST('note_private','none'));
            $var_26->var_115               	 = $var_26->var_114;   
            $var_26->var_116              = GETPOST('customcode');
            $var_26->var_117              = GETPOST('country_id');
            $var_26->var_22     	 = $var_22;
            $var_26->var_23      	 = $var_23;
            $var_26->var_118 	 = GETPOST('seuil_stock_alerte')?GETPOST('seuil_stock_alerte'):0;
            $var_26->var_119            = GETPOST('desiredstock')?GETPOST('desiredstock'):0;
            $var_26->var_42             	 = GETPOST('canvas');
            $var_26->var_120             	 = GETPOST('weight');
            $var_26->var_121       	 = GETPOST('weight_units');
            $var_26->var_122             	 = GETPOST('size');
            $var_26->var_123       	 = GETPOST('size_units');
            $var_26->var_124               	 = GETPOST('sizewidth');
            $var_26->var_125             	 = GETPOST('sizeheight');
	        $var_26->var_126            	 = GETPOST('surface');
            $var_26->var_127      	 = GETPOST('surface_units');
            $var_26->var_128             	 = GETPOST('volume');
            $var_26->var_129       	 = GETPOST('volume_units');
            $var_26->var_130           	 = GETPOST('finished');
	        $var_26->var_131                 = GETPOST('units');

			$var_132 			 = GETPOST('accountancy_code_sell');
			$var_133	 = GETPOST('accountancy_code_sell_intra');
			$var_134	 = GETPOST('accountancy_code_sell_export');
			$var_135 			 = GETPOST('accountancy_code_buy');

			if ($var_132 <= 0) { $var_26->var_132 = ''; } else { $var_26->var_132 = $var_132; }
			if ($var_133 <= 0) { $var_26->var_133 = ''; } else { $var_26->var_133 = $var_133; }
			if ($var_134 <= 0) { $var_26->var_134 = ''; } else { $var_26->var_134 = $var_134; }
			if ($var_135 <= 0) { $var_26->var_135 = ''; } else { $var_26->var_135 = $var_135; }

            
            if (! empty($var_0->var_38->var_136))
            {
                for($var_137=2;$var_137<=$var_0->var_38->var_138;$var_137++)
                {
                    if (isset($_POST["price_".$var_137]))
                    {
                        $var_26->multiprices["$var_137"] = price2num($_POST["price_".$var_137],'MU');
                        $var_26->multiprices_base_type["$var_137"] = $_POST["multiprices_base_type_".$var_137];
                    }
                    else
                    {
                        $var_26->multiprices["$var_137"] = "";
                    }
                }
            }

            
        	$var_139 = $var_29->setOptionalsFromPost($var_30,$var_26);
			if ($var_139 < 0) $var_12++;

			if (! $var_12)
			{
            	$var_15 = $var_26->create($var_24);
			}

            if ($var_15 > 0)
            {
				
				$var_142 = GETPOST('categories', 'array');
				$var_26->setCategories($var_142);

                header("Location: ".$_SERVER['PHP_SELF']."?id=".$var_15);
                var_67;
            }
            else
			{
            	if (count($var_26->var_13)) setEventMessages($var_26->var_12, $var_26->var_13, 'errors');
				else setEventMessages($var_7->trans($var_26->var_12), null, 'errors');
                $var_18 = "create";
            }
        }
    }

    
    if ($var_18 == 'update' && $var_55)
    {
    	if (GETPOST('cancel','alpha'))
        {
            $var_18 = '';
        }
        else
        {
            if ($var_26->var_15 > 0)
            {
				$var_26->var_144= clone $var_26;

                $var_26->var_16                    = $var_16;
                $var_26->var_74                  = GETPOST('label');
                $var_26->var_112            = dol_htmlcleanlastbr(GETPOST('desc','none'));
            	$var_26->var_113					= GETPOST('url');
    			if (! empty($var_0->var_38->var_145))
    			{
                	$var_26->var_114           = dol_htmlcleanlastbr(GETPOST('note_private','none'));
                    $var_26->var_115                   = $var_26->var_114;
    			}
                $var_26->var_116             = GETPOST('customcode');
                $var_26->var_117             = GETPOST('country_id');
                $var_26->var_102                 = GETPOST('statut');
                $var_26->var_103             = GETPOST('statut_buy');
                $var_26->var_104	        = GETPOST('status_batch');
                
                
                $var_26->var_22         = GETPOST('duration_value');
                $var_26->var_23          = GETPOST('duration_unit');

                $var_26->var_42                 = GETPOST('canvas');
                $var_26->var_120                 = GETPOST('weight');
                $var_26->var_121           = GETPOST('weight_units');
                $var_26->var_122                 = GETPOST('size');
                $var_26->var_123           = GETPOST('size_units');
                $var_26->var_124               	 = GETPOST('sizewidth');
                $var_26->var_125             	 = GETPOST('sizeheight');

                $var_26->var_126                = GETPOST('surface');
                $var_26->var_127          = GETPOST('surface_units');
                $var_26->var_128                 = GETPOST('volume');
                $var_26->var_129           = GETPOST('volume_units');
                $var_26->var_130               = GETPOST('finished');

	            $var_73 = GETPOST('units', 'int');

	            if ($var_73 > 0) {
		            $var_26->var_131 = $var_73;
	            } else {
		            $var_26->var_131 = null;
	            }

	            $var_26->var_105           = GETPOST('fk_barcode_type');
    	        $var_26->var_60		        = GETPOST('barcode');
    	        
    	        $var_106=new class_3($var_28);
    	        $var_106->var_107='product';
    	        $var_106->var_105=GETPOST('fk_barcode_type');
    	        $var_33=$var_106->fetch_barcode();
    	        if ($var_33 < 0)
    	        {
    	        	$var_12++;
    	        	$var_11='Failed to get bar code type information ';
            		setEventMessages($var_11.$var_106->var_12, $var_11.$var_106->var_13, 'errors');
    	        }
    	        $var_26->var_109      = $var_106->var_109;
    	        $var_26->var_110     = $var_106->var_110;
    	        $var_26->var_111     = $var_106->var_111;

				$var_132 			 = GETPOST('accountancy_code_sell');
				$var_133	 = GETPOST('accountancy_code_sell_intra');
				$var_134	 = GETPOST('accountancy_code_sell_export');
				$var_135 			 = GETPOST('accountancy_code_buy');

				if ($var_132 <= 0) { $var_26->var_132 = ''; } else { $var_26->var_132 = $var_132; }
				if ($var_133 <= 0) { $var_26->var_133 = ''; } else { $var_26->var_133 = $var_133; }
				if ($var_134 <= 0) { $var_26->var_134 = ''; } else { $var_26->var_134 = $var_134; }
				if ($var_135 <= 0) { $var_26->var_135 = ''; } else { $var_26->var_135 = $var_135; }

                
        		$var_139 = $var_29->setOptionalsFromPost($var_30,$var_26);
				if ($var_139 < 0) $var_12++;

                if (! $var_12 && $var_26->check())
                {
                    if ($var_26->update($var_26->var_15, $var_24) > 0)
                    {
						
						$var_142 = GETPOST('categories', 'array');
						$var_26->setCategories($var_142);

                        $var_18 = 'view';
                    }
                    else
					{
						if (count($var_26->var_13)) setEventMessages($var_26->var_12, $var_26->var_13, 'errors');
                    	else setEventMessages($var_7->trans($var_26->var_12), null, 'errors');
                        $var_18 = 'edit';
                    }
                }
                else
				{
					if (count($var_26->var_13)) setEventMessages($var_26->var_12, $var_26->var_13, 'errors');
                	else setEventMessages($var_7->trans("ErrorProductBadRefOrLabel"), null, 'errors');
                    $var_18 = 'edit';
                }
            }

        }
    }

    
    if ($var_18 == 'confirm_clone' && $var_20 != 'yes') { $var_18=''; }
    if ($var_18 == 'confirm_clone' && $var_20 == 'yes' && $var_55)
    {
        if (! GETPOST('clone_content') && ! GETPOST('clone_prices') )
        {
        	setEventMessages($var_7->trans("NoCloneOptionsSpecified"), null, 'errors');
        }
        else
        {
            $var_28->begin();

            $var_149 = $var_15;
            if ($var_26->var_15 > 0)
            {
                $var_26->var_16 = GETPOST('clone_ref');
                $var_26->var_102 = 0;
                $var_26->var_103 = 0;
                $var_26->var_15 = null;
                $var_26->var_60 = -1;

                if ($var_26->check())
                {
                    $var_15 = $var_26->create($var_24);
                    if ($var_15 > 0)
                    {
                        if (GETPOST('clone_composition'))
                        {
                            $var_33 = $var_26->clone_associations($var_149, $var_15);

                            if ($var_33 < 1)
                            {
                                $var_28->rollback();
                                setEventMessages($var_7->trans('ErrorProductClone'), null, 'errors');
                                header("Location: ".$_SERVER["PHP_SELF"]."?id=".$var_149);
                                var_67;
                            }
                        }

                        

                        $var_28->commit();
                        $var_28->close();

                        header("Location: ".$_SERVER["PHP_SELF"]."?id=".$var_15);
                        var_67;
                    }
                    else
                    {
                        $var_15=$var_149;

                        if ($var_26->var_12 == 'ErrorProductAlreadyExists')
                        {
                            $var_28->rollback();

                            $var_14++;
                            $var_18 = "";

                            $var_11=$var_7->trans("ErrorProductAlreadyExists",$var_26->var_16);
                            $var_11.=' <a href="'.$_SERVER["PHP_SELF"].'?ref='.$var_26->var_16.'">'.$var_7->trans("ShowCardHere").'</a>.';
                            setEventMessages($var_11, null, 'errors');
                            $var_26->fetch($var_15);
                        }
                        else
                     {
                            $var_28->rollback();
                            if (count($var_26->var_13))
                            {
                            	setEventMessages($var_26->var_12, $var_26->var_13, 'errors');
                            	dol_print_error($var_28,$var_26->var_13);
                            }
                            else
                            {
                            	setEventMessages($var_7->trans($var_26->var_12), null, 'errors');
                            	dol_print_error($var_28,$var_26->var_12);
                            }
                        }
                    }
                }
            }
            else
            {
                $var_28->rollback();
                dol_print_error($var_28,$var_26->var_12);
            }
        }
    }

    
    if ($var_18 == 'confirm_delete' && $var_20 != 'yes') { $var_18=''; }
    if ($var_18 == 'confirm_delete' && $var_20 == 'yes' && $var_57)
	{
		$var_33 = $var_26->delete($var_24);

        if ($var_33 > 0)
        {
            header('Location: '.var_155.'/product/list.php?type='.$var_26->var_17.'&delprod='.urlencode($var_26->var_16));
            var_67;
        }
        else
        {
        	setEventMessages($var_7->trans($var_26->var_12), null, 'errors');
            $var_156 = 0;
            $var_18='';
        }
    }


    
    if ($var_26->var_15 > 0 && $var_18 == 'addin')
    {
        $var_157 =0 ;
        if (GETPOST('propalid') > 0)
        {
        	$var_1 = new class_4($var_28);
	        $var_33=$var_1->fetch(GETPOST('propalid'));
	        if ($var_33 <= 0)
	        {
	            dol_print_error($var_28,$var_1->var_12);
	            var_67;
	        }
	        $var_157 = $var_1->var_21;
        }
        elseif (GETPOST('commandeid') > 0)
        {
            $var_5 = new class_5($var_28);
	        $var_33=$var_5->fetch(GETPOST('commandeid'));
	        if ($var_33 <= 0)
	        {
	            dol_print_error($var_28,$var_5->var_12);
	            var_67;
	        }
	        $var_157 = $var_5->var_21;
        }
        elseif (GETPOST('factureid') > 0)
        {
    	    $var_4 = new class_6($var_28);
	        $var_33=$var_4->fetch(GETPOST('factureid'));
	        if ($var_33 <= 0)
	        {
	            dol_print_error($var_28,$var_4->var_12);
	            var_67;
	        }
	        $var_157 = $var_4->var_21;
        }

        if ( $var_157 > 0)  {
            $var_159 = new class_7($var_28);
            $var_33 = $var_159->fetch($var_157);
            if ($var_33 <= 0) {
                dol_print_error($var_28, $var_159->var_12);
                var_67;
            }

            $var_160 = $var_26->var_112;

            $var_82 = get_default_tva($var_91, $var_159, $var_26->var_15);
            $var_99 = get_default_npr($var_91, $var_159, $var_26->var_15);
            if (empty($var_82)) $var_99=0;
            $var_100 = get_localtax($var_82, 1, $var_159, $var_91, $var_99);
            $var_101 = get_localtax($var_82, 2, $var_159, $var_91, $var_99);

            $var_161 = $var_26->var_77;
            $var_162 = $var_26->var_76;
            $var_75 = $var_26->var_75;

            
            if ($var_0->var_38->var_136 && $var_159->var_163) {
                $var_161 = $var_26->multiprices[$var_159->var_163];
                $var_162 = $var_26->multiprices_ttc[$var_159->var_163];
                $var_75 = $var_26->multiprices_base_type[$var_159->var_163];
            } elseif (!empty($var_0->var_38->var_164)) {

                $var_165 = new class_8($var_28);

                $var_166 = array('t.fk_product' => $var_26->var_15, 't.fk_soc' => $var_159->var_15);

                $var_33 = $var_165->fetch_all('', '', 0, 0, $var_166);
                if ($var_33) {
                    if (count($var_165->var_168) > 0) {
                        $var_161 = price($var_165->var_168 [0]->var_77);
                        $var_162 = price($var_165->var_168 [0]->var_76);
                        $var_75 = $var_165->var_168 [0]->var_75;
                        $var_82 = $var_165->var_168 [0]->var_82;
                    }
                }
            }

			$var_169 = price2num(preg_replace('/\s*\(.*\)/', '', $var_82));
			$var_170 = price2num(preg_replace('/\s*\(.*\)/', '', $var_171->var_82));

            
            
            if ($var_169 != $var_170) {
                if ($var_75 != 'HT') {
                    $var_161 = price2num($var_162 / (1 + ($var_169 / 100)), 'MU');
                } else {
                    $var_162 = price2num($var_161 * (1 + ($var_169 / 100)), 'MU');
                }
            }

            if (GETPOST('propalid') > 0) {
                
                $var_172=0;
                if (($var_33 = $var_1->defineBuyPrice($var_161, GETPOST('remise_percent'), $var_26->var_15)) < 0)
                {
                    dol_syslog($var_7->trans('FailedToGetCostPrice'));
                    setEventMessage($var_7->trans('FailedToGetCostPrice'), 'errors');
                }
                else
                {
                    $var_172 = $var_33;
                }

                $var_33 = $var_1->addline(
                    $var_160,
                    $var_161,
                    GETPOST('qty'),
                    $var_82,
                    $var_100, 
                    $var_101, 
                    $var_26->var_15,
                    GETPOST('remise_percent'),
                    $var_75,
                    $var_162,
                    0,
                    0,
                    -1,
                    0,
                    0,
                    0,
                    $var_172,
                    '',
                    '',
                    '',
                    0,
                    $var_26->var_131
                );
                if ($var_33 > 0) {
                    header("Location: " . var_155 . "/comm/propal/card.php?id=" . $var_1->var_15);
                    return;
                }

                setEventMessages($var_7->trans("ErrorUnknown") . ": $var_33", null, 'errors');
            } elseif (GETPOST('commandeid') > 0) {
                
                $var_172=0;
                if (($var_33 = $var_5->defineBuyPrice($var_161, GETPOST('remise_percent'), $var_26->var_15)) < 0)
                {
                    dol_syslog($var_7->trans('FailedToGetCostPrice'));
                    setEventMessage($var_7->trans('FailedToGetCostPrice'), 'errors');
                }
                else
                {
                    $var_172 = $var_33;
                }

                $var_33 = $var_5->addline(
                    $var_160,
                    $var_161,
                    GETPOST('qty'),
                    $var_82,
                    $var_100, 
                    $var_101, 
                    $var_26->var_15,
                    GETPOST('remise_percent'),
                    '',
                    '',
                    $var_75,
                    $var_162,
                    '',
                    '',
                    0,
                    -1,
                    0,
                    0,
                    null,
                    $var_172,
                    '',
                    0,
                    $var_26->var_131
                );

                if ($var_33 > 0) {
                    header("Location: " . var_155 . "/commande/card.php?id=" . $var_5->var_15);
                    var_67;
                }
            } elseif (GETPOST('factureid') > 0) {
                
                $var_172=0;
                if (($var_33 = $var_4->defineBuyPrice($var_161, GETPOST('remise_percent'), $var_26->var_15)) < 0)
                {
                    dol_syslog($var_7->trans('FailedToGetCostPrice'));
                    setEventMessage($var_7->trans('FailedToGetCostPrice'), 'errors');
                }
                else
                {
                    $var_172 = $var_33;
                }

                $var_33 = $var_4->addline(
                    $var_160,
                    $var_161,
                    GETPOST('qty'),
                    $var_82,
                    $var_100,
                    $var_101,
                    $var_26->var_15,
                    GETPOST('remise_percent'),
                    '',
                    '',
                    '',
                    '',
                    '',
                    $var_75,
                    $var_162,
                    var_158::var_175,
                    -1,
                    0,
                    '',
                    0,
                    0,
                    null,
                    $var_172,
                    '',
                    0,
                    100,
                    '',
                    $var_26->var_131
                );

                if ($var_33 > 0) {
                    header("Location: " . var_155 . "/compta/facture/card.php?facid=" . $var_4->var_15);
                    var_67;
                }
            }
        }
        else {
            $var_18="";
            setEventMessages($var_7->trans("WarningSelectOneDocument"), null, 'warnings');
        }
    }
}





$var_176 = $var_7->trans('ProductServiceCard');
$var_177 = '';
$var_178 = dol_trunc($var_26->var_74,16);
if (GETPOST("type") == '0' || ($var_26->var_17 == var_27::var_50))
{
	$var_176 = $var_7->trans('Product')." ". $var_178 ." - ".$var_7->trans('Card');
	$var_177='EN:Module_Products|FR:Module_Produits|ES:M&oacute;dulo_Productos';
}
if (GETPOST("type") == '1' || ($var_26->var_17 == var_27::var_54))
{
	$var_176 = $var_7->trans('Service')." ". $var_178 ." - ".$var_7->trans('Card');
	$var_177='EN:Module_Services_En|FR:Module_Services|ES:M&oacute;dulo_Servicios';
}

llxHeader('', $var_176, $var_177);

$var_179 = new class_9($var_28);
$var_180 = new class_10($var_28);
$var_181 = new class_11($var_28);
if (! empty($var_0->var_6->var_2)) $var_182 = new class_12($var_28);


$var_183=0;
if (! empty($var_0->var_60->var_2) && ! empty($var_0->var_38->var_184))
{
	$var_185=strtolower($var_0->var_38->var_184);
	$var_186=array_merge(array('/core/modules/barcode/'),$var_0->modules_parts['barcode']);
	foreach ($var_186 as $var_187)
	{
		$var_183=dol_include_once($var_187.$var_185.'.php');
		if ($var_183) break;
	}
	if ($var_183 > 0)
	{
			$var_188 =new $var_185();
	}
}


if (is_object($var_43) && $var_43->displayCanvasExists($var_18))
{
	
	
	
	if (empty($var_26->var_12) && $var_15)
	{
		$var_26 = new class_0($var_28);
		$var_33=$var_26->fetch($var_15);
		if ($var_33 <= 0) dol_print_error('',$var_26->var_12);
	}
	$var_43->assign_values($var_18, $var_26->var_15, $var_26->var_16);	
	$var_43->display_canvas($var_18);							
}
else
{
    
    
    
	if ($var_18 == 'create' && $var_55)
    {
        

		
        $var_185=(! empty($var_0->var_38->var_192)?$var_0->var_38->var_192:'mod_codeproduct_leopard');
        if (substr($var_185, 0, 16) == 'mod_codeproduct_' && substr($var_185, -3) == 'php')
        {
            $var_185 = substr($var_185, 0, dol_strlen($var_185)-4);
        }
        $var_33=dol_include_once('/core/modules/product/'.$var_185.'.php');
        if ($var_33 > 0)
        {
        	$var_193 = new $var_185();
        }

        dol_set_focus('input[name="ref"]');

        
        
        
        
		if (! empty($var_193->var_194))
			
		if (! empty($var_188->var_194))
			

        if ($var_17==1) $var_176=$var_7->trans("NewService");
        else $var_176=$var_7->trans("NewProduct");
        $var_195="";
        

        dol_fiche_head('');

        

        
        $var_196='';
		if (! empty($var_193->var_194)) $var_196=$var_193->getNextValue($var_26,$var_17);
        
        if ($var_14)
        {
            
        }
        

        
        

        
        
        $var_198=array('1' => $var_7->trans("OnSell"), '0' => $var_7->trans("NotOnSell"));
        
        

        
        
        $var_198=array('1' => $var_7->trans("ProductStatusOnBuy"), '0' => $var_7->trans("ProductStatusNotOnBuy"));
        
        

	    
		if (! empty($var_0->var_10->var_2))
		{
			
			$var_198=array('0' => $var_7->trans("ProductStatusNotOnBatch"), '1' => $var_7->trans("ProductStatusOnBatch"));
			
			
		}

        $var_199=empty($var_0->var_60->var_2)?0:1;
        if (! empty($var_0->var_38->var_61) && empty($var_24->var_51->var_60->var_200)) $var_199=0;

        if ($var_199)
        {
 	        
 	        if (isset($_POST['fk_barcode_type']))
	        {
	         	$var_201=GETPOST('fk_barcode_type');
	        }
	        else
	        {
	        	if (empty($var_201) && ! empty($var_0->var_38->var_202)) $var_201 = $var_0->var_38->var_202;
	        }
            $var_203 = new class_13($var_28);
	        
	        
	        $var_196=isset($_POST['barcode'])?GETPOST('barcode'):$var_26->var_60;
	        if (empty($var_196) && ! empty($var_188->var_194)) $var_196=$var_188->getNextValue($var_26,$var_17);
	        
	        
        }

        
        

        $var_204 = new class_14('desc', GETPOST('desc','none'), '', 160, 'dolibarr_details', '', false, true, $var_0->var_38->var_205, var_206, '90%');
        $var_204->Create();

        

        
        
		
        

        
        if ($var_17 != 1 && ! empty($var_0->var_9->var_2))
        {
            
            
            
            
            
            
            
        }
        else
        {
            
            
        }

        
        if ($var_17 != 1)
        {
            
            $var_198=array('1' => $var_7->trans("Finished"), '0' => $var_7->trans("RowMaterial"));
            
            
        }

        
        if ($var_17 == 1)
        {
            ';
            ';
            ';
            ';
            ';
            ';
            
        }

        if ($var_17 != 1)	
        {
            
            
            
            
            
            
            if (empty($var_0->var_38->var_208))
            {
                
                
                
                
                
                
            }
            if (empty($var_0->var_38->var_209))
            {
                
                
                
                
                
            }
            
            
            
            
            
        }

        
	    if($var_0->var_38->var_210)
	    {
		    
		    
		    
		    
	    }

        
        if (empty($var_0->var_38->var_211) && empty($var_17))
        {
	        
	        
	        
	        
	        if ($var_24->var_212) 
	        
        }

        
        $var_63=array('cols' => 3);
        $var_64=$var_47->executeHooks('formObjectOptions',$var_63,$var_26,$var_18);    
        
        if (empty($var_64) && ! empty($var_29->var_213))
        {
        	
        }

        
        
        
            

            
            $var_204 = new class_14('note_private', GETPOST('note_private','none'), '', 140, 'dolibarr_details', '', false, true, $var_0->var_38->var_205, var_214, '90%');
    	    $var_204->Create();

            
        

		if ($var_0->var_215->var_2) {
			
			
			$var_216 = $var_179->select_all_categories(var_218::var_50, '', 'parent', 64, 0, 1);
			
			
		}

        

        

        if (! empty($var_0->var_38->var_136))
        {
            
            
            
            
            
            $var_219 = get_default_tva($var_91, $var_91);
            
            
            
            
        }
        else
		{
            

            
            
            
            
            

            
            
            
            

            
            
            $var_219=get_default_tva($var_91, $var_91);
            
            

            

            
        }

        
        

		if (! empty($var_0->var_6->var_2))
		{
			
			
			
			
			

			if ($var_0->var_38->var_220)
			{
				
				if ($var_91->isInEEC())
				{
					
					
					
					
				}

				
				
				
				
				
			}

			
			
			
			
			
		}
		else 
		{
			
			
			
			

			if ($var_0->var_38->var_220)
			{
				
				if ($var_91->isInEEC())
				{
					
					
					
				}

				
				
				
				
			}

			
			
			
			
		}
		

		dol_fiche_end();

		
		
		 &var_222; ';
		
		

		
	}

    

    else if ($object->id > 0)
    {
        
		if ($action == 'var_223' && $var_55)
		{
            

            $var_17 = $var_7->trans('Product');
            if ($var_26->isService()) $var_17 = $var_7->trans('Service');
            

            
            
            
            
            
            

            $var_225=product_prepare_head($var_26);
            $var_226=$var_7->trans("CardProduct".$var_26->var_17);
            $var_227=($var_26->var_17== var_27::var_54?'service':'product');
            dol_fiche_head($var_225, 'card', $var_226, 0, $var_227);

            

            
            

            
            

            
            
            
            if ($var_26->var_102)
            {
                
                
            }
            else
            {
                
                
            }
            
            

            
            
            
            if ($var_26->var_103)
            {
                
                
            }
            else
            {
                
                
            }
            
            

			
			if ($var_0->var_10->var_2) 
			{
				if ($var_26->isProduct() || ! empty($var_0->var_38->var_229))
				{
					
					$var_198=array('0' => $var_7->trans("ProductStatusNotOnBatch"), '1' => $var_7->trans("ProductStatusOnBatch"));
					
					
				}
			}

            
            $var_199=empty($var_0->var_60->var_2)?0:1;
            if (! empty($var_0->var_38->var_61) && empty($var_24->var_51->var_60->var_200)) $var_199=0;

	        if ($var_199)
	        {
		        
		        if (isset($_POST['fk_barcode_type']))
		        {
		         	$var_201=GETPOST('fk_barcode_type');
		        }
		        else
		        {
	        		$var_201=$var_26->var_105;
		        	if (empty($var_201) && ! empty($var_0->var_38->var_202)) $var_201 = $var_0->var_38->var_202;
		        }
	            $var_203 = new class_13($var_28);
		        
		        
		        $var_196=isset($_POST['barcode'])?GETPOST('barcode'):$var_26->var_60;
		        if (empty($var_196) && ! empty($var_188->var_194)) $var_196=$var_188->getNextValue($var_26,$var_17);
		        
		        
	        }

            
            

            
            $var_204 = new class_14('desc', $var_26->var_112, '', 160, 'dolibarr_details', '', false, true, $var_0->var_38->var_205, var_206, '90%');
            $var_204->Create();

            
            

            
            
			
            

            
            

            
            if($var_26->var_17!= var_27::var_54)
            {
                
                $var_198=array('-1'=>'&nbsp;', '1' => $var_7->trans("Finished"), '0' => $var_7->trans("RowMaterial"));
                
                
            }

            if ($var_26->isService())
            {
                
                
                 ';
                
                 ';
                
                 ';
                
                 ';
                
                 ';
                
                
            }
            else
			{
                
                
                
                
                
                if (empty($conf->global->PRODUCT_DISABLE_SIZE))
                {
        			
        			
        			
        			
        			
        			
        			
                }
                if (empty($conf->global->PRODUCT_DISABLE_SURFACE))
                {
                    
                    
                    
                    
                    
                }
                if (empty($conf->global->PRODUCT_DISABLE_VOLUME))
                {
                    
                    
                    
                    
                    
                }
            }
        	
	        if($conf->global->PRODUCT_USE_UNITS)
	        {
		        
		        
		        
		        
	        }

	        
    	    if (! $object->isService() && empty($conf->global->PRODUCT_DISABLE_CUSTOM_INFO))
        	{
	            
	            
	            
	            
	            if ($user->admin) 
	            
        	}

            
            $parameters=array('var_230' => ' var_230="3"', 'var_231'=>3);
            $var_64=$var_47->executeHooks('formObjectOptions',$var_63,$var_26,$var_18);    
            
            if (empty($var_64) && ! empty($var_29->var_213))
            {
            	
            }

			
            if ($var_0->var_215->var_2)
			{
				
				$var_216 = $var_179->select_all_categories(var_218::var_50, '', 'parent', 64, 0, 1);
				$var_232 = new class_15($var_28);
				$var_233 = $var_232->containing($var_26->var_15,var_218::var_50);
				$var_235=array();
				foreach($var_233 as $var_236) {
					$var_235[] = $var_236->var_15;
				}
				
				
			}

            
			if (! empty($var_0->var_38->var_145))
			{
                

                $var_204 = new class_14('note_private', $var_26->var_114, '', 140, 'dolibarr_notes', '', false, true, $var_0->var_38->var_205, var_206, '90%');
                $var_204->Create();

                
			}

            

            

            

			if (! empty($var_0->var_6->var_2))
			{
				
				
				
				
				

				if ($var_0->var_38->var_220)
				{
					
					if ($var_91->isInEEC())
					{
						
						
						
						
					}

					
					
					
					
					
				}

				
				
				
				
				
			}
			else 
			{
				
				
				
				

				if ($var_0->var_38->var_220)
				{
					
					if ($var_91->isInEEC())
					{
						
						
						
					}

					
					
					
					
				}

				
				
				
				
			}
			

			dol_fiche_end();

			
			
			&var_222;&var_222;&var_222;&var_222;';
			
			

			
		}
        
        else
		{
            $showbarcode=empty($conf->barcode->enabled)?0:1;
            if (! empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->barcode->lire_advance)) $showbarcode=0;

		    $head=product_prepare_head($object);
            $titre=$langs->trans("CardProduct".$object->type);
            $picto=($object->type== Product::TYPE_SERVICE?'var_37':'var_35');

            dol_fiche_head($var_225, 'card', $var_226, -1, $var_227);

            $var_195 = '<a href="'.var_155.'/product/list.php?restore_lastsearch_values=1&type='.$var_26->var_17.'">'.$var_7->trans("BackToList").'</a>';
            $var_26->var_237=" fk_product_type = ".$var_26->var_17;

            $var_238 = 1;
            if ($var_24->var_25 && ! in_array('product', explode(',',$var_0->var_38->var_239))) $var_238=0;

            dol_banner_tab($var_26, 'ref', $var_195, $var_238, 'ref');


            
            

            
            

			
			if (! empty($var_0->var_52->var_2) && ! empty($var_0->var_37->var_2))
			{
				
				$var_240='select;0:'.$var_7->trans("Product").',1:'.$var_7->trans("Service");
				
				
				
			}

            if ($var_199)
            {
                
                
                
                
                
                if (($var_18 != 'editbarcodetype') && $var_55 && $var_59) var_15='.$var_26->var_15.'">'.img_edit($var_7->trans('Edit'),1).'</a></td>';
                
                
                if ($var_18 == 'editbarcodetype' || $var_18 == 'editbarcode')
                {
                    $var_203 = new class_13($var_28);
				}
                if ($var_18 == 'editbarcodetype')
                {
                    $var_203->form_barcode_type($_SERVER['PHP_SELF'].'?id='.$var_26->var_15,$var_26->var_105,'fk_barcode_type');
                }
                else
                {
                    $var_26->fetch_barcode();
                    
                }
                

                
                
                
                
                
                if (($var_18 != 'editbarcode') && $var_55 && $var_59) var_15='.$var_26->var_15.'">'.img_edit($var_7->trans('Edit'),1).'</a></td>';
                
                
                if ($var_18 == 'editbarcode')
                {
					$var_196=isset($_POST['barcode'])?GETPOST('barcode'):$var_26->var_60;
					if (empty($var_196) && ! empty($var_188->var_194)) $var_196=$var_188->getNextValue($var_26,$var_17);

					
					
					
					
					
					<var_242 var_17="var_243" class="var_244" value="'.$var_7->trans("Modify").'">';
					
                }
                else
                {
					
                }
                
            }

			
			
			
			
			if (! empty($var_0->var_6->var_2))
			{
				$var_245 = new class_16($var_28);
				$var_245->fetch('',$var_26->var_132,1);

				
			} else {
				
			}
			

			if ($var_0->var_38->var_220)
			{
				
				if ($var_91->isInEEC())
				{
					
					
					
					if (! empty($var_0->var_6->var_2))
					{
						$var_246 = new class_16($var_28);
						$var_246->fetch('',$var_26->var_133,1);

						
					} else {
						
					}
					
				}

				
				
				
				
				if (! empty($var_0->var_6->var_2))
				{
					$var_247 = new class_16($var_28);
					$var_247->fetch('',$var_26->var_134,1);

					
				} else {
					
				}
				
			}

			
			
			
			
			if (! empty($var_0->var_6->var_2))
			{
				$var_248 = new class_16($var_28);
				$var_248->fetch('',$var_26->var_135,1);

				
			} else {
				
			}
			

            
            if (! empty($var_0->var_10->var_2)) 
            {
				if ($var_26->isProduct() || ! empty($var_0->var_38->var_229))
				{
            		
            	    if (! empty($var_0->var_249) && $var_55 && ! empty($var_0->var_38->var_250)) {
            	        
            	    } else {
            	        
            	    }
            	    
				}
            }

            
            

            
            
			
            

            
            if (!empty($var_0->var_251->var_2) && $var_26->isProduct()) {

                $var_252 = new class_17($var_28);

                if ($var_252->fetchByFkProductChild($var_26->var_15) > 0) {
                    $var_254 = new class_0($var_28);
                    $var_254->fetch($var_252->var_255);

                    
                    
                    
                    
                }
            }

            
            
            

            
            

            
            if($var_26->var_17!= var_27::var_54)
            {
                
                
                
            }

            if ($var_26->isService())
            {
                
                ';
                if ($object->duration_value > 1)
                {
                    $dur=array("h"=>$langs->trans("Hours"),"d"=>$langs->trans("Days"),"w"=>$langs->trans("Weeks"),"m"=>$langs->trans("Months"),"y"=>$langs->trans("Years"));
                }
                else if ($object->duration_value > 0)
                {
                    $dur=array("h"=>$langs->trans("Hour"),"d"=>$langs->trans("Day"),"w"=>$langs->trans("Week"),"m"=>$langs->trans("Month"),"y"=>$langs->trans("Year"));
                }
                ";

                
            }
            else
            {
                
                
                if ($object->weight != '')
                {
                    
                }
                else
                {
                    ';
                }
                
                if (empty($conf->global->PRODUCT_DISABLE_SIZE))
                {
                    
                    
                    if ($object->length != '' || $var_26->var_124 != '' || $var_26->var_125 != '')
                    {
                        
                        if ($var_26->var_124) 
                        var_256 ($var_26->var_125) 
                        
                    }
                    var_258
                    {
                        ';
                    }
                    
                }
                if (empty($conf->global->PRODUCT_DISABLE_SURFACE))
                {
                    
                    
                    if ($object->surface != '')
                    {
                        
                    }
                    else
                    {
                        ';
                    }
                    
                }
                if (empty($conf->global->PRODUCT_DISABLE_VOLUME))
                {
                    
                    
                    if ($object->volume != '')
                    {
                        
                    }
                    else
                    {
                        ';
                    }
                    
                }
            }

			
			if (! empty($conf->global->PRODUCT_USE_UNITS))
			{
				$unit = $object->getLabelOfUnit();

				
				if ($unit !== '') {
					
				}
				
			}

        	
        	var_256 (! $var_26->isService() && empty($var_0->var_38->var_211))
        	{
	            

            	
            	
        	}

            
            $var_63=array('colspan' => ' colspan="'.(2+(($var_257||$var_199)?1:0)).'"');

			
			if($var_0->var_215->var_2) {
				
				
				
			}

            
			if (! empty($var_0->var_38->var_145))
			{
    			
                
                
			}

            
    		

            
            

            dol_fiche_end();
        }

    }
    var_258 if ($var_18 != 'create')
    {
        var_67;
    }
}


$var_185=(! empty($var_0->var_38->var_192)?$var_0->var_38->var_192:'mod_codeproduct_leopard');
if (var_259($var_185, 0, 16) == 'mod_codeproduct_' && substr($var_185, -3) == 'php')
{
    $var_185 = var_259($var_185, 0, var_260($var_185)-4);
}
$var_33=dol_include_once('/core/modules/product/'.$var_185.'.php');
if ($var_33 > 0)
{
	$var_193 = new $var_185();
}

$var_196='';
if (! empty($var_193->var_194)) $var_196=$var_193->getNextValue($var_26,$var_26->var_17);


$var_261=array(
	'text' => $var_7->trans("ConfirmClone"),
    array('type' => 'text', 'name' => 'clone_ref','label' => $var_7->trans("NewRefForClone"), 'value' => empty($var_196) ? $var_7->trans("CopyOf").' '.$var_26->var_16 : $var_196, 'size'=>24),
    array('type' => 'checkbox', 'name' => 'clone_content','label' => $var_7->trans("CloneContentProduct"), 'value' => 1),
    array('type' => 'checkbox', 'name' => 'clone_prices', 'label' => $var_7->trans("ClonePricesProduct").' ('.$var_7->trans("FeatureNotYetAvailable").')', 'value' => 0, 'disabled' => true),
);
if (! empty($var_0->var_38->var_262))
{
    $var_261[]=array('type' => 'checkbox', 'name' => 'clone_composition', 'label' => $var_7->trans('CloneCompositionProduct'), 'value' => 1);
}


if (($var_18 == 'delete' && (empty($var_0->var_249) || ! empty($var_0->var_263)))	
	|| (! empty($var_0->var_249) && empty($var_0->var_263)))							
{
    
}


if (($var_18 == 'clone' && (empty($var_0->var_249) || ! empty($var_0->var_263)))		
	|| (! empty($var_0->var_249) && empty($var_0->var_263)))							
{
    
}







if ($var_18 != 'create' && $var_18 != 'edit')
{
    

    $var_63=array();
    $var_64=$var_47->executeHooks('addMoreActionsButtons',$var_63,$var_26,$var_18);    
    if (empty($var_64))
	{
		if ($var_55)
        {
            if (! isset($var_26->var_264) || $var_26->var_264 <> 1) var_15='.$var_26->var_15.'">'.$var_7->trans("Modify").'</a></div>';

            if (! isset($var_26->var_265) || $var_26->var_265 <> 1)
            {
                if (! empty($var_0->var_249) && empty($var_0->var_263))
                {
                    
                }
                else
    			{
                    var_15='.$var_26->var_15.'">'.$var_7->trans("ToClone").'</a></div>';
                }
            }
        }
        $var_266 = $var_26->isObjectUsed($var_26->var_15);

        if ($var_57)
        {
            if (empty($var_266) && (! isset($var_26->var_268) || $var_26->var_268 <> 1))
            {
                if (! empty($var_0->var_249) && empty($var_0->var_263))
                {
                    
                }
                else
    			{
                    var_15='.$var_26->var_15.'">'.$var_7->trans("Delete").'</a></div>';
                }
            }
            else
    		{
                
}



if (! empty($var_0->var_38->var_269) && $var_26->var_15 && ($var_18 == '' || $var_18 == 'view') && $var_26->var_102)
{
    
    $var_270 = '';
	

    
    if (! empty($var_0->var_1->var_2) && $var_24->var_51->var_271->var_56)
    {
        $var_1 = new class_4($var_28);

        $var_7->load("propal");

        $var_272 = $var_1->liste_array(2,1,0);

        if (is_array($var_272) && count($var_272))
        {
        	$var_270 .= '<tr><td style="width: 200px;">';
        	$var_270 .= $var_7->trans("AddToDraftProposals").'</td><td>';
        	$var_270 .= $var_179->selectarray("propalid", $var_272, 0, 1);
        	$var_270 .= '</td></tr>';
        }
        else
       {
        	$var_270 .= '<tr><td style="width: 200px;">';
        	$var_270 .= $var_7->trans("AddToDraftProposals").'</td><td>';
        	$var_270 .= $var_7->trans("NoDraftProposals");
        	$var_270 .= '</td></tr>';
        }
    }

    
    if (! empty($var_0->var_5->var_2) && $var_24->var_51->var_5->var_56)
    {
        $var_5 = new class_5($var_28);

        $var_7->load("orders");

        $var_275 = $var_5->liste_array(2, 1, null);
        if (is_array($var_275) && count($var_275))
        {
        	$var_270 .= '<tr><td style="width: 200px;">';
        	$var_270 .= $var_7->trans("AddToDraftOrders").'</td><td>';
        	$var_270 .= $var_179->selectarray("commandeid", $var_275, 0, 1);
        	$var_270 .= '</td></tr>';
        }
        else
		{
        	$var_270 .= '<tr><td style="width: 200px;">';
        	$var_270 .= $var_7->trans("AddToDraftOrders").'</td><td>';
        	$var_270 .= $var_7->trans("NoDraftOrders");
        	$var_270 .= '</td></tr>';
        }
    }

    
    if (! empty($var_0->var_4->var_2) && $var_24->var_51->var_4->var_56)
    {
    	$var_276 = new class_6($var_28);

    	$var_7->load("bills");

    	$var_277 = $var_276->liste_array(2, 1, null);
    	if (is_array($var_277) && count($var_277))
    	{
    		$var_270 .= '<tr><td style="width: 200px;">';
    		$var_270 .= $var_7->trans("AddToDraftInvoices").'</td><td>';
    		$var_270 .= $var_179->selectarray("factureid", $var_277, 0, 1);
    		$var_270 .= '</td></tr>';
    	}
    	else
    	{
    		$var_270 .= '<tr><td style="width: 200px;">';
    		$var_270 .= $var_7->trans("AddToDraftInvoices").'</td><td>';
    		$var_270 .= $var_7->trans("NoDraftInvoices");
    		$var_270 .= '</td></tr>';
    	}
    }

    
    if (!empty($var_270))
    {
	    
    	
    	

	    

		dol_fiche_head('');

    	$var_270 .= '<tr><td class="nowrap">'.$var_7->trans("Quantity").' ';
    	$var_270 .= '<input type="text" class="flat" name="qty" size="1" value="1"></td>';
        $var_270 .= '<td class="nowrap">'.$var_7->trans("ReductionShort").'(%) ';
    	$var_270 .= '<input type="text" class="flat" name="remise_percent" size="1" value="0">';
    	$var_270 .= '</td></tr>';

    	
        
        

        
        
        

        dol_fiche_end();

        
    }
}




if ($var_18 != 'create' && $var_18 != 'edit' && $var_18 != 'delete')
{
    
     

    
    $var_278 = dol_sanitizeFileName($var_26->var_16);
    $var_279 = $var_280 . '/' . $var_278 . '.pdf';
    $var_281 = $var_0->var_52->var_68 . '/' . $var_278;
    $var_282=$_SERVER["PHP_SELF"]."?id=".$var_26->var_15;
    $var_283=$var_49;
    $var_284=$var_55;

    $var_285=true;

    
    $var_286=$var_180->var_287;

    

    $var_288 = 10;

    $var_289 = '<a href="'.var_155.'/product/agenda.php?id='.$var_26->var_15.'">';
    $var_289.= $var_7->trans("SeeAll");
    $var_289.= '</a>';

    
    $var_290 = new class_18($var_28);
    $var_286 = $var_290->showactions($var_26, 'product', 0, 1, '', $var_288, '', $var_289);		

    
}


llxFooter();
$var_28->close();
