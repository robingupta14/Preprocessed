<?php





$var_0 = '';


if (!$var_1->checkAuth()) {
    $_SESSION['LOGIN_MESSAGE'] = $MSG['5000'];
    $_SESSION['REDIRECT_AFTER_LOGIN'] = 'yourauctions_s.php';
    header('location: user_login.php');
    var_3;
}

$var_1->checkSuspended();


if (isset($_POST['action']) && $_POST['action'] == 'delopenauctions') {
    if (isset($_POST['O_delete']) && is_array($_POST['O_delete']) && count($_POST['O_delete']) > 0) {
        foreach ($_POST['O_delete'] as $var_5 => $var_6) {
            $var_7 = 0;
            $var_6 = intval($var_6);
            
            if (is_dir(var_8 . $var_6)) {
                if ($var_9 = opendir(var_8 . $var_6)) {
                    while ($var_10 = readdir($var_9)) {
                        if ($var_10 != '.' && $var_10 != '..') {
                            @unlink(var_8 . $var_6 . '/' . $var_10);
                        }
                    }
                    closedir($var_9);
                    rmdir(var_8 . $var_6);
                }
            }

            
            $var_11 = "DELETE FROM " . $var_12 . "auctions WHERE id = :auc_id";
            $var_13 = array();
            $var_13[] = array(':auc_id', $var_6, 'int');
            $var_14->query($var_11, $var_13);
            $var_7++;
        }

        $var_11 = "UPDATE " . $var_12 . "counters SET auctions = (auctions - :removed)";
        $var_13 = array();
        $var_13[] = array(':removed', $var_7, 'int');
        $var_14->query($var_11, $var_13);
        $var_0 .= sprintf($MSG['1145'], count($_POST['O_delete']));
    }
}


$var_11 = "SELECT count(id) as COUNT FROM " . $var_12 . "auctions WHERE user = :user_id AND suspended != 0";
$var_13 = array();
$var_13[] = array(':user_id', $var_1->user_data['id'], 'int');
$var_14->query($var_11, $var_13);
$var_15 = $var_14->result('COUNT');

if (!isset($_GET['PAGE']) || $_GET['PAGE'] < 0 || empty($_GET['PAGE'])) {
    $var_17 = 0;
    $var_18 = 1;
} else {
    $var_18 = intval($_GET['PAGE']);
    $var_17 = ($var_18 - 1) * $var_19->SETTINGS['perpage'];
}
$var_20 = ($var_15 == 0) ? 1 : ceil($var_15 / $var_19->SETTINGS['perpage']);

if (!isset($_SESSION['sa_ord']) && empty($_GET['sa_ord'])) {
    $_SESSION['sa_ord'] = 'title';
    $_SESSION['sa_type'] = 'asc';
} elseif (!empty($_GET['sa_ord'])) {
	
    $_SESSION['sa_ord'] = (in_array($_GET['sa_ord'], array('title', 'num_bids', 'current_bid'))) ? $_GET['sa_ord'] : 'title';
    $_SESSION['sa_type'] = (in_array($_GET['sa_type'], array('asc', 'desc'))) ? $_GET['sa_type'] : 'asc';
} elseif (isset($_SESSION['sa_ord']) && empty($_GET['sa_ord'])) {
    $_SESSION['sa_nexttype'] = $_SESSION['sa_type'];
}

if (!isset($_SESSION['sa_nexttype']) || $_SESSION['sa_nexttype'] == 'desc') {
    $_SESSION['sa_nexttype'] = 'asc';
} else {
    $_SESSION['sa_nexttype'] = 'desc';
}

if (!isset($_SESSION['sa_type']) || $_SESSION['sa_type'] == 'desc') {
    $_SESSION['sa_type_img'] = '<img src="images/arrow_up.gif" align="center" hspace="2" border="0" />';
} else {
    $_SESSION['sa_type_img'] = '<img src="images/arrow_down.gif" align="center" hspace="2" border="0" />';
}
$var_11 = "SELECT id, title, current_bid, num_bids, relist, relisted, current_bid, suspended
	FROM " . $var_12 . "auctions
	WHERE user = :user_id
	AND suspended != 0
	ORDER BY " . $_SESSION['sa_ord'] . " " . $_SESSION['sa_type'] . " LIMIT :offset, :perpage";
$var_13 = array();
$var_13[] = array(':user_id', $var_1->user_data['id'], 'int');
$var_13[] = array(':offset', $var_17, 'int');
$var_13[] = array(':perpage', $var_19->SETTINGS['perpage'], 'int');
$var_14->query($var_11, $var_13);

$var_21 = 0;
while ($var_22 = $var_14->fetch()) {
    $var_24->assign_block_vars('items', array(
            'BGCOLOUR' => (!($var_21 % 2)) ? '' : 'class="alt-row"',
            'ID' => $var_22['id'],
            'TITLE' => htmlspecialchars($var_22['title']),
            'BID' => $var_19->print_money($var_22['current_bid']),
            'BIDS' => $var_22['num_bids'],
            'RELIST' => $var_22['relist'],
            'RELISTED' => $var_22['relisted'],
            'SUSPENDED' => $var_22['suspended'],

            'B_HASNOBIDS' => ($var_22['current_bid'] == 0)
            ));
    $var_21++;
}

$var_27 = intval($var_18 - 1);
$var_28 = intval($var_18 + 1);
if ($var_20 > 1) {
    $var_29 = $var_18 - 5;
    if ($var_29 <= 0) {
        $var_29 = 1;
    }
    $var_30 = $var_29;
    while ($var_30 <= $var_20 && $var_30 < ($var_18 + 6)) {
        $var_24->assign_block_vars('pages', array(
                'PAGE' => ($var_18 == $var_30) ? '<b>' . $var_30 . '</b>' : '<a href="' . $var_19->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $var_30 . '"><u>' . $var_30 . '</u></a>'
                ));
        $var_30++;
    }
}

$var_24->assign_vars(array(
        'BGCOLOUR' => (!($var_21 % 2)) ? '' : 'class="alt-row"',
        'ORDERCOL' => $_SESSION['sa_ord'],
        'ORDERNEXT' => $_SESSION['sa_nexttype'],
        'ORDERTYPEIMG' => $_SESSION['sa_type_img'],
        'USER_MESSAGE' => $var_0,

        'PREV' => ($var_20 > 1 && $var_18 > 1) ? '<a href="' . $var_19->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $var_27 . '"><u>' . $MSG['5119'] . '</u></a>&nbsp;&nbsp;' : '',
        'NEXT' => ($var_18 < $var_20) ? '<a href="' . $var_19->SETTINGS['siteurl'] . 'yourauctions_s.php?PAGE=' . $var_28 . '"><u>' . $MSG['5120'] . '</u></a>' : '',
        'PAGE' => $var_18,
        'PAGES' => $var_20,

        'B_AREITEMS' => ($var_21 > 0)
        ));

$var_32 = $MSG['2__0056'];
$var_24->set_filenames(array(
        'body' => 'yourauctions_s.tpl'
        ));
$var_24->display('body');
