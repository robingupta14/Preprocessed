<?php



if (!getperms('4'))
{
	e107::redirect('admin');
	exit();
}


e107::coreLan('banlist', true);

e107::js('footer-inline', "

		$('

			var id = $(this).attr('data-ip');
			$('
			event.preventDefault();
		});

");


class class_0 extends var_1
{

	protected $var_2 = array(	
	
		'main'	=> array(
			'controller' 	=> 'banlist_ui',
			'path' 			=> null,
			'ui' 			=> 'banlist_form_ui',
			'uipath' 		=> null
		),
		'white'	=> array(
			'controller' 	=> 'banlist_ui',
			'path' 			=> null,
			'ui' 			=> 'banlist_form_ui',
			'uipath' 		=> null
		),
		'failed'	=> array(
			'controller' 	=> 'failed_ui',
			'path' 			=> null,
			'ui' 			=> 'failed_form_ui',
			'uipath' 		=> null
		),

	);	
	
	
	protected $var_3 = array(

		'main/list'			=> array('caption'=> var_4, 'perm' => '4'),
		'main/create'		=> array('caption'=> var_5, 'perm' => '4'),
		'other'            => array('divider'=>true),
		
		'white/list'		=> array('caption'=> var_6, 'perm' => '4'),
		'white/create'		=> array('caption'=> var_7, 'perm' => '4'),

		'other1'            => array('divider'=>true),

		'failed/list'       => array('caption'=> var_8, 'perm'=>'4'),

		'other2'            => array('divider'=>true),
		'main/transfer'		=> array('caption'=> var_9, 'perm' => '4'),
		'main/times'		=> array('caption'=> var_10, 'perm' => '0'),
		'main/options'		=> array('caption'=> var_11, 'perm' => '0'),
	
	);

	protected $var_12 = array(
		'main/edit'	=> 'main/list'						
	);	
	
	protected $var_13 = var_14;

	protected $var_15 = 'e-banlist-24';
}




				
class class_1 extends var_16
{
			
		protected $var_17		= var_14;
		protected $var_18		= 'ban';
		protected $var_19			= 'banlist';
		protected $var_20				= 'banlist_id'; 
		protected $var_21 			= 10;
		protected $var_22          = "SELECT * FROM `
		protected $var_23		= 'banlist_datestamp DESC';

		protected $var_24 	= array (  
		  'checkboxes' 			=>   array ( 'title' => '', 				'type' => null, 		'data' => null, 'width' => '5%', 'thclass' => 'center', 'forced' => '1', 'class' => 'center', 'toggle' => 'e-multiselect',  ),
		  'banlist_id'			 =>  array ( 'title' => LAN_ID, 			'data' => 'int',        'width' => '5%', 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left',  ),
		  'banlist_ip' 			=>   array ( 'title' => BANLAN_126, 			'type' => 'method', 		'data' => 'str', 'width' => 'auto', 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left',  ),
		  'banlist_bantype' 	=>   array ( 'title' => LAN_TYPE, 			'type' => 'method', 	'data' => 'str', 'width' => 'auto', 'filter'=>true, 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left',  ),
		  'banlist_datestamp' 	=>   array ( 'title' => LAN_DATESTAMP, 		'type' => 'datestamp', 	'data' => 'int', 'width' => 'auto', 'filter' => true, 'help' => '', 'readParms' => '', 'writeParms' => 'auto=1&hidden=1&readonly=1', 'class' => 'left', 'thclass' => 'left',  ),
		  'banlist_banexpires' 	=>   array ( 'title' => BANLAN_124,	 		'type' => 'method', 	'data' => 'int', 'inline'=>true, 'width' => 'auto', 'batch' => true, 'filter' => true, 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left',  ),
		  'banlist_admin' 		=>   array ( 'title' => 'Admin', 			'type' => 'text', 	    'data' => 'int', 'noedit'=>true, 'width' => 'auto', 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'center', 'thclass' => 'center',  ),
		  'banlist_reason' 		=>   array ( 'title' => BANLAN_7, 			'type' => 'text', 		'data' => 'str', 'inline'=>true, 'width' => 'auto', 'help' => '', 'readParms' => 'constant=1', 'writeParms' => array('size'=>'xxlarge'), 'class' => 'left', 'thclass' => 'left',  ),
		  'banlist_notes' 		=>   array ( 'title' => BANLAN_19, 			'type' => 'text', 		'data' => 'str', 'inline'=>true, 'width' => 'auto', 'help' => '', 'readParms' => '', 'writeParms' => array('size'=>'xxlarge'), 'class' => 'left', 'thclass' => 'left',  ),
		  'options' 			=>   array ( 'title' => LAN_OPTIONS, 		'type' => '', 			'data' => '', 'width' => '10%', 'thclass' => 'center last', 'class' => 'center last', 'forced' => '1',  ),
		);		
		
		protected $var_25 = array('checkboxes', 'banlist_ip', 'banlist_bantype', 'banlist_datestamp', 'banlist_banexpires', 'banlist_reason', 'banlist_notes', 'options');

		
	
	
	
	
	


		function CreateObserver()
		{
			parent::CreateObserver();
			$var_26->var_24['banlist_ip']['title']= BANLAN_5;
		}

		function EditObserver()
		{
			parent::EditObserver();
			$var_26->var_24['banlist_ip']['title']= BANLAN_5;
		}

		
		
		public function init()
		{

			if($var_26->var_27() == 'white')
			{
				if($var_26->var_28() == 'list')
				{
					$var_26->var_22 = "var_29 * var_30 `
				}


				if($var_26->var_28() == 'create')
				{
					$var_31 = e107::getIPHandler()->getIP(true);
					$var_26->var_24['banlist_ip']['writeParms']['tdClassRight']  = 'form-inline';
					$var_26->var_24['banlist_ip']['writeParms']['pre'] = "<div class='input-append'>";
					$var_26->var_24['banlist_ip']['writeParms']['post'] = "<button class='btn btn-primary' id='useip' data-ip='{$var_31}'>".BANLAN_125."</button></div>"; 
				}

			}


			if (isset($var_51['var_32']))		
			{
				$var_26->var_33(); 	
			}
		}


		public function beforeCreate($var_34, $var_35, $var_36)
		{
			$var_34['var_0'] = ADMINID;

			if(filter_var($var_34['var_37'], FILTER_VALIDATE_IP)) 
			{
				$var_34['var_37'] = e107::getIPHandler()->ipEncode($var_34['var_37']);
			}

			return $var_34;
		}

		public function beforeUpdate($var_34, $var_35, $var_36)
		{
			$var_34['var_0'] = ADMINID;

			if(filter_var($var_34['var_37'], FILTER_VALIDATE_IP)) 
			{
				$var_34['var_37'] = e107::getIPHandler()->ipEncode($var_34['var_37']);
			}

			return $var_34;
		}





		public function afterCreate($var_34, $var_35, $var_36)
		{
			e107::getIPHandler()->regenerateFiles();
		}

		public function afterUpdate($var_34, $var_35, $var_36)
		{
			e107::getIPHandler()->regenerateFiles();
		}

		public function afterDelete($var_38, $var_36, $var_39)
		{

			e107::getIPHandler()->regenerateFiles();
		}


		public function addPage()
		{
			
			
			
		}

		
		protected function transferPage()
		{

			$var_40 = new banlistManager;

			
			$var_41 = array(1 => ',', 2 => '|');
			$var_42 = array(1 => '(none)', 2 => "'", 3 => '"');

			$var_43 = e107::getForm();
			$var_44 = e107::getMessage();

			$var_45 = false;

			if(isset($var_51['var_46']))  
			{

				if(($var_47 = process_uploaded_files(e_UPLOAD, false, array('overwrite' => true, 'max_file_count' => 1, 'file_mask' => 'csv'))) === false)
				{ 
					$var_45 = true;
					$var_44->var_48(BANLAN_47);
				}

				if(empty($var_47) || vartrue($var_47[0]['error']))
				{
					$var_45 = true;
					if(varset($var_47[0]['message']))
					{
						$var_44->var_48($var_47[0]['message']);
					}
				}

				if(!$var_45) 
				{
					$var_49 = process_csv(e_UPLOAD . $var_47[0]['name'],
						intval(varset($var_51['var_50'], 0)),
						intval(varset($var_51['var_52'], 0)),
						$separator_char[intval(varset($_POST['var_53'], 1))],
						$var_42[var_54(var_55($var_51['var_56'], 3))]);
					var_57('7', 'var_58: ' . var_59 . $var_47[0]['var_60'] . '<var_61 />' . $var_49);
				}

			}

			$var_62 = "
				<form method='post' action='" . var_63 . "banlist_export.php' id='core-banlist-transfer-form' >
					<fieldset id='core-banlist-transfer-export'>
						<legend>" . var_64 . "</legend>
						<table class='table adminlist'>
							<colgroup>
								<col style='width:30%' />
								<col style='width:30%' />
								<col style='width:40%' />
							</colgroup>
							<tbody>
								<tr>
									<th colspan='2'>" . var_65 . "</th>
									<th>&nbsp;</th>
								</tr>
				";


			foreach($var_40->getValidReasonList() as $var_67) 
			{
				$var_62 .= "
								<tr>
								<td colspan='3'>
									" . $var_43->checkbox("ban_types[{$var_67}]", $var_67) . $var_43->label($var_40->getBanTypeString($var_67, false), "ban_types[{$var_67}]", $var_67) . "
									<span class='field-help'>(" . $var_40->getBanTypeString($var_67, true) . ")</span>
								</td></tr>
				";
			}

			$var_62 .= "<tr>
				<td>" . var_71 . "</td>
				<td>" . $var_43->select('ban_separator', $var_41) . ' ' . var_73 . "</td>
			<td>" . $var_43->select('ban_quote', $var_42) . ' ' . var_74 . "</td></tr>";

			$var_62 .= "
	
							</tbody>
						</table>
						<div class='buttons-bar center'>" . $var_43->admin_button('ban_export', var_76, 'export', var_76) . "</div>
							<input type='hidden' name='e-token' value='" . var_77 . "' />
					</fieldset>
				</form>
			";

			
			$var_62 .= "
				<form enctype='multipart/form-data' method='post' action='" . var_78 . "?transfer' id='ban_import_form' >
					<fieldset id='core-banlist-transfer-import'>
						<legend>" . var_79 . "</legend>
						<table class='table adminlist'>
							<colgroup>
								<col style='width:30%' />
								<col style='width:30%' />
								<col style='width:40%' />
							</colgroup>
							<tbody>
								<tr>
									<th colspan='2'>" . var_80 . "</th>
									<th>&nbsp;</th>
								</tr>
								<tr>
									<td colspan='3'>" . $var_43->checkbox('ban_over_import', 1, '', array('label' => var_81)) . "</td>
								</tr>
								<tr>
									<td colspan='3'>" . $var_43->checkbox('ban_over_expiry', 1, '', array('label' => var_82)) . "</td>
								</tr>
								<tr>
									<td>" . var_83 . "</td>
									<td colspan='2'>
										" . $var_43->file('file_userfile[]', array('size' => '40')) . "
									</td>
								</tr>
								<tr>
				<td>" . var_85 . "</td>
				<td>" . $var_43->select('ban_separator', $var_41) . ' ' . var_73 . "</td>
				<td>" . $var_43->select('ban_quote', $var_42) . ' ' . var_74 . "</td></tr>
					</tbody>
						</table>
						<div class='buttons-bar center'>
						" . $var_43->admin_button('ban_import', var_86, 'import') . $var_43->token(). "
						</div>
	
	
					</fieldset>
				</form>
			";

			return $var_44->render() . $var_62;
		}
		
	
		
		private function fn_0()
		{


			$var_40 = new class_2;
			$var_89 = e107::getParser();
			$var_90 = false;

			$var_91 = array();

			$var_92 = $var_40->getValidReasonList();
			foreach ($var_40->getValidReasonList() as $var_93)
			{
				$var_67 = abs($var_93) + 1;		
				$var_94 = $var_89->toDB(varset($var_51['ban_text_'.($var_67)],''));
				$var_96 = intval(varset($var_51['ban_time_'.($var_67)],0));
				if (!isset($var_91['ban_messages'][$var_93]) || ($var_91['ban_messages'][$var_93] != $var_94))
				{
					$var_91['ban_messages'][$var_93] = $var_94;
					$var_90 = TRUE;
				}
				if (!isset($var_91['ban_durations'][$var_93]) || ($var_91['ban_durations'][$var_93] != $var_96))
				{
					$var_91['ban_durations'][$var_93] = $var_96;
					$var_90 = TRUE;
				}
			}

			if ($var_90 && !empty($var_91))
			{
			
				e107::getConfig()->setPref($var_91)->save(); 
			
				
				$var_40->writeBanMessageFile();
				fn_2('08','');
				
			
			}	
			
			
		}



		
		protected function fn_3()
		{
			if (!getperms('0'))
			{
				return;
			}
			
			$var_91 = e107::getPref();
			$var_89 = e107::getParser();		
			$var_43 = e107::getForm();
			$var_44 = e107::getMessage();
			
			$var_40 = new class_2;
						
			$var_62 = '';
			if ((!isset($var_91['ban_messages'])) || !is_array($var_91['ban_messages']))
			{
				foreach ($var_40->getValidReasonList() as $var_93)
				{
					$var_91['ban_messages'][$var_93] = '';
				}
			}
			if ((!isset($var_91['ban_durations'])) || !is_array($var_91['ban_durations']))
			{
				foreach ($var_40->getValidReasonList() as $var_93)
				{
					$var_91['ban_durations'][$var_93] = 0;
				}
			}
	
			$var_62 .= "
				<form method='post' action='".var_78.'?'.var_100."' id='ban_options'>
					<fieldset id='core-banlist-times'>
						<legend class='e-hideme'>".var_101."</legend>
						<table class='table adminlist'>
							<colgroup>
								<col style='width: 20%' />
								<col style='width: 65%' />
								<col style='width: 15%' />
							</colgroup>
							<thead>
								<tr>
									<th>".var_102."</th>
									<th>".var_103."<br />".var_104."</th>
									<th class='center last'>".var_105."</th>
								</tr>
							</thead>
							<tbody>
			";
			foreach ($var_40->getValidReasonList() as $var_93)
			{
				$var_67 = abs($var_93) + 1;		
				$var_62 .= "
						<tr>
							<td>
								<strong>".$var_40->getBanTypeString($var_93, FALSE)."</strong>
								<div class='field-help'>".$var_40->getBanTypeString($var_93, TRUE)."</div>
							</td>
							<td class='left'>
								".$var_43->textarea('ban_text_'.($var_67), $var_91['ban_messages'][$var_93], 4, 120, array('size'=>'xxlarge'))."
							</td>
							<td class='center'>".fn_15('', var_107, $var_91['ban_durations'][$var_93], 'ban_time_'.($var_67))."</td>
						</tr>
					";
			}
			$var_62 .= "
							</tbody>
						</table>
						<div class='buttons-bar center'>
							".$var_43->admin_button('update_ban_prefs', var_108, 'update')."
							<input type='hidden' name='e-token' value='".var_77."' />
						</div>
					</fieldset>
				</form>
				";
	
			 
		}		


		private function fn_4($var_110, $var_111)
		{
			$var_43 = e107::getForm();

			$var_112 = array(50, 100, 150, 200, 250, 300, 400, 500);
			$var_113 = $var_43->select_open($var_110, array('class' => 'tbox'));
			foreach ($var_112 as $var_115)
			{
				$var_113 .= $var_43->option($var_115, $var_115, ($var_111 == $var_115));
			}
			$var_113 .= "</select>\n";
			return $var_113;
		}

		
		protected function fn_5()
		{
			if (!getperms('0'))
			{
				exit();
			}

			$var_44 = e107::getMessage();
			$var_89 = e107::getParser();
			$var_117 = e107::getDb();
			$var_43 = e107::getForm();
			$var_91 = e107::getPref();


			if (isset($var_51['update_ban_options']))
			{
				$var_91['enable_rdns']            = intval($var_51['ban_rdns_on_access']);
				$var_91['enable_rdns_on_ban']     = intval($var_51['ban_rdns_on_ban']);
				$var_91['ban_max_online_access']  = intval($var_51['ban_access_guest']).','.intval($var_51['ban_access_member']);
				$var_91['ban_retrigger']          = intval($var_51['ban_retrigger']);
				$var_91['ban_date_format']        = $var_89->toDB($var_51['ban_date_format']);

				e107::getConfig()->setPref($var_91)->save(true,true,true);
			}

			if (isset($var_51['remove_expired_bans']))
			{
				$var_118 = $var_117->delete('banlist',"`banlist_bantype` < ".var_120::var_121." AND `banlist_banexpires` > 0 AND `banlist_banexpires` < ".time());
				fn_2('12', $var_118);
				$var_44->addSuccess(str_replace('[y]', $var_118, var_123));
			}

			list($var_124, $var_125) = explode(',', varset($var_91['ban_max_online_access'], '100,200'));
			$var_125 = max($var_124, $var_125);


			$var_62 = "
				<form method='post' action='".var_78."?mode=main&action=options'>
					<fieldset id='core-banlist-options'>
						<legend>".var_126."</legend>
						<table class='table adminform'>
							<colgroup>
								<col class='col-label' />
								<col class='col-control' />
							</colgroup>
							<tbody>
								<tr>
									<td>".var_127."</td>
									<td>
										<div class='auto-toggle-area autocheck'>
											".$var_43->checkbox('ban_rdns_on_access', 1, $var_91['enable_rdns'] == 1)."
											<div class='field-help'>".var_128."</div>
										</div>
									</td>
								</tr>
								<tr>
									<td>".var_129."</td>
									<td>
										<div class='auto-toggle-area autocheck'>
											".$var_43->checkbox('ban_rdns_on_ban', 1, $var_91['enable_rdns_on_ban'] == 1)."
											<div class='field-help'>".var_130."</div>
										</div>
									</td>
								</tr>
								<tr>
									<td>".var_131."</td>
									<td>
										<div class='field-spacer'>".$var_26->fn_4('ban_access_guest', $var_124).var_132."</div>
										<div class='field-spacer'>".$var_26->fn_4('ban_access_member', $var_125).var_133."</div>
										<div class='field-help'>".var_134."</div>
									</td>
								</tr>
								<tr>
									<td>".var_135."</td>
									<td>
										<div class='auto-toggle-area autocheck'>
											".$var_43->checkbox('ban_retrigger', 1, $var_91['ban_retrigger'] == 1)."
											<div class='field-help'>".var_136."</div>
										</div>
									</td>
								</tr>
	
								<tr>
								  <td>".var_137."</td>
								  <td>
								  ".$var_43->text('ban_date_format', varset($var_91['ban_date_format'], '%H:%M %d-%m-%y'), 40)."
								  <div class='field-help'>".var_138."</div>
								  </td>
								</tr>
							</tbody>
						</table>
						<div class='buttons-bar center'>
							".$var_43->admin_button('update_ban_options', var_108, 'update')."
							<input type='hidden' name='e-token' value='".var_77."' />
						</div>
					</fieldset>
					<fieldset id='core-banlist-options-ban'>
						<legend>".var_139."</legend>
						<table class='table adminform'>
							<colgroup>
								<col class='col-label' />
								<col class='col-control' />
							</colgroup>
							<tbody>
								<tr>
									<td>".var_140."</td>
									<td>
										".$var_43->admin_button('remove_expired_bans', var_141, 'delete')."
										<input type='hidden' name='e-token' value='".var_77."' />
									</td>
								</tr>
							</tbody>
						</table>
					</fieldset>
				</form>
			";

			return $var_62;
		}				

		protected function fn_6()
		{
			
		}	

}
				


class class_3 extends var_142
{

	
	function fn_7($var_144,$var_145) 
	{

		switch($var_145)
		{
			case 'read': 

				break;

			case 'write': 
				return $var_26->renderElement('banlist_reason', $var_144, array());
				break;

			case 'filter':
			case 'batch':

				break;
		}
	}

	
	function fn_1($var_144,$var_145) 
	{

		if(!empty($var_144))
		{
			$var_147 = explode(":",$var_144);

			if(count($var_147) === 8)
			{
				$var_144 = e107::getIPHandler()->ipDecode($var_144);
			}
		}

		switch($var_145)
		{
			case 'read': 
				return $var_144;
				break;

			case 'write': 

				return $var_26->text('banlist_ip', $var_144, array());
				break;

			case 'filter':
			case 'batch':

				break;
		}
	}

	
	
	function fn_8($var_144,$var_145)
	{
	
		$var_40 = new class_2;
		
		
		 		
		switch($var_145)
		{
			case 'read': 
				return "<div class='nowrap' title='".$var_40->getBanTypeString($var_144, TRUE)."'>".$var_40->getBanTypeString($var_144, FALSE)."</div>";					
			break;
			
			case 'write': 

				if ($var_26->getController()->getMode() == 'white')
				{
					return $var_26->hidden('banlist_bantype',var_120::var_121)."<span class='label label-success'>".var_152."</span>";
				}
				elseif($var_26->getController()->getAction() == 'create')
				{
					return $var_26->hidden('banlist_bantype',var_120::var_153)."<span class='label label-important label-danger'>".var_154."</span>";
				}



				return $var_26->selectbox('banlist_bantype',$var_40->var_156, $var_144);
			break;
			
			case 'filter':
			case 'batch':
				return  $var_40->var_156; 
			break;
		}
	}

	
	
	function fn_9($var_144,$var_145)
	{
		
		$var_91 = e107::getPref();
		$var_158 = e107::getDate();
		$var_112 = $var_26->banexpires();
			 		
		switch($var_145)
		{
			case 'read': 
				$var_36 = $var_26->getController()->getListModel()->get('banlist_ip');
			
			
				
				$var_162 = vartrue($var_144) ? $var_158->computeLapse(time(), $var_144) : var_164;

				$var_162 = str_replace("ago", "", $var_162); 
				
				if(vartrue($var_144) && $var_144 < time())
				{
					$var_162 = 	var_165;
				}
									
				$var_166 = str_replace('"',"'",json_encode($var_112));
				return "<a class='e-tip e-editable' data-name='banlist_banexpires' data-source=\"".$var_166."\"  data-type='select' data-pk='".$var_36."' data-url='".var_78."?mode=&amp;action=inline&amp;id={$var_36}&amp;ajax_used=1' href='
				
			break;
			
			case 'write': 
				if(!empty($var_144))
				{
					$var_112[$var_144] = e107::getParser()->toDate($var_144, 'short');
				}

				return $var_26->var_155('banlist_banexpires',$var_112, $var_144);
				
			break;
			
			case 'filter':
			case 'batch':
				return  false;
			break;
		}
	}


	function banexpires()
	{
		$var_167 = array(0, 1, 2, 3, 6, 8, 12, 24, 36, 48, 72, 96, 120, 168, 336, 672);

		$var_112 = array();

		foreach ($var_167 as $var_67)
		{
			$var_168 = "";
			
			if ($var_67 == 0)
			{
				$var_112[$var_67]  = var_164;
				continue;
			}
			elseif (($var_67 % 24) == 0 && $var_67 !== 24)
			{
				$var_168 = floor($var_67 / 24).' '.var_169;
			}
			else
			{
				$var_168 = $var_67.' '.var_170;
			}
			
			$var_171 = time() + ($var_67 * 60 * 60);
			
			$var_112[$var_171] = $var_168; 
		}
	
		return $var_112;		
	}

}




	class class_4 extends var_16
	{

		protected $var_17		= var_14;
		protected $var_172		= 'failed_login';
		protected $var_19			= 'generic';
		protected $var_20				= 'gen_id';
		protected $var_21 			= 10;
		protected $var_22			= "SELECT * FROM `
		protected $var_23        = "var_173 var_174";

		protected $var_24 		= array (  'checkboxes' =>   array ( 'title' => '', 'type' => null, 'data' => null, 'width' => '5%', 'thclass' => 'center', 'forced' => '1', 'class' => 'center', 'toggle' => 'e-multiselect',  ),
		                                    'gen_id' 				=> array ( 'title' => var_175,	 'nolist'=>true,	'data' => 'int', 'width' => '5%', 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left',  ),
			
		                                    'gen_datestamp' 		=> array ( 'title' => var_176, 'type' => 'datestamp', 'data' => 'int', 'width' => 'auto', 'filter' => true, 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left',  ),
		                                    'gen_chardata' 		=> array ( 'title' => var_177, 'type' => 'method', 'data' => 'str', 'width' => '40%', 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left', 'filter'=>true ),

			
		                                    'gen_ip' 				=> array ( 'title' => var_178, 'type' => 'ip', 'data' => 'str', 'width' => 'auto', 'help' => '', 'readParms' => '', 'writeParms' => '', 'class' => 'left', 'thclass' => 'left',  ),
			
		                                    'options'				=> array ( 'title' => var_11, 'type' => null, 'data' => null, 'width' => '10%', 'thclass' => 'center last', 'class' => 'center last', 'forced' => '1', 'readParms'=>'edit=0'  ),
		);

		protected $var_25 = array('gen_datestamp', 'gen_ip', 'gen_chardata');

		protected $var_179 = array();

		
		public function fn_10()
		{
			if($var_51['etrigger_batch'] == 'gen_intdata__1' && count($var_51['e-multiselect'])) 
			{
				$var_180 = implode(',',$var_51['e-multiselect']);
				
			}

			$var_181 = e107::getDB()->count('generic', '(*)', "gen_type='failed_login'");

			$var_26->var_179 = array('delete-all'=>str_replace('[x]', $var_181, var_183));

			if(!empty($var_51['etrigger_batch']) && $var_51['etrigger_batch'] == "delete-all")
			{
				$var_26->fn_11();
			}

		
		}

		private function fn_11()
		{

			if(e107::getDB()->delete('generic', "gen_type='failed_login'"))
			{
				e107::getMessage()->addSuccess(var_185);
			}
		}

		public function fn_12($var_186)
		{
			
		}

	}



	class class_5 extends var_142
	{


		
		function fn_13($var_144,$var_145)
		{
			$var_43 = e107::getForm();

			switch($var_145)
			{
				case 'read': 
					return $var_144;
					break;

				case 'write': 
					return $var_43->text('gen_type',$var_144);
					break;

				case 'filter':
				case 'batch':
					return  array(1=>var_187);
					break;
			}
		}


		
		function fn_14($var_144,$var_145)
		{
			$var_43 = e107::getForm();

			switch($var_145)
			{
				case 'read': 
					return str_replace(":::","<br />",$var_144);
					break;

				case 'write': 
					return $var_43->text('gen_chardata',$var_144);
					break;

				case 'filter':
				case 'batch':
					
					break;
			}
		}

	}


	new class_0();

e107::getAdminUI()->runPage();


var_189;







$var_190 = 'banlist';
$var_43 = e107::getForm();


$var_44 = e107::getMessage();

$var_91 = e107::getPref();


if (!isset($var_91['ban_date_format'])) $var_91['ban_date_format'] = '%H:%M %d-%m-%y';

$var_40 = new class_2;


$var_41 = array(1 => ',', 2 => '|');
$var_42 = array(1 => '(none)', 2 => "'", 3 => '"');


$var_191 = 'list';
if (var_100)
{
	$var_147 = explode('-', var_100);		
	$var_191 = $var_147[0];
	$var_192 = varset($var_147[1], '');
	if ($var_192) $var_192 = preg_replace('/[^\w*@\.:]*/', '', urldecode($var_192));
	$var_36 = intval(varset($var_147[2], 0));
	unset($var_147);
}

if($_GET['action']) 
{
	$var_191 = $_GET['action'];	
}





$var_193 = FALSE;
if (isset($var_51['ban_ip']))
{
	$var_51['ban_ip'] = trim($var_51['ban_ip']);
	$var_194 = preg_replace('/[^\w*@\.:]*/', '', urldecode($var_51['ban_ip']));
	if ($var_194 != $var_51['ban_ip'])
	{
		$var_49 = var_195.' '.$var_194;
		
		$var_44->add(var_197, $var_49);
		$var_51['ban_ip'] = $var_194;
	}

	if (isset($var_51['entry_intent']) && (isset($var_51['add_ban']) || isset($var_51['update_ban'])) && $var_51['ban_ip'] != "" && strpos($var_51['ban_ip'], ' ') === false)
	{
		
		if(e107::getIPHandler()->whatIsThis($var_194) == 'ip')
		{
			$var_194 = e107::getIPHandler()->IPencode($var_194, TRUE); 
		}
		$var_200 = array('banlist_ip' => $var_194);
		if (isset($var_51['add_ban']))
		{
			$var_200['banlist_datestamp'] = time();
			if ($var_51['entry_intent'] == 'add') $var_200['banlist_bantype'] = var_120::var_153;		
			if ($var_51['entry_intent'] == 'whadd') $var_200['banlist_bantype'] = var_120::var_121;
		}
		$var_200['banlist_admin'] = var_201;
		$var_200['banlist_reason'] = $var_89->toDB(varset($var_51['ban_reason'], ''));
		$var_200['banlist_notes'] = $var_89->toDB($var_51['ban_notes']);
		if (isset($var_51['ban_time']) && is_numeric($var_51['ban_time']) && (($var_51['entry_intent']== 'edit') || ($var_51['entry_intent'] == 'add')))
		{
			$var_93 = intval($var_51['ban_time']);
			$var_200['banlist_banexpires'] = $var_93 ? time() + ($var_93*60*60) : 0;
		}
		if (isset($var_51['add_ban']))
		{  
			e107::getMessage()->addAuto($var_117->db_Insert('banlist', $var_200), 'insert');
			if ($var_51['entry_intent'] == 'add')
			{
				fn_2('01', $var_200['banlist_ip']);		
			}
			else
			{
				fn_2('04', $var_200['banlist_ip']);		
			}
		}
		else
		{  
			$var_204 = '';
			$var_205 = '';
			foreach ($var_200 as $var_206 => $var_207)
			{
				$var_204 .= $var_205."`{$var_206}`='$var_207'";
				$var_205 = ', ';
			}
			e107::getMessage()->addAuto($var_117->db_Update('banlist', $var_204." WHERE banlist_ip='".$var_51['old_ip']."'"));
			if ($var_51['entry_intent'] == 'edit')
			{
				fn_2('09',$var_200['banlist_ip']);
			}
			else
			{
				fn_2('10',$var_200['banlist_ip']);
			}
		}
		unset($var_209);
		$var_193 = TRUE;
	}
}




if (($var_191 == 'remove' || $var_191 == 'whremove') && isset($var_51['ban_secure'])) 
{
	$var_117->db_Delete('generic', "gen_type='failed_login' AND gen_ip='{$var_192}'");
	e107::getMessage()->addAuto($var_117->db_Delete('banlist', "banlist_ip='{$var_192}'"), 'delete');
	if ($var_191 == "remove")
	{
		$var_191 = 'list';
		fn_2('02', $var_192);
	}
	else
	{
		$var_191 = 'white';
		fn_2('05', $var_192);
	}
	$var_193 = TRUE;
}




if ($var_191 == 'newtime')
{
	$var_211 = $var_36 ? time() + ($var_36*60*60) : 0;
	e107::getMessage()->addAuto($var_117->db_Update('banlist', 'banlist_banexpires='.intval($var_211)." WHERE banlist_ip='".$var_192."'"));
	fn_2('03', $var_192);
	$var_191 = 'list';
	$var_193 = TRUE;
}


if ($var_193)
{

	$var_40->writeBanListFiles('ip,htaccess');
	if (!$var_40->doesMessageFileExist())
	{
		$var_40->writeBanMessageFile();		
		fn_2('08','');
		$var_44->addSuccess(var_214);
	}
}





if ($var_191 == 'edit' || $var_191 == 'whedit')
{
	$var_117->db_Select('banlist', '*', "banlist_ip='{$var_192}'");
	$var_216 = $var_117->db_Fetch();
	extract($var_216);				
}
else
{
	unset($var_37, $var_143);
	if (var_100 && ($var_191 == 'add' || $var_191 == 'whadd') && strpos($_SERVER["HTTP_REFERER"], "userinfo"))
	{
		$var_37 = $var_192;
	}
}




function fn_15($var_218 = '', $var_219 = var_164, $var_111 = -1, $var_220 = 'ban_time')
{
	$var_43 = e107::getForm();
	$var_167 = array(0, 1, 2, 3, 6, 8, 12, 24, 36, 48, 72, 96, 120, 168, 336, 672);

	$var_113 = $var_43->select_open($var_220, array('other' => $var_218, 'id' => false));
	$var_113 .= $var_43->option('&nbsp;', '');
	foreach ($var_167 as $var_67)
	{
		if ($var_67 == 0)
		{
			$var_168 = $var_219 ? $var_219 : var_164;
		}
		elseif (($var_67 % 24) == 0)
		{
			$var_168 = floor($var_67 / 24).' '.var_169;
		}
		else
		{
			$var_168 = $var_67.' '.var_170;
		}
		$var_113 .= $var_43->option($var_168, $var_67, ($var_111 == $var_67));
	}
	$var_113 .= '</select>';
	return $var_113;
}





function fn_16($var_60, $var_186, $var_111 = FALSE)
{
	global $var_43;

	$var_113 = $var_43->select_open($var_60, array('class' => 'tbox', 'id' => false));
	foreach ($var_186 as $var_206 => $var_207)
	{
		$var_113 .= $var_43->option($var_207, $var_206, ($var_111 !== FALSE) && ($var_111 == $var_206));
	}
	$var_113 .= "</select>\n";
	return $var_113;
}




function fn_4($var_110, $var_111)
{
	global $var_43;

	$var_112 = array(50, 100, 150, 200, 250, 300, 400, 500);
	$var_113 = $var_43->select_open($var_110, array('class' => 'tbox'));
	foreach ($var_112 as $var_115)
	{
		$var_113 .= $var_43->option($var_115, $var_115, ($var_111 == $var_115));
	}
	$var_113 .= "</select>\n";
	return $var_113;
}



$var_62 = '';


switch ($var_191)
{
	case 'banlog' :
		if(!getperms('0')) var_189;
		if (isset($var_51['delete_ban_log']))
		{
			$var_49 = ($var_40->deleteLogFile() ? var_222 : var_223);
			e107::getRender()->tablerender(var_225, "<div style='text-align:center; font-weight:bold'>".$var_49."</div>"); 
		}
		$var_226 = 0;
		$var_227 = 20;		
		if ($var_192) $var_226 = intval($var_192);


		$var_62 = "<div style='text-align:center'>
		<form method='post' action='".var_78."?banlog-".$var_226."'>
		<table class='table adminform'>
		<colgroup>
			<col style='width:20%; vertical-align:top;' />
			<col style='width:30%; vertical-align:top;' />
			<col style='width:30%; vertical-align:top;' />
			<col style='width:30%; vertical-align:top;' />
		</colgroup>";

		
		$var_228 = $var_40->getLogEntries($var_226, $var_227, $var_230);
		if (count($var_228) == 0)
		{
		  $var_62 .= "<tbody><tr><td colspan='4'>".var_231."</td></tr>";
		  $var_230 = 0;
		}
		else
		{
			$var_62 .= "<thead><tr><td class='fcaption'>".var_232."</td><td class='fcaption'>".var_233."</td>
				<td class='fcaption'>".var_234."</td><td class='fcaption'>".var_235."</td></tr></thead><tbody>";
			foreach ($var_228 as $var_236)
			{
				$var_216 = $var_40->splitLogEntry($var_236);
				$var_62 .= "
					<tr>
					<td class='forumheader3'>".strftime($var_91['ban_date_format'], $var_216['banDate'])."</td>
					<td class='forumheader3'>".e107::getIPHandler()->ipDecode($var_216['banIP'])."</td>
					<td class='forumheader3'>".$var_40->getBanTypeString($var_216['banReason'], FALSE)."</td>
					<td class='forumheader3'>".$var_216['banNotes']."</td>
					</tr>";
			}  

			
			if ($var_230 > $var_227) 
			{
				$var_238 = "{$var_230},{$var_227},{$var_226},".var_78."?".$var_191.'-[FROM]';
				$var_62 .= "<tr><td colspan='5' style='text-align:center'><br />".$var_89->parseTemplate("{NEXTPREV={$var_238}}".'<br /><br /></td></tr>');
			}
			$var_62 .= "<tr><td colspan='4' style='text-align:center'>
						<input class='btn btn-default btn-secondary button' type='submit' name='delete_ban_log' value='".var_225."' />
						<input type='hidden' name='e-token' value='".var_77."' />
					</td>
					  </tr>";
		}
		$var_62 .= "</tbody></table></form></div>";

		if (count($var_228))
		{
			$var_62 .= "&nbsp;&nbsp;&nbsp;".str_replace('[y]', $var_230, var_240);
		}
		
		 
	
		break;


	case 'options' :
		if (!getperms('0'))
			exit();
		if (isset($var_51['update_ban_options']))
		{
			$var_91['enable_rdns'] = intval($var_51['ban_rdns_on_access']);
			$var_91['enable_rdns_on_ban'] = intval($var_51['ban_rdns_on_ban']);
			$var_91['ban_max_online_access'] = intval($var_51['ban_access_guest']).','.intval($var_51['ban_access_member']);
			$var_91['ban_retrigger'] = intval($var_51['ban_retrigger']);
			$var_91['ban_date_format'] = $var_89->toDB($var_51['ban_date_format']);
			save_prefs();						
			$var_44->addSuccess(var_241);
		}

		if (isset($var_51['remove_expired_bans']))
		{
			$var_118 = $var_117->db_Delete('banlist',"`banlist_bantype` < ".var_120::var_121." AND `banlist_banexpires` > 0 AND `banlist_banexpires` < ".time());
			fn_2('12', $var_118);
			$var_44->addSuccess(str_replace('[y]', $var_118, var_123));
		}

		list($var_124, $var_125) = explode(',', varset($var_91['ban_max_online_access'], '100,200'));
		$var_125 = max($var_124, $var_125);
		$var_62 = "
			<form method='post' action='".var_78."?options'>
				<fieldset id='core-banlist-options'>
					<legend>".var_126."</legend>
					<table class='table adminform'>
						<colgroup>
							<col class='col-label' />
							<col class='col-control' />
						</colgroup>
						<tbody>
							<tr>
								<td>".var_127."</td>
								<td>
									<div class='auto-toggle-area autocheck'>
										".$var_43->checkbox('ban_rdns_on_access', 1, $var_91['enable_rdns'] == 1)."
										<div class='field-help'>".var_128."</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>".var_129."</td>
								<td>
									<div class='auto-toggle-area autocheck'>
										".$var_43->checkbox('ban_rdns_on_ban', 1, $var_91['enable_rdns_on_ban'] == 1)."
										<div class='field-help'>".var_130."</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>".var_131."</td>
								<td>
									<div class='field-spacer'>".fn_4('ban_access_guest', $var_124).var_132."</div>
									<div class='field-spacer'>".fn_4('ban_access_member', $var_125).var_133."</div>
									<div class='field-help'>".var_134."</div>
								</td>
							</tr>
							<tr>
								<td>".var_135."</td>
								<td>
									<div class='auto-toggle-area autocheck'>
										".$var_43->checkbox('ban_retrigger', 1, $var_91['ban_retrigger'] == 1)."
										<div class='field-help'>".var_136."</div>
									</div>
								</td>
							</tr>

							<tr>
							  <td>".var_137."</td>
							  <td>
							  ".$var_43->text('ban_date_format', varset($var_91['ban_date_format'], '%H:%M %d-%m-%y'), 40)."
							  <div class='field-help'>".var_138."</div>
							  </td>
							</tr>
						</tbody>
					</table>
					<div class='buttons-bar center'>
						".$var_43->admin_button('update_ban_options', var_108, 'update')."
						<input type='hidden' name='e-token' value='".var_77."' />
					</div>
				</fieldset>
				<fieldset id='core-banlist-options-ban'>
					<legend>".var_139."</legend>
					<table class='table adminform'>
						<colgroup>
							<col class='col-label' />
							<col class='col-control' />
						</colgroup>
						<tbody>
							<tr>
								<td>".var_140."</td>
								<td>
									".$var_43->admin_button('remove_expired_bans', var_141, 'delete')."
									<input type='hidden' name='e-token' value='".var_77."' />
								</td>
							</tr>
						</tbody>
					</table>
				</fieldset>
			</form>
		";
		
		 
		
	
		break;

	case 'times' :

			
	
		break;

	case 'edit' :		
	case 'add' :		
	case 'whedit' :		
	case 'whadd' :		
	
		if(!var_242)
		{
			break;	
		}
		RETURN;
	
		if (!isset($var_143)) $var_143 = '';
		if (!isset($var_37)) $var_37 = '';
		if (!isset($var_243)) $var_243 = '';

		$var_244 = array('edit' => var_245, 'add' => var_246, 'whedit' => var_247, 'whadd' => var_248);
		$var_249 = vartrue($var_91['enable_rdns']) ? '' : '<div class="field-help error">'.var_250.'</div>';
		$var_251 = ($var_191 == 'whedit' || $var_191 == 'whadd') ? '?white' : '?list';
		
		$var_62 .= "
			<form method='post' action='".var_78.$var_251."'>
				<fieldset id='core-banlist-edit'>
					<legend class='e-hideme'>".$var_244[$var_191]."</legend>
					<table class='table adminform'>
						<colgroup>
							<col class='col-label' />
							<col class='col-control' />
						</colgroup>
						<tbody>
							<tr>
								<td>
									".var_252.":
									<div class='label-note'>
										".var_253."<a href='".var_63."users.php'>".var_254."</a>
									</div>
								</td>
								<td>
									<input type='hidden' name='entry_intent' value='{$var_191}' />
									".$var_43->text('ban_ip', e107::getIPHandler()->ipDecode($var_37), 200)."
									{$var_249}
								</td>
							</tr>
		";

		if (($var_191 == 'add') || ($var_191 == 'whadd') || ($var_149 <= 1) || ($var_149 >= var_120::var_121))
		{ 
			$var_62 .= "
							<tr>
								<td>".var_234.": </td>
								<td>
									".$var_43->textarea('ban_reason', $var_143, 4, 50)."
								</td>
							</tr>
			";
		}
		elseif ($var_191 == 'edit')
		{
			$var_62 .= "
							<tr>
								<td>".var_234.": </td>
								<td>{$var_143}</td>
							</tr>
			";
		}

		if ($var_191 == 'edit')
		{
			$var_62 .= "
							<tr>
								<td>".var_102.": </td>
								<td>".$var_40->getBanTypeString($var_149, FALSE)." - ".$var_40->getBanTypeString($var_149, TRUE)."</td>
							</tr>
			";
		}

		$var_62 .= "
							<tr>
								<td>".var_255.": </td>
								<td>
									".$var_43->textarea('ban_notes', $var_243, 4, 50)."
								</td>
							</tr>
		";

		if ($var_191 == 'edit' || $var_191 == 'add')
		{
			$var_256 = (($var_191 == 'edit') ? '<div class="field-help">'.var_257.($var_157 ? strftime($var_91['ban_date_format'], $var_157) : var_164).'</div>' : '');

			$var_62 .= "
							<tr>
								<td>".var_258.": </td>
								<td>".fn_15().$var_256."</td>
							</tr>
			";
		}

		$var_62 .= "
						</tbody>
					</table>
					<input type='hidden' name='e-token' value='".var_77."' />
					<div class='buttons-bar center'>

		";

		

		if ($var_191 == 'edit' || $var_191 == 'whedit')
		{
			$var_62 .= "<input type='hidden' name='old_ip' value='{$var_37}' />
				".$var_43->admin_button('update_ban', var_108, 'update');
		}
		else
		{
			$var_62 .= $var_43->admin_button('add_ban', ($var_191 == 'add' ? var_259 : var_7), 'create');
		}

		$var_62 .= "</div>
				</fieldset>
			</form>
		";

		 
	
		break;		


	case 'transfer' :
		$var_49 = '';
		$var_45 = false;
		if (isset($var_51['ban_import']))
		{ 
			if (($var_47 = process_uploaded_files(var_59, FALSE, array('overwrite' => TRUE, 'max_file_count' => 1, 'file_mask' => 'csv'))) === FALSE)
			{ 
				$var_45 = true;
				$var_44->addError(var_260);
			}
			if(empty($var_47) || vartrue($var_47[0]['error']))
			{
				$var_45 = true;
				if(varset($var_47[0]['message']))
					$var_44->addError($var_47[0]['message']);
			}
			if(!$var_45)
			{ 
				$var_49 = process_csv(var_59.$var_47[0]['name'],
										intval(varset($var_51['ban_over_import'], 0)),
										intval(varset($var_51['ban_over_expiry'], 0)),
										$var_41[intval(varset($var_51['ban_separator'], 1))],
										$var_42[intval(varset($var_51['ban_quote'], 3))]);
				fn_2('07', 'File: '.var_59.$var_47[0]['name'].'<br />'.$var_49);
			}

		}

		$var_62 = "
			<form method='post' action='".var_63."banlist_export.php' id='core-banlist-transfer-form' >
				<fieldset id='core-banlist-transfer-export'>
					<legend>".var_64."</legend>
					<table class='table adminlist'>
						<colgroup>
							<col style='width:30%' />
							<col style='width:30%' />
							<col style='width:40%' />
						</colgroup>
						<tbody>
							<tr>
								<th colspan='2'>".var_65."</th>
								<th>&nbsp;</th>
							</tr>
			";


		foreach ($var_40->getValidReasonList() as $var_67) 
		{
			$var_62 .= "
							<tr>
							<td colspan='3'>
								".$var_43->checkbox("ban_types[{$var_67}]", $var_67).$var_43->label($var_40->getBanTypeString($var_67, FALSE), "ban_types[{$var_67}]", $var_67)."
								<span class='field-help'>(".$var_40->getBanTypeString($var_67, TRUE).")</span>
							</td></tr>
			";
		}

		$var_62 .= "<tr>
			<td>".var_71."</td>
			<td>".fn_16('ban_separator', $var_41).' '.var_73."</td>
		<td>".fn_16('ban_quote', $var_42).' '.var_74."</td></tr>";
		$var_62 .= "

						</tbody>
					</table>
					<div class='buttons-bar center'>".$var_43->admin_button('ban_export', var_76, 'export', var_76)."</div>
						<input type='hidden' name='e-token' value='".var_77."' />
				</fieldset>
			</form>
		";

		
		$var_62 .= "
			<form enctype='multipart/form-data' method='post' action='".var_78."?transfer' id='ban_import_form' >
				<fieldset id='core-banlist-transfer-import'>
					<legend>".var_79."</legend>
					<table class='table adminlist'>
						<colgroup>
							<col style='width:30%' />
							<col style='width:30%' />
							<col style='width:40%' />
						</colgroup>
						<tbody>
							<tr>
								<th colspan='2'>".var_80."</th>
								<th>&nbsp;</th>
							</tr>
							<tr>
								<td colspan='3'>".$var_43->checkbox('ban_over_import', 1, '', array('label' => var_81))."</td>
							</tr>
							<tr>
								<td colspan='3'>".$var_43->checkbox('ban_over_expiry', 1, '', array('label' => var_82))."</td>
							</tr>
							<tr>
								<td>".var_83."</td>
								<td colspan='2'>
									".$var_43->file('file_userfile[]', array('size' => '40'))."
								</td>
							</tr>
							<tr>
			<td>".var_85."</td>
			<td>".fn_16('ban_separator', $var_41).' '.var_73."</td>
		<td>".fn_16('ban_quote', $var_42).' '.var_74."</td></tr>
						</tbody>
					</table>
								<div class='buttons-bar center'>
								".$var_43->admin_button('ban_import', var_86, 'import')."
								<input type='hidden' name='e-token' value='".var_77."' />
								</div>


				</fieldset>
			</form>
		";

		 
	
		break;		

	case 'list' :
	case 'white' :
	default :
		
		if(!var_242)
		{
			break;	
		}
		
		if (($var_191 != 'list') && ($var_191 != 'white'))
			$var_191 = 'list';

		$var_261 = ($var_191 == 'list' ? 'edit' : 'whedit');
		$var_262 = ($var_191 == 'list' ? 'remove' : 'whremove');
		$var_263 = array('list' => array(10, 5, 35, 30, 10, 10), 'white' => array(15, 40, 35, 10));
		$var_264 = array('list' => array(var_265, var_266, var_267, var_255, var_258, var_11),
							'white' => array(var_268, var_269, var_255, var_11));
		$var_270 = array('list' => var_271, 'white' => var_272);
		$var_273 = array('list' => array('banlist_datestamp' => 0, 'banlist_bantype' => 0, 'ip_reason' => var_234, 'banlist_notes' => 0, 'banlist_banexpires' => 0, 'ban_options' => 0),
						'white' => array('banlist_datestamp' => 0, 'ip_reason' => var_274, 'banlist_notes' => 0, 'ban_options' => 0));

		$var_62 = "
			<form method='post' action='".var_78.'?'.$var_191."' id='core-banlist-form'>
				<fieldset id='core-banlist'>
					<legend class='e-hideme'>".($var_191 == 'list' ? var_275 : var_276)."</legend>
					".$var_43->hidden("ban_secure", "1")."
		";

		$var_277 = ($var_191 == 'white') ? 'banlist_bantype='.var_120::var_121 : 'banlist_bantype!='.var_120::var_121;


		if(!$var_278 = $var_117->db_Select("banlist", "*", $var_277." ORDER BY banlist_ip"))
		{
			
			$var_44->addInfo($var_270[$var_191]);
		}
		else
		{
			$var_62 .= "
					<table class='table adminlist'>
						<colgroup>
			";
			foreach($var_263[$var_191] as $var_280)
			{
				$var_62 .= "
								<col style='width:{$var_280}%' />
				";
			}
			$var_62 .= "
						</colgroup>
						<thead>
							<tr>
			";
			$var_281 = 0;
			foreach($var_264[$var_191] as $var_282)
			{
				$var_281 ++;
				$var_62 .= "<th".(($var_281 == count($var_263[$var_191])) ? " class='center last'" : "").">{$var_282}</th>";
			}
			$var_62 .= "</tr>
						</thead>
						<tbody>";
			while($var_216 = $var_117->db_Fetch())
			{
				
				$var_216['banlist_reason'] = str_replace('LAN_LOGIN_18', var_283, $var_216['banlist_reason']);
				$var_62 .= "<tr>";
				foreach($var_273[$var_191] as $var_284 => $var_285)
				{
					$var_286 = '';
					switch($var_284)
					{
						case 'banlist_datestamp':
							$var_162 = ($var_216['banlist_datestamp'] ? strftime($var_91['ban_date_format'], $var_216['banlist_datestamp']) : var_287);
							break;
						case 'banlist_bantype':
							$var_162 = "<div class='nowrap' title='".$var_40->getBanTypeString($var_216['banlist_bantype'], TRUE)."'>".$var_40->getBanTypeString($var_216['banlist_bantype'], FALSE)." <a href='
							break;
						case 'ip_reason':
							$var_162 = e107::getIPHandler()->ipDecode($var_216['var_37'])."<var_61 />".$var_285.": ".$var_216['banlist_reason'];
							break;
						case 'banlist_banexpires':
							$var_162 = ($var_216['banlist_banexpires'] ? strftime($var_91['ban_date_format'], $var_216['banlist_banexpires']).(($var_216['banlist_banexpires'] < time()) ? ' ('.var_165.')' : '') : var_164)."<br />".fn_15("onchange=\"e107Helper.urlJump('".var_78."?newtime-{$var_216['banlist_ip']}-'+this.value)\"");
							break;
						case 'ban_options':
							$var_286 = ' class="center"';
							$var_162 = "
							<a class='action edit' href='".var_78."?{$var_261}-{$var_216['banlist_ip']}'>".var_288."</a>
<input class='action delete no-confirm' name='delete_ban_entry' value='".var_78."?{$var_262}-{$var_216['banlist_ip']}' type='image' src='".var_289."' alt='".var_290."' title='".$var_89->toJS(var_292." [".e107::getIPHandler()->ipDecode($var_216['banlist_ip'])."]")."' />";
							break;
						case 'banlist_notes':
						default:
							$var_162 = $var_216[$var_284];
					}

					$var_62 .= "<td{$var_286}>{$var_162}</td>";
				}
				$var_62 .= '</tr>';
			}
			$var_62 .= "</tbody>
					</table>
					<script type='text/javascript'>
					(function () {
						var del_sel = \$\$('input[name=delete_ban_entry]');
						del_sel.each(function (element) {
							var msg = element.readAttribute('title');
							element.writeAttribute('title', '".var_290."').writeAttribute('confirm-msg', msg);
						});
						del_sel.invoke('observe', 'click', function (event) {

							var element = event.element(), msg = element.readAttribute('confirm-msg');
							if(!e107Helper.confirm(msg)) { event.stop(); return; }
							\$('core-banlist-form').writeAttribute('action', element.value).submit();
						});
					}())
					</script>
			";
		}
		$var_62 .= "
				</fieldset>
			</form>
		";

		 
	
		
}		





function fn_17()
{
	$var_191 = (var_100) ? var_100 : 'list';

	$var_297['list']['text'] = var_293;		
	$var_297['list']['link'] = var_78.'?list';
	$var_297['list']['perm'] = '4';

	$var_297['add']['text'] = var_294;		
	$var_297['add']['link'] = var_78.'?add';
	$var_297['add']['perm'] = '4';

	$var_297['white']['text'] = var_6;		
	$var_297['white']['link'] = var_78.'?white';
	$var_297['white']['perm'] = '4';

	$var_297['whadd']['text'] = var_7;		
	$var_297['whadd']['link'] = var_78.'?whadd';
	$var_297['whadd']['perm'] = '4';

	$var_297['transfer']['text'] = var_9;
	$var_297['transfer']['link'] = var_78.'?transfer';
	$var_297['transfer']['perm'] = '4';

	if (getperms('0'))
	{
		$var_297['times']['text'] = var_10;
		$var_297['times']['link'] = var_78.'?times';
		$var_297['times']['perm'] = '0';

		$var_297['options']['text'] = var_11;
		$var_297['options']['link'] = var_78.'?options';
		$var_297['options']['perm'] = '0';

		$var_297['banlog']['text'] = var_295;
		$var_297['banlog']['link'] = var_78.'?banlog';
		$var_297['banlog']['perm'] = '0';
	}
	e107::getNav()->admin(var_14, $var_191, $var_297);
}




function fn_18($var_298)
{
	if (strlen($var_298) != 15)
		return 0;
	return mktime(substr($var_298, 9, 2), substr($var_298, 11, 2), substr($var_298, 13, 2), substr($var_298, 4, 2), substr($var_298, 6, 2), substr($var_298, 0, 4));
}





function var_299($var_300, $var_301, $var_302, $var_303 = ',', $var_304 = '"')
{
	$var_117 = e107::getDb();
	$var_91['ban_durations'] = e107::getPref('ban_durations');
	$var_44 = e107::getMessage();
	
	
	
	if ($var_301)
		$var_117->db_Update('banlist', "`banlist_bantype`=".var_120::var_305." WHERE `banlist_bantype` = ".var_120::var_306);
	$var_307 = file($var_300);
	$var_308 = 0;
	foreach ($var_307 as $var_309)
	{ 
		$var_309 = trim($var_309);
		$var_308++;
		if ($var_309)
		{
			$var_24 = explode($var_303, $var_309);
			$var_310 = 0;
			$var_311 = array('banlist_bantype' => var_120::var_306);
			foreach ($var_24 as $var_312)
			{
				$var_312 = trim($var_312);
				if (substr($var_312, 0, 1) == $var_304)
				{
					if (substr($var_312, -1, 1) == $var_304)
					{ 
						$var_312 = substr($var_312, 1, -1);		
					}
					else
					{
						$var_44->addError(var_313.$var_308);
						return var_313.$var_308;
					}
				}
				
				$var_310++;
				switch ($var_310)
				{
					case 1 :	
						$var_311['banlist_ip'] = e107::getIPHandler()->ipEncode($var_312);
						break;
					case 2 :	
						$var_311['banlist_datestamp'] = fn_18($var_312);
						break;
					case 3 :	
						if ($var_302)
						{
							$var_311['banlist_banexpires'] = fn_18($var_312);
						}
						else
						{ 
							$var_311['banlist_banexpires'] = $var_91['ban_durations'][var_120::var_306] ? time() + (3600*$var_91['ban_durations'][var_120::var_306]) : 0;
						}
						break;
					case 4 :	
						break;
					case 5 :	
						$var_311['banlist_reason'] = $var_312;
						break;
					case 6 :	
						$var_311['banlist_notes'] = $var_312;
						break;
					default :	
				}
			}
			$var_204 = "REPLACE INTO `
			
			if (!$var_117->var_315($var_204))
			{
				$var_44->var_48(BANLAN_50.$var_308);
				return BANLAN_50.$var_308;
			}
		}
	}
	
	if ($var_301)
		$var_117->var_210('banlist', "`var_149` = ".var_120::var_305);
	@unlink($var_300);		
	$var_44->var_122(str_replace('[y]', $var_308, var_316).$var_300);
	return str_replace('[y]', $var_308, var_316).$var_300;
}




function fn_2($var_317 = '00', $var_318 = '')
{
	e107::getAdminLog()->log_event('BANLIST_'.$var_317, $var_318, var_320, '');
}



function fn_19()
{

}

var_189;
?>
