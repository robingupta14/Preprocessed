<?php


function fn_0(&$var_0, $var_1, $var_2, $var_3 = false) {
	global $var_4, $var_5, $var_6, $var_7, $var_8, $var_9;


	$var_10    = array();
	$var_11 = array();

	$var_12 = xml2array($var_0);

	if (cacti_sizeof($var_12) == 0) {
		raise_message(7); 
		return $var_10;
	}

	foreach ($var_12 as $var_13 => $var_14) {
		
		$var_15 = fn_15($var_13);

		
		if ($var_15 == false) {
			return $var_10;
		}

		if (isset($dep_hash_cache[$var_15['type']])) {
			array_push($dep_hash_cache[$var_15['type']], $var_15);
		} else {
			$dep_hash_cache[$var_15['type']] = array($var_15);
		}
	}

	

	
	$var_16 = array();
	$var_17 = array(
		'graph_template' => array(
			'table' => 'graph_templates',
		),
		'graph_template_item' => array(
			'table' => 'graph_templates_item',
		),
		'graph_template_input' => array(
			'table' => 'graph_template_input',
		),
		'data_template' => array(
			'table' => 'data_template',
		),
		'data_template_item' => array(
			'table' => 'data_template_rrd',
		),
		'host_template' => array(
			'table' => 'host_template',
		),
		'data_input_method' => array(
			'table' => 'data_input',
		),
		'data_input_field' => array(
			'table' => 'data_input_fields',
		),
		'data_query' => array(
			'table' => 'snmp_query',
		),
		'data_query_graph' => array(
			'table' => 'snmp_query_graph',
		),
		'data_query_sv_graph' => array(
			'table' => 'snmp_query_graph_sv',
		),
		'data_query_sv_data_source' => array(
			'table' => 'snmp_query_graph_rrd_sv',
		),
		'gprint_preset' => array(
			'table' => 'graph_templates_gprint',
		),
		'cdef' => array(
			'table' => 'cdef',
		),
		'cdef_item' => array(
			'table' => 'cdef_items',
		),
		'vdef' => array(
			'table' => 'vdef',
		),
		'vdef_item' => array(
			'table' => 'vdef_items',
		),
		'data_source_profiles' => array(
			'table' => 'data_source_profiles',
		),
		'data_source_profile_rra' => array(
			'table' => 'data_source_profiles_rra',
			'hash_field' => 'name',
		),
	);
	$var_18 = array();

	foreach ($var_17 as $var_19 => $var_20) {
		$var_21 = (
			isset($var_20['id_field'])
			? $var_20['id_field']
			: 'id'
		);
		$var_22 = (
			isset($var_20['hash_field'])
			? $var_20['hash_field']
			: 'hash'
		);
		$var_23 = $var_20['table'];
		$var_18[] = "
			SELECT
				'$var_19' AS type,
				`$var_21` AS id,
				`$var_22` AS hash
			FROM
				`$var_23`
		";
	}

	$var_24 = implode(' UNION ALL ', $var_18);
	$var_25 = db_fetch_assoc($var_24);
	if (cacti_sizeof($var_25)) {
		foreach ($var_25 as $var_26) {
			$var_16[$var_26['type']][$var_26['hash']] = $var_26['id'];
		}
	}

	$var_27 = 0;

	
	foreach ($var_5 as $var_28 => $var_29) {
		
		if (isset($dep_hash_cache[$var_28])) {
			
			for ($var_30=0; $var_30<cacti_count($dep_hash_cache[$var_28]); $var_30++) {
				$var_8 = false;

				if (!isset($var_6[$dep_hash_cache[$var_28][$var_30]['version']])) {
					return false;
				}

				cacti_log('$dep_hash_cache[$type][$i][\'type\']: ' . $dep_hash_cache[$var_28][$var_30]['type'], false, 'IMPORT', var_31);
				cacti_log('$dep_hash_cache[$type][$i][\'version\']: ' . $dep_hash_cache[$var_28][$var_30]['version'], false, 'IMPORT', var_31);
				cacti_log('$cacti_version_codes[$dep_hash_cache[$type][$i][\'version\']]: ' . $var_6[$dep_hash_cache[$var_28][$var_30]['version']], false, 'IMPORT', var_31);
				cacti_log('$dep_hash_cache[$type][$i][\'hash\']: ' . $dep_hash_cache[$var_28][$var_30]['hash'], false, 'IMPORT', var_31);

				if (isset($var_12['hash_' . $var_5[$dep_hash_cache[$var_28][$var_30]['type']] . $var_6[$dep_hash_cache[$var_28][$var_30]['version']] . $dep_hash_cache[$var_28][$var_30]['hash']])) {
					$var_14 = $var_12['hash_' . $var_5[$dep_hash_cache[$var_28][$var_30]['type']] . $var_6[$dep_hash_cache[$var_28][$var_30]['version']] . $dep_hash_cache[$var_28][$var_30]['hash']];
				} elseif (isset($var_12['hash_' . $var_5[$dep_hash_cache[$var_28][$var_30]['type']] . $dep_hash_cache[$var_28][$var_30]['hash']])) {
					$var_14 = $var_12['hash_' . $var_5[$dep_hash_cache[$var_28][$var_30]['type']] . $dep_hash_cache[$var_28][$var_30]['hash']];
				} else {
					raise_message(7); 
					return false;
				}

				switch($var_28) {
				case 'graph_template':
					$var_16 += fn_3($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16, $dep_hash_cache[$var_28][$var_30]['version'], $var_3);
					break;
				case 'data_template':
					$var_16 += fn_4($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16, $var_1, $var_2);
					$var_27++;
					break;
				case 'host_template':
					$var_16 += fn_8($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16);
					break;
				case 'data_input_method':
					$var_16 += fn_11($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16);
					$var_27++;
					break;
				case 'data_query':
					$var_16 += fn_5($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16);
					break;
				case 'gprint_preset':
					$var_16 += fn_6($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16);
					break;
				case 'cdef':
					$var_16 += fn_9($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16);
					break;
				case 'vdef':
					$var_16 += fn_10($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16);
					break;
				case 'data_source_profile':
					$var_32 = fn_7($dep_hash_cache[$var_28][$var_30]['hash'], $var_14, $var_16, $var_1, $var_2);
					if ($var_32 !== false) {
						$var_16 += $var_32;
					}
					break;
				case 'round_robin_archive':
					
					break;
				default:
					$var_33 = array();
					$var_33['hash']       = $dep_hash_cache[$var_28][$var_30]['hash'];
					$var_33['xml_array']  = $var_14;
					$var_33['hash_cache'] = $var_16;
					$var_33['type']       = $var_28;
					$var_33['version']    = $dep_hash_cache[$var_28][$var_30]['version'];
					$var_33 = api_plugin_hook_function('import_action', $var_33);
					$var_16 += $var_33['hash_cache'];
					break;
				}

				if (!empty($var_8)) {
					$var_10[$var_28][isset($var_10[$var_28]) ? cacti_count($var_10[$var_28]) : 0] = $var_8;
				}
			}
		}
	}

	if ($var_27) {
		repair_system_data_input_methods();
	}

	return $var_10;
}

function fn_1() {
$var_34 = <<<EOD
-----BEGIN PUBLIC KEY-----
MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAMbPpuQfwmg93oOGjdLKrAqwEPwvvNjC
bk2YZiDglh8lQJxNQI9glG1Z/ptvqprFO3iSx9rTP4vzZ0Ek2+EMYTMCAwEAAQ==
-----END PUBLIC KEY-----
EOD;

    return $var_34;
}

function fn_2($var_35, $var_2 = 1, $var_3 = false, $var_36 = false, $var_37 = false, $var_38 = true) {
	global $var_4, $var_7;

	$var_7 = $var_36;

	@ini_set('zlib.output_compression', '0');

	
	if ($var_38) {
		ini_set('max_execution_time', '50');
		ini_set('memory_limit', '-1');
	}

	$var_34 = fn_1();

	$var_39         = "compress.zlib:
	$var_40 = '';
	$var_41       = array();

	$var_42   = fopen($var_39, 'r');
	$var_43 = '';

	if (is_resource($var_42)) {
		while (!feof($var_42)) {
			$var_44 = fgets($var_42);

			if (strlen($var_44) == 0) {
				cacti_log('FATAL: Unable to read Cacti Package ' . $var_39, true, 'IMPORT', POLLER_VERBOSITY_LOW);
				fclose($var_42);
				return false;
			} elseif (strpos($var_44, '<signature>') !== FALSE) {
				$var_40 =  base64_decode(trim(str_replace(array('<signature>', '</signature>'), array('', ''), $var_44)));
				$var_44 = "   <var_45></var_45>\var_46";

				var_47('NOTE: Got Package Signature', false, 'IMPORT', var_48);
			}
			$var_43 .= "$var_44";
		}
		fclose($var_42);
	} else {
		cacti_log('FATAL: Unable to open file ' . $var_39, true, 'IMPORT', var_48);
		return false;
	}

	
	$var_49 = openssl_verify($var_43, $var_40, $var_34);
	if ($var_49 == 1) {
		cacti_log('NOTE: File is Signed Correctly', false, 'IMPORT', var_48);
	} elseif ($var_49 == 0) {
		cacti_log('FATAL: File has been Tampered with.', false, 'IMPORT', var_48);
		return false;
	} else {
		cacti_log('FATAL: Could not Verify Signature.', false, 'IMPORT', var_48);
		return false;
	}

	cacti_log('Loading Plugin Information from package', false, 'IMPORT', var_48);

	$var_50     = simplexml_load_string($var_43);
	$var_51       = fn_21($var_50);
	$var_52 = array();

	$var_53 = $var_51['info']['name'];

	if ($var_37) {
		return $var_51['info'];
	}

	cacti_log('Verifying each files signature', false, 'IMPORT', var_48);

	if (isset($var_51['files']['file']['data'])) {
		$var_51['files']['file'] = array($var_51['files']['file']);
	}

	foreach ($var_51['files']['file'] as $var_42) {
		$var_40 = base64_decode($var_42['filesignature']);
		$var_54 = base64_decode($var_42['data']);
		$var_49 = openssl_verify($var_54, $var_40, $var_34, var_55);
		if ($var_49 == 1) {
			cacti_log('NOTE: File OK: ' . $var_42['name'], false, 'IMPORT', var_48);
		} else {
			cacti_log('FATAL: Could not Verify Signature for file: ' . $var_42['name'], true, 'IMPORT', var_48);
			return false;
		}
	}

	cacti_log('Writing Files', false, 'IMPORT', var_48);

	foreach ($var_51['files']['file'] as $var_42) {
		$var_54 = base64_decode($var_42['data']);
		$var_56 = $var_42['name'];

		if (strpos($var_56, 'scripts/') !== false || strpos($var_56, 'resource/') !== false) {
			$var_39 = $var_4['base_path'] . "/$var_56";
			cacti_log('Writing file: ' . $var_39, false, 'IMPORT', var_48);

			if (!$var_36) {
				if ((is_writeable(dirname($var_39)) && !file_exists($var_39)) || is_writable($var_39)) {
					$var_57 = fopen($var_39, 'wb');

					if (is_resource($var_57)) {
						fwrite($var_57 , $var_54, strlen($var_54));
						fclose($var_57);
						clearstatcache();
						$var_52[$var_39] = __('written');
					} else {
						$var_52[$var_39] = __('could not open');
					}

					if (!file_exists($var_39)) {
						cacti_log('FATAL: Unable to create directory: ' . $var_39, true, 'IMPORT', var_48);

						$var_52[$var_39] = __('not exists');
					}
				} else {
					$var_52[$var_39] = __('not writable');
				}

				cacti_log('Write Status file: ' . $var_39 . ', with Status ' . $var_52[$var_39], false, 'IMPORT', var_48);
			} else {
				if (!is_writable($var_39)) {
					$var_52[$var_39] = __('not writable');
				} else {
					$var_52[$var_39] = __('writable');
				}
			}

		} else {
			cacti_log('Importing XML Data for ' . $var_56, false, 'IMPORT', var_48);

			$var_41 = fn_0($var_54, false, $var_2, $var_3, $var_7);

			if ($var_41 === false) {
				return false;
			}
		}
	}

	cacti_log('File creation complete', false, 'IMPORT', var_48);

	return array($var_41, $var_52);
}

function fn_3($var_13, &$var_12, &$var_16, $var_58, $var_3 = false) {
	global $var_59, $var_60, $var_61, $var_6, $var_7, $var_62, $var_8;

	
	$var_63 = 0;

	
	$var_64 = db_fetch_cell_prepared('SELECT id
		FROM graph_templates
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_64)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM graph_templates
			WHERE id = ?',
			array($var_64));
	} else {
		$var_65 = array();
		clear_cached_allowed_types();
	}

	$var_66['id']   = (empty($var_64) ? '0' : $var_64);
	$var_66['hash'] = $var_13;
	$var_66['name'] = $var_12['name'];

	if (isset($var_12['multiple'])) {
		$var_66['multiple'] = $var_12['multiple'];
	}

	
	$var_63 += fn_12($var_66, $var_65, 'graph_templates');

	if (!$var_7) {
		$var_67 = sql_save($var_66, 'graph_templates');
		$var_16['graph_template'][$var_13] = $var_67;
	} else {
		$var_67 = $var_64;
		$var_16['graph_template'][$var_13] = $var_67;
	}

	
	unset($var_66);
	$var_66['id'] = (empty($var_64) ? '0' : db_fetch_cell_prepared('SELECT gtg.id
		FROM graph_templates AS gt
		INNER JOIN graph_templates_graph AS gtg
		ON gt.id = gtg.graph_template_id
		WHERE gt.id = ?
		AND gtg.local_graph_id = 0',
		array($var_67)));

	if (!empty($var_64)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM graph_templates_graph
			WHERE id = ?',
			array($var_66['id']));
	} else {
		$var_65 = array();
	}

	$var_66['graph_template_id'] = $var_67;

	foreach ($var_59 as $var_68 => $var_69) {
		
		if (isset($var_12['graph']['t_' . $var_68])) {
			$var_66['t_' . $var_68] = $var_12['graph']['t_' . $var_68];
		}

		
		if (isset($var_12['graph'][$var_68])) {
			
			if (($var_68 == 'unit_exponent_value') && (fn_18($var_58) < fn_18('0.8.5')) && ($var_12['graph'][$var_68] == '0')) { 
				$var_66[$var_68] = '';
			} else {
				$var_66[$var_68] = fn_19($var_12['graph'][$var_68]);
			}
		}
	}

	
	$var_63 += fn_12($var_66, $var_65, 'graph_templates_graph');

	if (!$var_7) {
		$var_70 = sql_save($var_66, 'graph_templates_graph');
	} else {
		$var_70 = $var_66['id'];
	}

	
	if (is_array($var_12['items'])) {
		$var_71 = array();

		if ($var_67 > 0) {
			$var_72 = db_fetch_assoc_prepared('SELECT *
				FROM graph_templates_item
				WHERE graph_template_id = ?
				AND local_graph_id = 0',
				array($var_67));

			if (cacti_sizeof($var_72)) {
				foreach($var_72 as $var_73) {
					$var_74[$var_73['hash']] = $var_73;
				}
			}
		} else {
			$var_74 = array();
		}

		foreach ($var_12['items'] as $var_75 => $var_76) {
			
			$var_15 = fn_15($var_75);

			
			if (isset($var_74[$var_15['hash']])) {
				unset($var_74[$var_15['hash']]);
			}

			
			if ($var_15 == false) { return false; }

			unset($var_66);
			$var_77 = db_fetch_cell_prepared('SELECT id
				FROM graph_templates_item
				WHERE hash = ?
				AND graph_template_id = ?
				AND local_graph_id = 0',
				array($var_15['hash'], $var_67));

			if (!empty($var_77)) {
				$var_65 = db_fetch_row_prepared('SELECT *
					FROM graph_templates_item
					WHERE id = ?',
					array($var_77));
			} else {
				$var_65 = array();
			}

			$var_66['id']                = (empty($var_77) ? '0' : $var_77);
			$var_66['hash']              = $var_15['hash'];
			$var_66['graph_template_id'] = $var_67;

			foreach ($var_60 as $var_68 => $var_69) {
				
				if (isset($var_76[$var_68])) {
					
					if (preg_match('/hash_([a-f0-9]{2})([a-f0-9]{4})([a-f0-9]{32})/', $var_76[$var_68])) {
						$var_66[$var_68] = fn_14($var_76[$var_68], $var_16);
					} elseif (($var_68 == 'color_id') && (preg_match('/^[a-fA-F0-9]{6}$/', $var_76[$var_68])) && (fn_18($var_15['version']) >= fn_18('0.8.5'))) { 
						$var_78 = db_fetch_cell_prepared('SELECT id
							FROM colors
							WHERE hex = ?',
							array($var_76[$var_68]));

						if (empty($var_78) && !$var_7) {
							db_execute_prepared('INSERT INTO colors (
								hex) VALUES (?)',
								array($var_76[$var_68]));

							$var_78 = db_fetch_insert_id();
						}

						$var_66[$var_68] = $var_78;
					} else {
						$var_66[$var_68] = fn_19($var_76[$var_68]);
					}
				}
			}

			if (!empty($var_64)) {
				if (!cacti_sizeof($var_65)) {
					$var_71[$var_15['hash']] = $var_66;
				}
			}

			
			$var_63 += fn_12($var_66, $var_65, 'graph_templates_item');

			if (!$var_7) {
				$var_79 = sql_save($var_66, 'graph_templates_item');

				$var_16['graph_template_item'][$var_15['hash']] = $var_79;
			} else {
				$var_16['graph_template_item'][$var_15['hash']] = $var_77;
			}
		}
	}

	
	if (is_array($var_12['inputs'])) {
		foreach ($var_12['inputs'] as $var_75 => $var_76) {
			
			$var_15 = fn_15($var_75);

			
			if ($var_15 == false) { return false; }

			unset($var_66);
			$var_80 = db_fetch_cell_prepared('SELECT id
				FROM graph_template_input
				WHERE hash = ?
				AND graph_template_id = ?',
				array($var_15['hash'], $var_67));

			if (!empty($var_80)) {
				$var_65 = db_fetch_row_prepared('SELECT *
					FROM graph_template_input
					WHERE id = ?',
					array($var_80));
			} else {
				$var_65 = array();
			}

			$var_66['id']                = (empty($var_80) ? '0' : $var_80);
			$var_66['hash']              = $var_15['hash'];
			$var_66['graph_template_id'] = $var_67;

			foreach ($var_61 as $var_68 => $var_69) {
				
				if (isset($var_76[$var_68])) {
					$var_66[$var_68] = fn_19($var_76[$var_68]);
				}
			}

			
			$var_63 += fn_12($var_66, $var_65, 'graph_template_input');

			if (!$var_7) {
				$var_81 = sql_save($var_66, 'graph_template_input');

				$var_16['graph_template_input'][$var_15['hash']] = $var_81;

				
				$var_82 = explode('|', $var_76['items']);

				if (!empty($var_82[0])) {
					for ($var_30=0; $var_30<cacti_count($var_82); $var_30++) {
						
						$var_15 = fn_15($var_82[$var_30]);

						
						if ($var_15 == false) { return false; }

						if (isset($var_16['graph_template_item'][$var_15['hash']])) {
							db_execute_prepared('REPLACE INTO graph_template_input_defs
								(graph_template_input_id, graph_template_item_id)
								VALUES (?, ?)',
								array($var_81, $var_16['graph_template_item'][$var_15['hash']]));
						}
					}
				}
			}
		}
	}

	
	$var_8['type']   = (empty($var_64) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_67) ? 'fail' : 'success'));

	if (isset($var_71) && cacti_sizeof($var_71)) {
		$var_83 = array();
		foreach($var_71 as $var_73) {
			$var_83[] = 'New Graph Items, Type: ' . $var_62[$var_73['graph_type_id']] . ', Text Format: ' . $var_73['text_format'] . ', Value: ' . $var_73['value'];
		}
		$var_8['new_items'] = $var_83;
	}

	if (isset($var_74) && cacti_sizeof($var_74)) {
		$var_84 = array();
		foreach($var_74 as $var_73) {
			if ($var_3) {
				$var_84[] = 'Removed Orphaned Graph Items, Type: ' . $var_62[$var_73['graph_type_id']] . ', Text Format: ' . $var_73['text_format'] . ', Value: ' . $var_73['value'];

				db_execute_prepared('DELETE FROM graph_templates_item
					WHERE hash = ?',
					array($var_73['hash']));

				db_execute_prepared('DELETE FROM graph_templates_item
					WHERE local_graph_template_item_id = ?',
					array($var_73['id']));
			} else {
				$var_84[] = 'Found Orphaned Graph Items, Type: ' . $var_62[$var_73['graph_type_id']] . ', Text Format: ' . $var_73['text_format'] . ', Value: ' . $var_73['value'];
			}
		}
		$var_8['orphans'] = $var_84;

		if ($var_3) {
			retemplate_graphs($var_67);
		}
	}

	return $var_16;
}

function fn_4($var_13, &$var_12, &$var_16, $var_1, $var_2) {
	global $var_85, $var_86, $var_87, $var_7, $var_8, $var_9;

	
	$var_63 = 0;

	
	$var_88 = db_fetch_cell_prepared('SELECT id
		FROM data_template
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_88)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM data_template
			WHERE id = ?',
			array($var_88));
	} else {
		$var_65 = array();
	}

	$var_66['id']   = (empty($var_88) ? '0' : $var_88);
	$var_66['hash'] = $var_13;
	$var_66['name'] = $var_12['name'];

	
	$var_63 += fn_12($var_66, $var_65, 'data_template');

	if (!$var_7) {
		$var_89 = sql_save($var_66, 'data_template');

		$var_16['data_template'][$var_13] = $var_89;
	} else {
		$var_89 = $var_88;

		$var_16['data_template'][$var_13] = $var_88;
	}

	
	unset($var_66);
	$var_66['id'] = (empty($var_88) ? '0' : db_fetch_cell_prepared('SELECT dtd.id
		FROM data_template AS dt
		INNER JOIN data_template_data AS dtd
		ON dt.id=dtd.data_template_id
		WHERE dt.id = ?
		AND dtd.local_data_id = 0',
		array($var_89)));

	if (!empty($var_66['id'])) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM data_template_data
			WHERE id = ?',
			array($var_66['id']));
	} else {
		$var_65 = array();
	}

	$var_66['data_template_id'] = $var_89;
	$var_66['data_source_profile_id'] = $var_2;

	foreach ($var_85 as $var_68 => $var_69) {
		
		if (isset($var_12['ds']['t_' . $var_68])) {
			$var_66['t_' . $var_68] = $var_12['ds']['t_' . $var_68];
		}

		
		if (isset($var_12['ds'][$var_68])) {
			
			if ($var_68 == 'data_source_profile_id') {
				$var_66[$var_68] = $var_2;
			} elseif (preg_match('/hash_([a-f0-9]{2})([a-f0-9]{4})([a-f0-9]{32})/', $var_12['ds'][$var_68])) {
				$var_66[$var_68] = fn_14($var_12['ds'][$var_68], $var_16);
			} else {
				$var_66[$var_68] = fn_19($var_12['ds'][$var_68]);
			}
		}
	}

	
	if ($var_2 > 0) {
		$var_66['rrd_step'] = db_fetch_cell_prepared('SELECT step
			FROM data_source_profiles
			WHERE id = ?',
			array($var_2));
	} else {
		$var_2 = db_fetch_cell('SELECT id
			FROM data_source_profiles
			ORDER BY `default`
			DESC LIMIT 1');

		$var_66['rrd_step'] = db_fetch_cell_prepared('SELECT step
			FROM data_source_profiles
			WHERE id = ?',
			array($var_2));
	}

	
	$var_63 += fn_12($var_66, $var_65, 'data_template_data');

	if (!$var_7) {
		$var_90 = sql_save($var_66, 'data_template_data');

		$var_87 = $var_90;
	}

	
	if (is_array($var_12['items'])) {
		foreach ($var_12['items'] as $var_75 => $var_76) {
			
			$var_15 = fn_15($var_75);

			
			if ($var_15 == false) { return false; }

			unset($var_66);
			$var_91 = db_fetch_cell_prepared('SELECT id
				FROM data_template_rrd
				WHERE hash = ?
				AND data_template_id = ?
				AND local_data_id = 0',
				array($var_15['hash'], $var_89));

			if (!empty($var_91)) {
				$var_65 = db_fetch_row_prepared('SELECT *
					FROM data_template_rrd
					WHERE id = ?',
					array($var_91));
			} else {
				$var_65 = array();
			}

			$var_66['id']               = (empty($var_91) ? '0' : $var_91);
			$var_66['hash']             = $var_15['hash'];
			$var_66['data_template_id'] = $var_89;

			foreach ($var_86 as $var_68 => $var_69) {
				
				if (isset($var_76['t_' . $var_68])) {
					$var_66['t_' . $var_68] = $var_76['t_' . $var_68];
				}

				
				if (isset($var_76[$var_68])) {
					
					if (preg_match('/hash_([a-f0-9]{2})([a-f0-9]{4})([a-f0-9]{32})/', $var_76[$var_68])) {
						$var_66[$var_68] = fn_14($var_76[$var_68], $var_16);
					} else {
						$var_66[$var_68] = fn_19($var_76[$var_68]);
					}
				}
			}

			
			if ($var_1 === false) {
				$var_66['rrd_heartbeat'] = db_fetch_cell_prepared('SELECT step
					FROM data_source_profiles
					WHERE id = ?',
					array($var_2)) * 2;
			}

			
			if (is_array($var_2) == true) {
				$var_66['rrd_heartbeat'] = read_config_option('poller_interval') * 2;
			}

			if ($var_9) {
				if ($var_66['data_source_type_id'] == 1 || $var_66['data_source_type_id'] == 4) {
					if ($var_66['rrd_maximum'] == '0' && $var_66['rrd_minimum'] == '0') {
						$var_66['rrd_maximum'] = 'U';
					}
				} elseif ($var_66['data_source_type_id'] == 3 || $var_66['data_source_type_id'] == 7) {
					if ($var_66['rrd_maximum'] == '0' && $var_66['rrd_minimum'] == '0') {
						$var_66['rrd_maximum'] = 'U';
						$var_66['rrd_minimum'] = 'U';
					}
				}
			}

			
			$var_63 += fn_12($var_66, $var_65, 'data_template_rrd');

			if (!$var_7) {
				$var_92 = sql_save($var_66, 'data_template_rrd');

				if ($var_9) {
					
					db_execute("UPDATE data_template_rrd
						SET rrd_maximum='U'
						WHERE rrd_maximum = '0'
						AND rrd_minimum = '0'
						AND data_template_id = $var_89
						AND data_source_type_id IN(1,4)");

					
					db_execute("UPDATE data_template_rrd
						SET rrd_maximum='U', rrd_minimum='U'
						WHERE (rrd_maximum = '0' OR rrd_minimum = '0')
						AND data_template_id = $var_89
						AND data_source_type_id IN(3,7)");
				}

				$var_16['data_template_item'][$var_15['hash']] = $var_92;
			} else {
				$var_16['data_template_item'][$var_15['hash']] = $var_91;
			}
		}
	}

	
	if (!$var_7) {
		if (is_array($var_12['data'])) {
			foreach ($var_12['data'] as $var_75 => $var_76) {
				unset($var_66);
				$var_66['data_template_data_id'] = $var_90;
				$var_66['data_input_field_id']   = fn_14($var_76['data_input_field_id'], $var_16);
				$var_66['t_value']               = $var_76['t_value'];
				$var_66['value']                 = fn_19($var_76['value']);

				if (!empty($var_66['data_input_field_id'])) {
					sql_save($var_66, 'data_input_data', array('data_template_data_id', 'data_input_field_id'), false);
				} else {
					cacti_log('Import Error: Failed to insert into data_input_data table', false, var_31);
				}
			}
		}

		
		db_execute_prepared('REPLACE INTO poller_data_template_field_mappings
			SELECT dtr.data_template_id,
			dif.data_name,
			GROUP_CONCAT(dtr.data_source_name ORDER BY dtr.data_source_name) AS data_source_names,
			NOW() AS last_updated
			FROM data_template_rrd AS dtr
			INNER JOIN data_input_fields AS dif
			ON dtr.data_input_field_id = dif.id
			WHERE dtr.local_data_id = 0
			AND dtr.data_template_id = ?
			GROUP BY dtr.data_template_id, dif.data_name', array($var_89));
	}

	
	$var_8['type']   = (empty($var_88) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_89) ? 'fail' : 'success'));

	return $var_16;
}

function fn_5($var_13, &$var_12, &$var_16) {
	global $var_4, $var_93, $var_94, $var_7, $var_8;

	static $var_95 = 0;

	
	$var_63 = 0;

	
	$var_96 = db_fetch_cell_prepared('SELECT id
		FROM snmp_query
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_96)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM snmp_query
			WHERE id = ?',
			array($var_96));
	} else {
		$var_65 = array();
	}

	$var_66['id']     = (empty($var_96) ? '0' : $var_96);
	$var_66['hash']   = $var_13;

	foreach ($var_93 as $var_68 => $var_69) {
		
		if (isset($var_12[$var_68])) {
			
			if (preg_match('/hash_([a-f0-9]{2})([a-f0-9]{4})([a-f0-9]{32})/', $var_12[$var_68])) {
				$var_66[$var_68] = fn_14($var_12[$var_68], $var_16);
			} else {
				$var_66[$var_68] = fn_19($var_12[$var_68]);
			}
		}
	}

	if (isset($var_66['xml_path'])) {
		$var_97 = str_replace('<path_cacti>', $var_4['base_path'], $var_66['xml_path']);

		if (!file_exists($var_97) || !is_readable($var_97)) {
			raise_message('resource_missing_' . $var_95, __('Resource File: \'%s\' is missing or not readable.  Make sure you install it before using Data Query: \'%s\'', $var_97, $var_66['name']), var_98);
			$var_95++;
		}
	}

	
	$var_63 += fn_12($var_66, $var_65, 'snmp_query');

	if (!$var_7) {
		$var_99 = sql_save($var_66, 'snmp_query');

		$var_16['data_query'][$var_13] = $var_99;

		update_replication_crc(0, 'poller_replicate_snmp_query_crc');
	} else {
		$var_99 = $var_96;

		$var_16['data_query'][$var_13] = $var_96;
	}

	
	if (is_array($var_12['graphs'])) {
		foreach ($var_12['graphs'] as $var_75 => $var_76) {
			
			$var_15 = fn_15($var_75);

			
			if ($var_15 == false) { return false; }

			unset($var_66);
			$var_100 = db_fetch_cell_prepared('SELECT id
				FROM snmp_query_graph
				WHERE hash = ?
				AND snmp_query_id = ?',
				array($var_15['hash'], $var_99));

			if (!empty($var_100)) {
				$var_65 = db_fetch_row_prepared('SELECT *
					FROM snmp_query_graph
					WHERE id = ?',
					array($var_100));
			} else {
				$var_65 = array();
			}

			$var_66['id']            = (empty($var_100) ? '0' : $var_100);
			$var_66['hash']          = $var_15['hash'];
			$var_66['snmp_query_id'] = $var_99;

			foreach ($var_94 as $var_68 => $var_69) {
				
				if (isset($var_76[$var_68])) {
					
					if (preg_match('/hash_([a-f0-9]{2})([a-f0-9]{4})([a-f0-9]{32})/', $var_76[$var_68])) {
						$var_66[$var_68] = fn_14($var_76[$var_68], $var_16);
					} else {
						$var_66[$var_68] = fn_19($var_76[$var_68]);
					}
				}
			}

			
			$var_63 += fn_12($var_66, $var_65, 'snmp_query_graph');

			if (!$var_7) {
				$var_101 = sql_save($var_66, 'snmp_query_graph');

				$var_16['data_query_graph'][$var_15['hash']] = $var_101;

				
				if (is_array($var_76['rrd'])) {
					foreach ($var_76['rrd'] as $var_102 => $var_103) {
						unset($var_66);
						$var_66['snmp_query_graph_id']  = $var_101;
						$var_66['data_template_id']     = fn_14($var_103['data_template_id'], $var_16);
						$var_66['data_template_rrd_id'] = fn_14($var_103['data_template_rrd_id'], $var_16);
						$var_66['snmp_field_name']      = $var_103['snmp_field_name'];

						if (!empty($var_66['data_template_id']) && !empty($var_66['data_template_rrd_id'])) {
							sql_save($var_66, 'snmp_query_graph_rrd', array('snmp_query_graph_id', 'data_template_id', 'data_template_rrd_id'), false);
						} else {
							cacti_log('Import Error: inserting into snmp_query_graph_rrd', false, var_31);
						}
					}
				}
			} else {
				$var_101 = $var_100;

				$var_16['data_query_graph'][$var_15['hash']] = $var_100;
			}

			
			if (is_array($var_76['sv_graph'])) {
				foreach ($var_76['sv_graph'] as $var_102 => $var_103) {
					
					$var_15 = fn_15($var_102);

					
					if ($var_15 == false) { return false; }

					unset($var_66);
					$var_104 = db_fetch_cell_prepared('SELECT id
						FROM snmp_query_graph_sv
						WHERE hash = ?
						AND snmp_query_graph_id = ?',
						array($var_15['hash'], $var_101));

					if (!empty($var_104)) {
						$var_65 = db_fetch_row_prepared('SELECT *
							FROM snmp_query_graph_sv
							WHERE id = ?',
							array($var_104));
					} else {
						$var_65 = array();
					}

					$var_66['id']                  = (empty($var_104) ? '0' : $var_104);
					$var_66['hash']                = $var_15['hash'];
					$var_66['snmp_query_graph_id'] = $var_101;
					$var_66['sequence']            = $var_103['sequence'];
					$var_66['field_name']          = $var_103['field_name'];
					$var_66['text']                = fn_19($var_103['text']);

					
					$var_63 += fn_12($var_66, $var_65, 'snmp_query_graph_sv');

					if (!$var_7) {
						$var_105 = sql_save($var_66, 'snmp_query_graph_sv');

						$var_16['data_query_sv_graph'][$var_15['hash']] = $var_105;
					} else {
						$var_16['data_query_sv_graph'][$var_15['hash']] = $var_104;
					}
				}
			}

			
			if (is_array($var_76['sv_data_source'])) {
				foreach ($var_76['sv_data_source'] as $var_102 => $var_103) {
					
					$var_15 = fn_15($var_102);

					
					if ($var_15 == false) { return false; }

					unset($var_66);
					$var_106 = db_fetch_cell_prepared('SELECT id
						FROM snmp_query_graph_rrd_sv
						WHERE hash = ?
						AND snmp_query_graph_id = ?',
						array($var_15['hash'], $var_101));

					if (!empty($var_106)) {
						$var_65 = db_fetch_row_prepared('SELECT *
							FROM snmp_query_graph_rrd_sv
							WHERE id = ?',
							array($var_106));
					} else {
						$var_65 = array();
					}

					$var_66['id']                  = (empty($var_106) ? '0' : $var_106);
					$var_66['hash']                = $var_15['hash'];
					$var_66['snmp_query_graph_id'] = $var_101;
					$var_66['data_template_id']    = fn_14($var_103['data_template_id'], $var_16);
					$var_66['sequence']            = $var_103['sequence'];
					$var_66['field_name']          = $var_103['field_name'];
					$var_66['text']                = fn_19($var_103['text']);

					
					$var_63 += fn_12($var_66, $var_65, 'snmp_query_graph_rrd_sv');

					if (!$var_7) {
						if (!empty($var_66['data_template_id'])) {
							$var_107 = sql_save($var_66, 'snmp_query_graph_rrd_sv');
						} else {
							cacti_log('Import Error: Error Importing into snmp_query_graph_rrd_sv table', false, var_31);
						}

						$var_16['data_query_sv_data_source'][$var_15['hash']] = $var_107;
					} else {
						$var_16['data_query_sv_data_source'][$var_15['hash']] = $var_106;
					}
				}
			}
		}
	}

	
	$var_8['type']   = (empty($var_96) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_99) ? 'fail' : 'success'));

	return $var_16;
}

function fn_6($var_13, &$var_12, &$var_16) {
	global $var_108, $var_7, $var_8;

	
	$var_63 = 0;

	
	$var_109 = db_fetch_cell_prepared('SELECT id
		FROM graph_templates_gprint
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_109)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM graph_templates_gprint
			WHERE id = ?',
			array($var_109));
	} else {
		$var_65 = array();
	}

	$var_66['id']   = (empty($var_109) ? '0' : $var_109);
	$var_66['hash'] = $var_13;

	foreach ($var_108 as $var_68 => $var_69) {
		
		if (isset($var_12[$var_68])) {
			$var_66[$var_68] = fn_19($var_12[$var_68]);
		}
	}

	
	$var_63 += fn_12($var_66, $var_65, 'graph_templates_gprint');

	if (!$var_7) {
		$var_110 = sql_save($var_66, 'graph_templates_gprint');

		$var_16['gprint_preset'][$var_13] = $var_110;
	} else {
		$var_16['gprint_preset'][$var_13] = $var_109;
	}

	
	$var_8['type']   = (empty($var_109) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_110) ? 'fail' : 'success'));

	return $var_16;
}

function fn_7($var_13, &$var_12, &$var_16, $var_1, $var_2) {
	global $var_111, $var_112, $var_87, $var_7, $var_8;

	if ($var_1 == true) {
		$var_66['id']   = 0;
		$var_66['hash'] = get_hash_data_source_profile(0);

		foreach ($var_111 as $var_68 => $var_69) {
			
			if (isset($var_12[$var_68])) {
				$var_66[$var_68] = fn_19($var_12[$var_68]);
			}
		}

		
		$var_66['name'] .= ' (imported)';

		if (!$var_7) {
			$var_113 = sql_save($var_66, 'data_source_profiles');

			if (!empty($var_113)) {
				db_execute_prepared('UPDATE data_template_data
					SET data_source_profile_id = ?
					WHERE id = ?',
					array($var_113, $var_87));
			}

			$var_16['data_source_profiles'][$var_13] = $var_113;

			
			$var_82 = explode('|', $var_12['cf_items']);

			if (!empty($var_82[0])) {
				for ($var_30=0; $var_30<cacti_count($var_82); $var_30++) {
					db_execute_prepared('REPLACE INTO data_source_profiles_cf
						(data_source_profile_id, consolidation_function_id)
						VALUES (?, ?)',
						array($var_113, $var_82[$var_30]));
				}
			}

			
			if (is_array($var_12['items'])) {
				foreach ($var_12['items'] as $var_114 => $var_76) {
					unset($var_66);

					$var_66['id']                     = 0;
					$var_66['data_source_profile_id'] = $var_113;

					foreach ($var_112 as $var_68 => $var_69) {
						
						if (isset($var_76[$var_68])) {
							$var_66[$var_68] = fn_19($var_76[$var_68]);
						}
					}

					$var_115 = sql_save($var_66, 'data_source_profiles_rra');

					$var_16['data_source_profile_rra'][$var_114] = $var_115;
				}
			}
		}

		
		$var_8['type']   = 'new';
		$var_8['title']  = $var_12['name'] . ' (imported)';
		$var_8['result'] = ($var_7 ? 'preview':(empty($var_113) ? 'fail' : 'success'));

		return $var_16;
	} else {
		return false;
	}

}

function fn_8($var_13, &$var_12, &$var_16) {
	global $var_116, $var_7, $var_8;

	
	$var_63 = 0;

	
	$var_117 = db_fetch_cell_prepared('SELECT id
		FROM host_template
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_117)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM host_template
			WHERE id = ?',
			array($var_117));
	} else {
		$var_65 = array();
	}

	$var_66['id']   = (empty($var_117) ? '0' : $var_117);
	$var_66['hash'] = $var_13;

	foreach ($var_116 as $var_68 => $var_69) {
		
		if (isset($var_12[$var_68])) {
			$var_66[$var_68] = fn_19($var_12[$var_68]);
		}
	}

	
	$var_63 += fn_12($var_66, $var_65, 'host_template');

	if (!$var_7) {
		$var_118 = sql_save($var_66, 'host_template');

		$var_16['host_template'][$var_13] = $var_118;

		
		$var_82 = explode('|', $var_12['graph_templates']);

		if (!empty($var_82[0])) {
			for ($var_30=0; $var_30<cacti_count($var_82); $var_30++) {
				
				$var_15 = fn_15($var_82[$var_30]);

				
				if ($var_15 == false) { return false; }

				if (isset($var_16['graph_template'][$var_15['hash']])) {
					db_execute_prepared('REPLACE INTO host_template_graph
						(host_template_id, graph_template_id)
						VALUES (?, ?)',
						array($var_118, $var_16['graph_template'][$var_15['hash']]));
				}
			}
		}

		
		$var_82 = explode('|', $var_12['data_queries']);

		if (!empty($var_82[0])) {
			for ($var_30=0; $var_30<cacti_count($var_82); $var_30++) {
				
				$var_15 = fn_15($var_82[$var_30]);

				
				if ($var_15 == false) { return false; }

				if (isset($var_16['data_query'][$var_15['hash']])) {
					db_execute_prepared('REPLACE INTO host_template_snmp_query
						(host_template_id, snmp_query_id)
						VALUES (?, ?)',
						array($var_118, $var_16['data_query'][$var_15['hash']]));
				}
			}
		}
	} else {
		$var_16['host_template'][$var_13] = $var_117;
	}

	
	$var_8['type']   = (empty($var_117) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_118) ? 'fail' : 'success'));

	return $var_16;
}

function fn_9($var_13, &$var_12, &$var_16) {
	global $var_119, $var_7, $var_8;

	
	$var_63 = 0;

	$var_120 = array(
		'sequence' => 'sequence',
		'type'     => 'type',
		'value'    => 'value'
	);

	
	$var_121 = db_fetch_cell_prepared('SELECT id
		FROM cdef
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_121)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM cdef
			WHERE id = ?',
			array($var_121));
	} else {
		$var_65 = array();
	}

	$var_66['id']   = (empty($var_121) ? '0' : $var_121);
	$var_66['hash'] = $var_13;

	foreach ($var_119 as $var_68 => $var_69) {
		
		if (isset($var_12[$var_68])) {
			$var_66[$var_68] = fn_19($var_12[$var_68]);
		}
	}

	
	$var_63 += fn_12($var_66, $var_65, 'cdef');

	if (!$var_7) {
		$var_122 = sql_save($var_66, 'cdef');

		$var_16['cdef'][$var_13] = $var_122;
	} else {
		$var_122 = $var_121;

		$var_16['cdef'][$var_13] = $var_121;
	}

	
	if (is_array($var_12['items'])) {
		foreach ($var_12['items'] as $var_75 => $var_76) {
			
			$var_15 = fn_15($var_75);

			
			if ($var_15 == false) { return false; }

			unset($var_66);
			$var_123 = db_fetch_cell_prepared('SELECT id
				FROM cdef_items
				WHERE hash= ?
				AND cdef_id = ?',
				array($var_15['hash'], $var_122));

			if (!empty($var_123)) {
				$var_65 = db_fetch_row_prepared('SELECT *
					FROM cdef_items
					WHERE id = ?',
					array($var_123));
			} else {
				$var_65 = array();
			}

			$var_66['id']      = (empty($var_123) ? '0' : $var_123);
			$var_66['hash']    = $var_15['hash'];
			$var_66['cdef_id'] = $var_122;

			foreach ($var_120 as $var_68 => $var_69) {
				
				if (isset($var_76[$var_68])) {
					
					if (($var_68 == 'value') && ($var_76['type'] == '5')) {
						
						$var_124 = fn_15($var_76['value']);

						
						if ($var_124 == false) { return false; }

						$var_121 = db_fetch_cell_prepared('SELECT id
							FROM cdef
							WHERE hash = ?',
							array($var_124['hash']));

						$var_66[$var_68] = $var_121;
					} else {
						$var_66[$var_68] = fn_19($var_76[$var_68]);
					}
				}
			}

			
			$var_63 += fn_12($var_66, $var_65, 'cdef_items');

			if (!$var_7) {
				$var_125 = sql_save($var_66, 'cdef_items');

				$var_16['cdef_item'][$var_15['hash']] = $var_125;
			} else {
				$var_16['cdef_item'][$var_15['hash']] = $var_123;
			}
		}
	}

	
	$var_8['type']   = (empty($var_121) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_122) ? 'fail' : 'success'));

	return $var_16;
}

function fn_10($var_13, &$var_12, &$var_16) {
	global $var_4, $var_7, $var_8;


	
	$var_63 = 0;

	
	$var_126 = db_fetch_cell_prepared('SELECT id
		FROM vdef
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_126)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM vdef
			WHERE id = ?',
			array($var_126));
	} else {
		$var_65 = array();
	}

	$var_66['id']   = (empty($var_126) ? '0' : $var_126);
	$var_66['hash'] = $var_13;

	$var_127 = preset_vdef_form_list();
	foreach ($var_127 as $var_68 => $var_69) {
		
		if (isset($var_12[$var_68])) {
			$var_66[$var_68] = fn_19($var_12[$var_68]);
		}
	}

	
	$var_63 += fn_12($var_66, $var_65, 'vdef');

	if (!$var_7) {
		$var_128 = sql_save($var_66, 'vdef');

		$var_16['vdef'][$var_13] = $var_128;
	} else {
		$var_128 = $var_126;

		$var_16['vdef'][$var_13] = $var_126;
	}

	
	if (is_array($var_12['items'])) {
		foreach ($var_12['items'] as $var_75 => $var_76) {
			
			$var_15 = fn_15($var_75);

			
			if ($var_15 == false) { return false; }

			unset($var_66);
			$var_129 = db_fetch_cell_prepared('SELECT id
				FROM vdef_items
				WHERE hash = ?
				AND vdef_id = ?',
				array($var_15['hash'], $var_128));

			if (!empty($var_129)) {
				$var_65 = db_fetch_row_prepared('SELECT *
					FROM vdef_items
					WHERE id = ?',
					array($var_129));
			} else {
				$var_65 = array();
			}

			$var_66['id']      = (empty($var_129) ? '0' : $var_129);
			$var_66['hash']    = $var_15['hash'];
			$var_66['vdef_id'] = $var_128;

			$var_130 = preset_vdef_item_form_list();
			foreach ($var_130 as $var_68 => $var_69) {
				
				if (isset($var_76[$var_68])) {
					$var_66[$var_68] = fn_19($var_76[$var_68]);
				}
			}

			
			$var_63 += fn_12($var_66, $var_65, 'vdef_items');

			if (!$var_7) {
				$var_131 = sql_save($var_66, 'vdef_items');

				$var_16['vdef_item'][$var_15['hash']] = $var_131;
			} else {
				$var_16['vdef_item'][$var_15['hash']] = $var_129;
			}
		}
	}

	
	$var_8['type']   = (empty($var_126) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_128) ? 'fail' : 'success'));

	return $var_16;
}

function fn_11($var_13, &$var_12, &$var_16) {
	global $var_132, $var_133, $var_134, $var_7, $var_8;

	
	$var_63 = 0;

	$var_135 = array(
		'3eb92bb845b9660a7445cf9740726522', 
		'bf566c869ac6443b0c75d1c32b5a350e', 
		'80e9e4c4191a5da189ae26d0e237f015', 
		'332111d8b54ac8ce939af87a7eac0c06', 
	);

	
	if (array_search($var_13, $var_135) !== false) {
		return $var_16;
	}

	
	$var_133 += $var_134;

	
	$var_136 = db_fetch_cell_prepared('SELECT id
		FROM data_input
		WHERE hash = ?',
		array($var_13));

	if (!empty($var_136)) {
		$var_65 = db_fetch_row_prepared('SELECT *
			FROM data_input
			WHERE id = ?',
			array($var_136));
	} else {
		$var_65 = array();
	}

	$var_66['id']   = (empty($var_136) ? '0' : $var_136);
	$var_66['hash'] = $var_13;

	foreach ($var_132 as $var_68 => $var_69) {
		
		if (isset($var_12[$var_68])) {
			if ($var_68 == 'input_string' && fn_22($var_12[$var_68])) {
				$var_66[$var_68] = base64_decode($var_12[$var_68]);
			} else {
				$var_66[$var_68] = fn_19($var_12[$var_68]);

				
				if ($var_68 == 'input_string') {
					$var_66[$var_68] = str_replace('><', '> <', $var_66[$var_68]);
					$var_66[$var_68] = str_replace('>""<', '>" "<', $var_66[$var_68]);
					$var_66[$var_68] = str_replace('>\'\'<', '>\' \'<', $var_66[$var_68]);
				}
			}
		}
	}

	
	$var_63 += fn_12($var_66, $var_65, 'data_input');

	if (!$var_7) {
		$var_137 = sql_save($var_66, 'data_input');

		$var_16['data_input_method'][$var_13] = $var_137;

		update_replication_crc(0, 'poller_replicate_data_input_crc');
	} else {
		$var_137 = $var_136;

		$var_16['data_input_method'][$var_13] = $var_136;
	}

	
	if (is_array($var_12['fields'])) {
		foreach ($var_12['fields'] as $var_75 => $var_76) {
			
			$var_15 = fn_15($var_75);

			
			if ($var_15 == false) { return false; }

			
			if ($var_15['hash'] == '5240353b8f7f259acaf30e6229bc14e7') {
				continue;
			} elseif ($var_15['hash'] == 'd94caa7cc3733bd95ee00a3917fdcbb5') {
				continue;
			}

			unset($var_66);
			$var_138 = db_fetch_cell_prepared('SELECT id
				FROM data_input_fields
				WHERE hash= ?
				AND data_input_id = ?',
				array($var_15['hash'], $var_137));

			if (!empty($var_138)) {
				$var_65 = db_fetch_row_prepared('SELECT *
					FROM data_input_fields
					WHERE id = ?',
					array($var_138));
			} else {
				$var_65 = array();
			}

			$var_66['id']            = (empty($var_138) ? '0' : $var_138);
			$var_66['hash']          = $var_15['hash'];
			$var_66['data_input_id'] = $var_137;

			foreach ($var_133 as $var_68 => $var_69) {
				
				if (isset($var_76[$var_68])) {
					$var_66[$var_68] = fn_19($var_76[$var_68]);
				}
			}

			
			$var_63 += fn_12($var_66, $var_65, 'data_input_fields');

			if (!$var_7) {
				$var_139 = sql_save($var_66, 'data_input_fields');

				$var_16['data_input_field'][$var_15['hash']] = $var_139;

				update_replication_crc(0, 'poller_replicate_data_input_fields_crc');
			} else {
				$var_16['data_input_field'][$var_15['hash']] = $var_138;
			}
		}
	}

	
	if (!$var_7) {
		if ((isset($var_12['input_string'])) && (!empty($var_137))) {
			generate_data_input_field_sequences($var_12['input_string'], $var_137);
		}
	}

	
	$var_8['type']   = (empty($var_136) ? 'new' : ($var_63 > 0 ? 'updated':'unchanged'));
	$var_8['title']  = $var_12['name'];
	$var_8['result'] = ($var_7 ? 'preview':(empty($var_137) ? 'fail' : 'success'));

	return $var_16;
}

function fn_12($var_66, $var_65, $var_140) {
	global $var_7, $var_8;

	if ($var_7) {
		$var_141 = array(
			'task_item_id',
			'gprint_id',
			'cdef_id',
			'vdef_id',
			'consolidation_function_id',
			'data_input_id',
			'graph_template_id',
			'data_template_id',
			'data_input_field_id'
		);
	} else {
		$var_141 = array();
	}

	if (!cacti_sizeof($var_65)) {
		return 0;
	} else {
		$var_142 = 0;
		foreach($var_66 as $var_143 => $var_144) {
			if (array_search($var_143, $var_141) !== false) continue;

			if ($var_65[$var_143] != $var_144) {
				$var_145 = db_get_table_column_types($var_140);

				if (strstr($var_145[$var_143]['type'], 'int') !== false ||
					strstr($var_145[$var_143]['type'], 'float') !== false ||
					strstr($var_145[$var_143]['type'], 'decimal') !== false ||
					strstr($var_145[$var_143]['type'], 'double') !== false) {

					if (empty($var_65[$var_143]) && empty($var_144)) {
						continue;
					} elseif ($var_140 == 'data_template_rrd' && $var_143 == 'rrd_heartbeat') {
						continue;
					} elseif ($var_140 == 'data_template_data' && $var_143 == 'rrd_step') {
						continue;
					}
				} elseif (empty($var_65[$var_143]) && empty($var_144)) {
					continue;
				}

				$var_142++;
				$var_8['differences'][] = 'Table: ' . $var_140 . ', Column: ' . $var_143 . ', New Value: ' . html_escape($var_144) . ', Old Value: ' . html_escape($var_65[$var_143]);
			}
		}

		return $var_142;
	}
}

function fn_13($var_13, $var_146) {
	global $var_147;

	
	$var_15 = fn_15($var_13);

	
	if ($var_15 == false) {
		return __('Unknown Field');
	}

	if ($var_146 == true) {
		$var_148 = '(<em>' . $var_147[$var_15['type']] . '</em>) ';
	} else {
		$var_148 = '';
	}

	switch ($var_15['type']) {
		case 'graph_template':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM graph_templates
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'data_template':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM data_template
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'data_template_item':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT data_source_name
			FROM data_template_rrd
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'host_template':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM host_template
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'data_input_method':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM data_input
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'data_input_field':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM data_input_fields
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'data_query':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM snmp_query
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'gprint_preset':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM graph_templates_gprint
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'cdef':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM cdef
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'vdef':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM vdef
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'data_source_profile':
			return $var_148 . html_escape(db_fetch_cell_prepared('SELECT name
			FROM data_source_profile
			WHERE hash = ?',
			array($var_15['hash'])));
		case 'round_robin_archive':
			return $var_148;
		default:
			$var_33 = array();
			$var_33['hash']    = $var_15['hash'];
			$var_33['type']    = $var_15['type'];
			$var_33['prepend'] = $var_148;

			api_plugin_hook_function('get_friendly_name', $var_33);

			return html_escape($var_33['prepend']);
	}
}

function fn_14($var_13, &$var_149) {
	global $var_8;

	
	$var_15 = fn_15($var_13);

	
	if ($var_15 == false) { return false; }

	if (isset($var_149[$var_15['type']][$var_15['hash']])) {
		$var_8['dep'][$var_13] = 'met';
		return $var_149[$var_15['type']][$var_15['hash']];
	} else {
		
		if ($var_15['hash'] == '5240353b8f7f259acaf30e6229bc14e7') {
			return 0;
		} elseif ($var_15['hash'] == 'd94caa7cc3733bd95ee00a3917fdcbb5') {
			return 0;
		} elseif ($var_15['hash'] == 'cbbe5c1ddfb264a6e5d509ce1c78c95f') {
			return 0;
		} elseif ($var_15['hash'] == '51bde3d899e12bde28ad979166985584') {
			return 0;
		}

		cacti_log("Import Error: Import found an invalid dependency hash of :" . $var_15['hash'] . ".  Please open bug on GitHub.");

		$var_8['dep'][$var_13] = 'unmet';

		return 0;
	}
}

function fn_15($var_13) {
	global $var_9;

	if (preg_match('/hash_([a-f0-9]{2})([a-f0-9]{4})([a-f0-9]{32})/', $var_13, $var_150)) {
		$var_15['type']    = fn_16($var_150[1]);
		$var_15['version'] = strval(fn_17($var_150[2]));
		$var_15['hash']    = $var_150[3];

		
		if (($var_15['type'] === false) || ($var_15['version'] === false)) {
			raise_message(7); 

			cacti_log(var_151 . ' ERROR type or version not found for hash: ' . $var_13, false, 'IMPORT', var_48);
			return false;
		}
	} elseif (preg_match('/hash_([a-f0-9]{2})([a-f0-9]{32})/', $var_13, $var_150)) {
		$var_15['type']    = fn_16($var_150[1]);
		$var_15['version'] = strval(fn_17('0101'));
		$var_15['hash']    = $var_150[2];

		
		if (($var_15['type'] === false) || ($var_15['version'] === false)) {
			raise_message(7); 

			cacti_log(var_151 . ' ERROR type or version not found for hash: ' . $var_13, false, 'IMPORT', var_48);
			return false;
		}
	} else {
		
		if ($var_13 == '5240353b8f7f259acaf30e6229bc14e7') {
			return false;
		} elseif ($var_13 == 'd94caa7cc3733bd95ee00a3917fdcbb5') {
			return false;
		}

		raise_message(7); 

		cacti_log(var_151 . ' ERROR wrong hash format for hash: ' . $var_13, false, 'IMPORT', var_48);

		return false;
	}

	if (cacti_version_compare($var_15['version'], '1.2.3', '<')) {
		$var_9 = true;
	}

	return $var_15;
}

function fn_16($var_19) {
	global $var_5;

	
	$var_152 = $var_5;

	foreach ($var_152 as $var_28 => $var_29) {
		if ($var_29 == $var_19) {
			$var_153 = $var_28;
		}
	}

	if (!isset($var_153)) {
		raise_message(18); 
		return false;
	}

	return $var_153;
}

function fn_17($var_58) {
	global $var_6, $var_4;

	foreach ($var_6 as $var_154 => $var_29) {
		if ($var_154 == var_155) {
			$var_156 = $var_29;
		}

		if ($var_29 == $var_58) {
			$var_157 = $var_29;
			$var_158 = $var_154;
		}
	}

	if (!isset($var_156)) {
		cacti_log("ERROR: $var_58 Current Cacti Version does not exist!", false, 'IMPORT');
		raise_message(15); 
		return false;
	} elseif (!isset($var_157)) {
		cacti_log("ERROR: $var_58 hash version does not exist!", false, 'IMPORT');
		raise_message(16); 
		return false;
	} elseif ($var_157 > $var_156) {
		cacti_log("ERROR: $var_157 > $var_156", false, 'IMPORT');
		cacti_log("ERROR: $var_58 hash version is for a newer Cacti!", false, 'IMPORT');
		raise_message(17); 
		return false;
	}

	return $var_158;
}

function fn_18($var_159) {
	global $var_6;

	$var_30 = 0;

	foreach ($var_6 as $var_154 => $var_29) {
		if ($var_159 == $var_154) {
			return $var_30;
		}

		$var_30++;
	}

	
	return -1;
}

function fn_19($var_160) {
	if (function_exists('html_entity_decode')) {
		return html_entity_decode($var_160, var_161, 'UTF-8');
	} else {
		$var_162 = get_html_translation_table(var_163);
		$var_162 = array_flip($var_162);
		return strtr($var_160, $var_162);
	}
}

function fn_20($var_8, $var_52, $var_164 = false, $var_36 = false) {
	global $var_147;

	
	ob_start();

	if (cacti_sizeof($var_8)) {
		html_start_box(($var_36 ? __('Import Preview Results'):__('Import Results')), '100%', '', '3', 'center', '');

		if (cacti_sizeof($var_52)) {
			if ($var_36) {
				
			} else {
				
			}

			

			
			foreach($var_52 as $var_39 => $var_63) {
				
			}
			
		} else {
			if ($var_36) {
				
			} else {
				
			}
		}

		foreach ($var_8 as $var_28 => $var_165) {
			

			foreach ($var_165 as $var_166 => $var_167) {
				if ($var_167['result'] == 'success') {
					$var_168 = "<span class='success'>" . __('[success]') . "</span>";
				} elseif ($var_167['result'] == 'fail') {
					$var_168 = "<span class='failed'>" . __('[fail]') . "</span>";
				} else {
					$var_168 = "<span class='success'>" . __('[preview]') . "</span>";
				}

				if ($var_167['type'] == 'updated') {
					$var_169 = "<span class='updateObject'>" . __('[updated]') . "</span>\n";
				} elseif ($var_167['type'] == 'new') {
					$var_169 = "<span class='newObject'>" . __('[new]') . "</span>\n";
				} else {
					$var_169 = "<span class='deviceUp'>" . __('[unchanged]') . "</span>\n";
				}

				

				if (isset($var_167['orphans'])) {
					
					foreach($var_167['orphans'] as $var_170) {
						
					}
					
				}

				if (isset($var_167['new_items'])) {
					
					foreach($var_167['new_items'] as $var_73) {
						
					}
					
				}

				if (isset($var_167['differences'])) {
					
					foreach($var_167['differences'] as $var_171) {
						
					}
					
				}

				if (!$var_36) {
					$var_172   = '';
					$var_173 = false;

					if ((isset($var_167['dep'])) && (cacti_sizeof($var_167['dep']) > 0)) {
						foreach ($var_167['dep'] as $var_174 => $var_175) {
							if ($var_175 == 'met') {
								$var_176 = "<span class='foundDependency'>" . __('Found Dependency:') . "</span>";
							} else {
								$var_176 = "<span class='unmetDependency'>" . __('Unmet Dependency:') . "</span>";
								$var_173 = true;
							}

							$var_172 .= "<span class='monoSpace'>&nbsp;&nbsp;&nbsp;+ $var_176 " . fn_13($var_174, true) . "</span><br>\n";
						}
					}

					
					if ($var_173 == true) {
						
					}
				}
			}
		}

		

		html_end_box();
	}

	if ($var_164) {
		
	} else {
		$var_177 = ob_get_clean();
		$var_177 = explode("\n", $var_177);
		if (cacti_sizeof($var_177)) {
			foreach($var_177 as $var_178) {
				$var_178 = trim(str_replace('&nbsp;', '', strip_tags($var_178)));

				if ($var_178 != '') {
					
				}
			}
		}
	}
}

function fn_21($var_51) {
    if (is_object($var_51)) {
        $var_51 = get_object_vars($var_51);
    }
    return (is_array($var_51)) ? array_map(var_151,$var_51) : $var_51;
}

function fn_22($var_179) {
	if (preg_match('%^[a-zA-Z0-9/+]*={0,2}$%', $var_179)) {
		return true;
	} else {
		return false;
	}
}
