<?php





function fn_0($var_0 = null, $var_1 = null, $var_2 = true)
{
$var_3 = function($var_4) {
if ('mysql' === $var_4['database']['type'] && !extension_loaded('mysql') && extension_loaded('mysqli')) {
$var_4['database']['type'] = 'mysqli';
} elseif ('mysqli' === $var_4['database']['type'] && !extension_loaded('mysqli') && extension_loaded('mysql')) {
$var_4['database']['type'] = 'mysql';
}
return $var_4;
};
if (!$var_0) {
$var_0 = var_5 . '/var';
}
if ($var_1) {
$var_1 = '.' . $var_1;
}
$var_6 = fn_12();
$var_7 = $var_0 . '/' . $var_6 . $var_1 . '.conf.php';
$var_4 = @parse_ini_file($var_7, $var_2);
if (isset($var_4['realConfig'])) {
$var_8 = @parse_ini_file(var_5 . '/var/' . $var_4['realConfig'] . '.conf.php', $var_2);
$var_4 = fn_1($var_8, $var_4);
}
if (!empty($var_4)) {
return $var_3($var_4);
} elseif ($var_1 === '.plugin') {
$var_9 = basename($var_0);
$var_10 = var_5 . '/plugins/' . $var_9 . '/default.plugin.conf.php';
$var_4 = @parse_ini_file($var_10, $var_2);
if ($var_4 !== false) {
return $var_4;
}

exit(1);
}
$var_7 = $var_0 . '/default' . $var_1 . '.conf.php';
$var_4 = @parse_ini_file($var_7, $var_2);
if (isset($var_4['realConfig'])) {
$var_4 = @parse_ini_file(var_5 . '/var/' . $var_4['realConfig'] . '.conf.php', $var_2);
}
if (!empty($var_4)) {
return $var_3($var_4);
}
if (file_exists(var_5 . '/var/INSTALLED')) {

exit(1);
}

exit(1);
}
if (!function_exists('mergeConfigFiles'))
{
function fn_1($var_11, $var_12)
{
foreach ($var_12 as $var_13 => $var_14) {
if (is_array($var_14)) {
if (!isset($var_11[$var_13])) {
$var_11[$var_13] = array();
}
$var_11[$var_13] = fn_1($var_11[$var_13], $var_14);
} else {
if (isset($var_11[$var_13]) && is_array($var_11[$var_13])) {
$var_11[$var_13][0] = $var_14;
} else {
if (isset($var_11) && !is_array($var_11)) {
$var_15 = $var_11;
$var_11 = array();
$var_11[0] = $var_15;
}
$var_11[$var_13] = $var_14;
}
}
}
unset($var_11['realConfig']);
return $var_11;
}
}


function fn_2($var_16 = null)
{
if ($var_16 == 'maintenance') {
return 134217728;  }
return 134217728; }
function fn_3() {
$var_17 = ini_get('memory_limit');
if (empty($var_17) || $var_17 == -1) {
return -1;
}
$var_18 = array(
'G' => 1073741824,
'M' => 1048576,
'K' => 1024
);
$var_19 = $var_17;
foreach($var_18 as $var_20 => $var_21) {
$var_22 = strpos($var_17, $var_20);
if (!$var_22) {
$var_22 = strpos($var_17, strtolower($var_20));
}
if ($var_22) {
$var_19 = substr($var_17, 0, $var_22) * $var_21;
}
}
return $var_19;
}
function fn_4()
{
$var_19 = fn_3();
if ($var_19 == -1) {
return true;
}
fn_5($var_19 + 1);
$var_23 = fn_3();
$var_24 = ($var_19 != $var_23);
@ini_set('memory_limit', $var_19);
return $var_24;
}
function fn_5($var_25) {
$var_19 = fn_3();
if ($var_19 == -1) {
return true;
}
if ($var_25 > $var_19) {
if (@ini_set('memory_limit', $var_25) === false) {
return false;
}
}
return true;
}


function fn_6()
{
$var_455['_MAX']['MAX_DELIVERY_MULTIPLE_DELIMITER'] = '|';
$var_455['_MAX']['MAX_COOKIELESS_PREFIX'] = '__';
$var_455['_MAX']['thread_id'] = uniqid();
$var_455['_MAX']['SSL_REQUEST'] = false;
if (
(!empty($_SERVER['SERVER_PORT']) && !empty($var_455['_MAX']['CONF']['openads']['sslPort']) && ($_SERVER['SERVER_PORT'] == $var_455['_MAX']['CONF']['openads']['sslPort'])) ||
(!empty($_SERVER['HTTPS']) && ((strtolower($_SERVER['HTTPS']) == 'on') || ($_SERVER['HTTPS'] == 1))) ||
(!empty($_SERVER['HTTP_X_FORWARDED_PROTO']) && (strtolower($_SERVER['HTTP_X_FORWARDED_PROTO']) == 'https')) ||
(!empty($_SERVER['HTTP_X_FORWARDED_SSL']) && (strtolower($_SERVER['HTTP_X_FORWARDED_SSL']) == 'on')) ||
(!empty($_SERVER['HTTP_FRONT_END_HTTPS']) && (strtolower($_SERVER['HTTP_FRONT_END_HTTPS']) == 'on')) ||
(!empty($_SERVER['FRONT-END-HTTPS']) && (strtolower($_SERVER['FRONT-END-HTTPS']) == 'on'))
) {
$var_455['_MAX']['SSL_REQUEST'] = true;
}
$var_455['_MAX']['MAX_RAND'] = isset($var_455['_MAX']['CONF']['priority']['randmax']) ?
$var_455['_MAX']['CONF']['priority']['randmax'] : 2147483647;
list($var_26, $var_27) = explode(" ", microtime());
$var_455['_MAX']['NOW_ms'] = round(1000 *((float)$var_26 + (float)$var_27));
if (substr($_SERVER['SCRIPT_NAME'], -11) != 'install.php') {
$var_455['serverTimezone'] = date_default_timezone_get();
fn_10();
}
}
function fn_7()
{
if (empty($_SERVER['REQUEST_URI'])) {
$_SERVER['REQUEST_URI'] = $_SERVER['SCRIPT_NAME'];
if (!empty($_SERVER['QUERY_STRING'])) {
$_SERVER['REQUEST_URI'] .= '?' . $_SERVER['QUERY_STRING'];
}
}
}
function fn_8()
{
if (!defined('MAX_PATH')) {
define('MAX_PATH', dirname(var_28).'/../..');
}
if (!defined('OX_PATH')) {
define('OX_PATH', var_5);
}
if (!defined('RV_PATH')) {
define('RV_PATH', var_5);
}
if (!defined('LIB_PATH')) {
define('LIB_PATH', var_5. var_29. 'lib'. var_29. 'OX');
}
if ( !(isset($var_455['_MAX']['CONF']))) {
$var_455['_MAX']['CONF'] = fn_0();
}
fn_6();
}
function fn_9($var_30)
{
date_default_timezone_set($var_30);
$var_455['_DATE_TIMEZONE_DEFAULT'] = $var_30;
}
function fn_10()
{
fn_9('UTC');
}
function fn_11()
{
$var_31 = !empty($var_455['_MAX']['PREF']['timezone']) ? $var_455['_MAX']['PREF']['timezone'] : 'UTC';
fn_9($var_31);
}
function fn_12()
{
if (!empty($_SERVER['HTTP_HOST'])) {
$var_6 = explode(':', $_SERVER['HTTP_HOST']);
$var_6 = $var_6[0];
} else if (!empty($_SERVER['SERVER_NAME'])) {
$var_6 = explode(':', $_SERVER['SERVER_NAME']);
$var_6 = $var_6[0];
}
return $var_6;
}
function fn_13()
{
if (!empty($_SERVER['HTTP_HOST'])) {
$var_6 = $_SERVER['HTTP_HOST'];
} else if (!empty($_SERVER['SERVER_NAME'])) {
$var_6 = $_SERVER['SERVER_NAME'];
}
return $var_6;
}
function fn_14()
{
static $var_32;
if (isset($var_32)) {
return;
}
$var_32 = true;
$var_33 = var_5 . var_29 . 'lib' . var_29 . 'pear';
$var_34 = var_5 . var_29 . 'lib';
set_include_path($var_33 . var_35 . $var_34 . var_35 . get_include_path());
}
function fn_15()
{
return $var_455['_MAX']['DI'];
}

fn_5(fn_2());
if (!defined('E_DEPRECATED')) {
define('E_DEPRECATED', 0);
}
fn_7();
fn_8();
$var_4 = $var_455['_MAX']['CONF'];
$var_455['_OA']['invocationType'] = array_search(basename($_SERVER['SCRIPT_FILENAME']), $var_4['file']);
if (!empty($var_4['debug']['production'])) {
error_reporting(var_36 & ~(var_37 | var_38 | var_39 | var_40));
} else {
error_reporting(var_36 & ~(var_39 | var_40));
}

$var_41 = '/lib/max/Delivery/common.php';
$var_455['_MAX']['FILES'][$var_41] = true;

$var_41 = '/lib/max/Delivery/cookie.php';
$var_455['_MAX']['FILES'][$var_41] = true;
$var_455['_MAX']['COOKIE']['LIMITATIONS']['arrCappingCookieNames'] = array();
if (!is_callable('MAX_cookieSet')) {
if (!empty($var_4['cookie']['plugin']) && is_readable(var_5 . "/plugins/cookieStorage/{$var_4['cookie']['plugin']}.delivery.php")) {
} else {
function fn_16($var_42, $var_14, $var_43, $var_44 = '/', $var_45 = null) { return fn_31($var_42, $var_14, $var_43, $var_44, $var_45); }
function fn_17($var_42) { return fn_32($var_42); }
function fn_18() { return fn_33(); }
function fn_19() { return true; }
}
}
function fn_20($var_42, $var_14, $var_43 = 0)
{
if (!isset($var_455['_MAX']['COOKIE']['CACHE'])) {
$var_455['_MAX']['COOKIE']['CACHE'] = array();
}
$var_455['_MAX']['COOKIE']['CACHE'][$var_42] = array($var_14, $var_43);
}
function fn_21($var_48) {
$var_49 = $var_455['_MAX']['CONF'];
if (!empty($var_49['privacy']['disableViewerId'])) {
return;
}
fn_20($var_49['var']['viewerId'], $var_48, fn_23());
fn_18();
if ($var_455['_MAX']['SSL_REQUEST']) {
$var_50 = MAX_commonConstructSecureDeliveryUrl(basename($_SERVER['SCRIPT_NAME']));
} else {
$var_50 = MAX_commonConstructDeliveryUrl(basename($_SERVER['SCRIPT_NAME']));
}
$var_50 .= "?{$var_49['var']['cookieTest']}=1&" . $_SERVER['QUERY_STRING'];
MAX_header("Location: {$var_50}");
 var_51;
}
function fn_22()
{
return MAX_commonGetTimeNow() + 2592000; }
function fn_23()
{
return MAX_commonGetTimeNow() + 31536000; }
function fn_24()
{
return MAX_commonGetTimeNow() - 31536000; }
function fn_25()
{
$var_4 = $var_455['_MAX']['CONF'];
$var_53 = $var_455['_MAX']['COOKIE']['LIMITATIONS']['arrCappingCookieNames'];
if (!is_array($var_53))
return;
foreach ($var_53 as $var_54) {
if (!empty($_COOKIE[$var_54])) {
if (!is_array($_COOKIE[$var_54])) {
$var_55 = array();
$var_56 = explode('_', $_COOKIE[$var_54]);
foreach ($var_56 as $var_57) {
list($var_42, $var_14) = explode('.', $var_57);
$var_55[$var_42] = $var_14;
}
$_COOKIE[$var_54] = $var_55;
}
}
if (!empty($_COOKIE['_' . $var_54]) && is_array($_COOKIE['_' . $var_54])) {
foreach ($_COOKIE['_' . $var_54] as $var_58 => $var_59) {
if (fn_26($var_54)) {
$_COOKIE[$var_54][$var_58] = $var_59;
} else {
if (isset($_COOKIE[$var_54][$var_58])) {
$_COOKIE[$var_54][$var_58] += $var_59;
} else {
$_COOKIE[$var_54][$var_58] = $var_59;
}
}
fn_17("_{$var_54}[{$var_58}]");
}
}
}
}
function fn_26($var_54)
{
return in_array($var_54, array(
$var_455['_MAX']['CONF']['var']['blockAd'],
$var_455['_MAX']['CONF']['var']['blockCampaign'],
$var_455['_MAX']['CONF']['var']['blockZone'],
$var_455['_MAX']['CONF']['var']['lastView'],
$var_455['_MAX']['CONF']['var']['lastClick'],
$var_455['_MAX']['CONF']['var']['blockLoggingClick'],
));
}
function fn_27($var_60 = true)
{
static $var_61 = null;
 if (null !== $var_61) {
return $var_61;
}

$var_4 = $var_455['_MAX']['CONF'];
$var_62 = empty($var_4['privacy']['disableViewerId']) ? null : '01000111010001000101000001010010';
if (isset($_COOKIE[$var_4['var']['viewerId']])) {
$var_61 = $var_62 ?: $_COOKIE[$var_4['var']['viewerId']];
} elseif ($var_60) {
$var_61 = $var_62 ?: md5(uniqid('', true));
$var_455['_MAX']['COOKIE']['newViewerId'] = true;
} else {
$var_61 = null;
}
return $var_61;
}
function fn_28()
{
if (empty($_SERVER['REMOTE_ADDR']) || empty($_SERVER['HTTP_USER_AGENT'])) {
return '';
}
$var_63 = $var_455['_MAX']['MAX_COOKIELESS_PREFIX'];
return $var_63 . substr(md5($_SERVER['REMOTE_ADDR'].$_SERVER['HTTP_USER_AGENT']), 0, 32-(strlen($var_63)));
}
function fn_29()
{
if (isset($var_455['_OA']['invocationType']) &&
($var_455['_OA']['invocationType'] == 'xmlrpc' || $var_455['_OA']['invocationType'] == 'view')
) {
return true;
}
return !$var_455['_MAX']['CONF']['logging']['adImpressions'];
}
function fn_30($var_20, $var_64, $var_65 = 0, $var_66 = 0, $var_67 = 0)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_68 = false;
if ($var_66 > 0) {
$var_43 = MAX_commonGetTimeNow() + $var_4['cookie']['permCookieSeconds'];
if (!isset($_COOKIE[$var_4['var']['cap' . $var_20]][$var_64])) {
$var_14 = 1;
$var_68 = true;
} else if ($_COOKIE[$var_4['var']['cap' . $var_20]][$var_64] >= $var_66) {
$var_14 = -$_COOKIE[$var_4['var']['cap' . $var_20]][$var_64]+1;
$var_68 = true;
} else {
$var_14 = 1;
}
fn_20("_{$var_4['var']['cap' . $var_20]}[{$var_64}]", $var_14, $var_43);
}
if ($var_67 > 0) {
if (!isset($_COOKIE[$var_4['var']['sessionCap' . $var_20]][$var_64])) {
$var_14 = 1;
$var_68 = true;
} else if ($_COOKIE[$var_4['var']['sessionCap' . $var_20]][$var_64] >= $var_67) {
$var_14 = -$_COOKIE[$var_4['var']['sessionCap' . $var_20]][$var_64]+1;
$var_68 = true;
} else {
$var_14 = 1;
}
fn_20("_{$var_4['var']['sessionCap' . $var_20]}[{$var_64}]", $var_14, 0);
}
if ($var_65 > 0 || $var_68) {
fn_20("_{$var_4['var']['block' . $var_20]}[{$var_64}]", MAX_commonGetTimeNow(), fn_22());
}
}
function fn_31($var_42, $var_14, $var_69, $var_44 = '/', $var_45 = null, $var_70 = null, $var_71 = false, $var_72 = 'none')
{
 if (isset($var_455['_OA']['invocationType']) && $var_455['_OA']['invocationType'] == 'xmlrpc') {
if (!isset($var_455['_OA']['COOKIE']['XMLRPC_CACHE'])) {
$var_455['_OA']['COOKIE']['XMLRPC_CACHE'] = array();
}
$var_455['_OA']['COOKIE']['XMLRPC_CACHE'][$var_42] = array($var_14, $var_69);
} else {
$var_70 = $var_70 ?? !empty($var_455['_MAX']['SSL_REQUEST']);
if (var_73 < 70300) {
@setcookie($var_42, $var_14, $var_69, $var_44.'; samesite='.$var_72, $var_45, $var_70, $var_71);
} else {
@setcookie($var_42, $var_14, [
'expires' => $var_69,
'path' => $var_44,
'domain' => $var_45,
'secure' => $var_70,
'httponly' => $var_71,
'samesite' => $var_72,
]);
}
}
}
function fn_32($var_42)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_45 = (!empty($var_4['cookie']['domain'])) ? $var_4['cookie']['domain'] : null;
fn_16($var_42, false, fn_24(), '/', $var_45);
fn_16(str_replace('_', '%5F', urlencode($var_42)), false, fn_24(), '/', $var_45);
}
function fn_33()
{
$var_4 = $var_455['_MAX']['CONF'];
$var_45 = !empty($var_4['cookie']['domain']) ? $var_4['cookie']['domain'] : null;
fn_34();
if (!empty($var_455['_MAX']['COOKIE']['CACHE'])) {
reset($var_455['_MAX']['COOKIE']['CACHE']);
while (list($var_42,$var_74) = each ($var_455['_MAX']['COOKIE']['CACHE'])) {
list($var_14, $var_43) = $var_74;
if ($var_42 === $var_4['var']['viewerId']) {
fn_31($var_42, $var_14, $var_43, '/', !empty($var_4['cookie']['viewerIdDomain']) ? $var_4['cookie']['viewerIdDomain'] : $var_45);
} else {
fn_16($var_42, $var_14, $var_43, '/', $var_45);
}
}
$var_455['_MAX']['COOKIE']['CACHE'] = array();
}
$var_53 = $var_455['_MAX']['COOKIE']['LIMITATIONS']['arrCappingCookieNames'];
if (!is_array($var_53))
return;
$var_75 = !empty($var_4['cookie']['maxCookieSize']) ? $var_4['cookie']['maxCookieSize'] : 2048;
foreach ($var_53 as $var_54) {
if (empty($_COOKIE["_{$var_54}"])) {
continue;
}
switch ($var_54) {
case $var_4['var']['blockAd'] :
case $var_4['var']['blockCampaign'] :
case $var_4['var']['blockZone'] : $var_43 = fn_22(); break;
case $var_4['var']['lastClick'] :
case $var_4['var']['lastView'] :
case $var_4['var']['capAd'] :
case $var_4['var']['capCampaign'] :
case $var_4['var']['capZone'] : $var_43 = fn_23(); break;
case $var_4['var']['sessionCapCampaign'] :
case $var_4['var']['sessionCapAd'] :
case $var_4['var']['sessionCapZone'] : $var_43 = 0; break;
}
if (!empty($_COOKIE[$var_54]) && is_array($_COOKIE[$var_54])) {
$var_56 = array();
foreach ($_COOKIE[$var_54] as $var_58 => $var_14) {
$var_56[] = "{$var_58}.{$var_14}";
}
while (strlen(implode('_', $var_56)) > $var_75) {
$var_56 = array_slice($var_56, 1);
}
fn_16($var_54, implode('_', $var_56), $var_43, '/', $var_45);
}
}
}
function fn_34() {
if ($var_455['_MAX']['CONF']['p3p']['policies']) {
MAX_header("P3P: ". fn_35());
}
}
function fn_35()
{
$var_4 = $var_455['_MAX']['CONF'];
$var_76 = '';
if ($var_4['p3p']['policies']) {
if ($var_4['p3p']['policyLocation'] != '') {
$var_76 .= " policyref=\"".$var_4['p3p']['policyLocation']."\"";
}
if ($var_4['p3p']['policyLocation'] != '' && $var_4['p3p']['compactPolicy'] != '') {
$var_76 .= ", ";
}
if ($var_4['p3p']['compactPolicy'] != '') {
$var_76 .= " CP=\"".$var_4['p3p']['compactPolicy']."\"";
}
}
return $var_76;
}


$var_41 = '/lib/max/Delivery/remotehost.php';
$var_455['_MAX']['FILES'][$var_41] = true;
function fn_36($var_78 = false)
{
if (empty($var_455['_OA']['invocationType']) || $var_78 || ($var_455['_OA']['invocationType'] != 'xmlrpc')) {
fn_37();
fn_40();
fn_38();
fn_39();
}
}
function fn_37()
{
$var_4 = $var_455['_MAX']['CONF'];
if ($var_4['logging']['proxyLookup']) {
OX_Delivery_logMessage('checking remote host proxy', 7);
$var_79 = false;
if (!empty($_SERVER['HTTP_VIA']) || !empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
$var_79 = true;
} elseif (!empty($_SERVER['REMOTE_HOST'])) {
$var_80 = array(
'proxy',
'cache',
'inktomi'
);
foreach ($var_80 as $var_81) {
if (strpos($_SERVER['REMOTE_HOST'], $var_81) !== false) {
$var_79 = true;
break;
}
}
}
if ($var_79) {
OX_Delivery_logMessage('proxy detected', 7);
$var_82 = array(
'HTTP_FORWARDED',
'HTTP_FORWARDED_FOR',
'HTTP_X_FORWARDED',
'HTTP_X_FORWARDED_FOR',
'HTTP_CLIENT_IP'
);
foreach ($var_82 as $var_83) {
if (!empty($_SERVER[$var_83])) {
$var_84 = $_SERVER[$var_83];
break;
}
}
if (!empty($var_84)) {
foreach (explode(',', $var_84) as $var_84) {
$var_84 = trim($var_84);
if (($var_84 != 'unknown') && (!fn_41($var_84))) {
$_SERVER['REMOTE_ADDR'] = $var_84;
$_SERVER['REMOTE_HOST'] = '';
$_SERVER['HTTP_VIA'] = '';
OX_Delivery_logMessage('real address set to '.$var_84, 7);
break;
}
}
}
}
}
}
function fn_38()
{
if (empty($_SERVER['REMOTE_HOST'])) {
if ($var_455['_MAX']['CONF']['logging']['reverseLookup']) {
$_SERVER['REMOTE_HOST'] = @gethostbyaddr($_SERVER['REMOTE_ADDR']);
} else {
$_SERVER['REMOTE_HOST'] = $_SERVER['REMOTE_ADDR'];
}
}
}
function fn_39()
{
if (!function_exists('parseDeliveryIniFile')) {

}
$var_49 = $var_455['_MAX']['CONF'];
$var_20 = (!empty($var_49['geotargeting']['type'])) ? $var_49['geotargeting']['type'] : null;
if (!is_null($var_20) && $var_20 != 'none') {
$var_85 = explode(':', $var_49['geotargeting']['type']);
if (!empty($var_85[1]) && (!empty($var_49['pluginGroupComponents'][$var_85[1]]))) {
$var_455['_MAX']['CLIENT_GEO'] = OX_Delivery_Common_hook('getGeoInfo', array(), $var_20);
}
}
}
function fn_40()
{
if (!empty($var_455['_MAX']['CONF']['privacy']['anonymiseIp'])) {
$_SERVER['REMOTE_ADDR'] = preg_replace('/\d+$/', '0', $_SERVER['REMOTE_ADDR']);
}
}
function fn_41($var_84)
{
$var_84 = ip2long($var_84);
if (!$var_84) return false;
return (fn_42($var_84, '10.0.0.0', 8) ||
fn_42($var_84, '172.16.0.0', 12) ||
fn_42($var_84, '192.168.0.0', 16) ||
fn_42($var_84, '127.0.0.0', 8)
);
}
function fn_42($var_84, $var_86, $var_87)
{
$var_86 = ip2long($var_86);
if (!is_integer($var_84)) {
$var_84 = ip2long($var_84);
}
if (!$var_84 || !$var_86) {
return false;
}
if (is_integer($var_87)) {
if ($var_87 > 32 || $var_87 <= 0)
return false;
elseif ($var_87 == 32)
$var_87 = ~0;
else
$var_87 = ~((1 << (32 - $var_87)) - 1);
} elseif (!($var_87 = ip2long($var_87))) {
return false;
}
return ($var_84 & $var_87) == ($var_86 & $var_87) ? true : false;
}


$var_41 = '/lib/max/Delivery/log.php';
$var_455['_MAX']['FILES'][$var_41] = true;

$var_41 = '/lib/max/Dal/Delivery.php';
$var_455['_MAX']['FILES'][$var_41] = true;

$var_41 = '/lib/OA/Dal/Delivery.php';
$var_455['_MAX']['FILES'][$var_41] = true;
function fn_43($var_88) {
return is_resource($var_88) || $var_88 instanceof var_89;
}
function fn_44()
{
$var_49 = $var_455['_MAX']['CONF'];
$var_90 = "
        SELECT
            value
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['application_variable'])."
        WHERE
            name = 'admin_account_id'
    ";
$var_91 = OA_Dal_Delivery_query($var_90);
if (fn_43($var_91) && OA_Dal_Delivery_numRows($var_91)) {
$var_92 = (int)OA_Dal_Delivery_result($var_91, 0, 0);
} else {
$var_92 = false;
}
$var_90 = "
        SELECT
            a.account_id AS account_id,
            apa.value AS timezone
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['accounts'])." AS a JOIN
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['account_preference_assoc'])." AS apa ON (apa.account_id = a.account_id) JOIN
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['preferences'])." AS p ON (p.preference_id = apa.preference_id)
        WHERE
            a.account_type IN ('ADMIN', 'MANAGER') AND
            p.preference_name = 'timezone'
    ";
$var_91 = OA_Dal_Delivery_query($var_90);
$var_93 = array(
'adminAccountId' => $var_92,
'aAccounts' => array()
);
if (fn_43($var_91)) {
while ($var_94 = OA_Dal_Delivery_fetchAssoc($var_91)) {
$var_95 = (int)$var_94['account_id'];
if ($var_95 === $var_92) {
$var_93['default'] = $var_94['timezone'];
} else {
$var_93['aAccounts'][$var_95] = $var_94['timezone'];
}
}
}
if (empty($var_93['default'])) {
$var_93['default'] = 'UTC';
}
return $var_93;
}
function fn_45($var_96) {
$var_49 = $var_455['_MAX']['CONF'];
$var_96 = (int)$var_96;
$var_90 = "
        SELECT
            z.zoneid AS zone_id,
            z.zonename AS name,
            z.delivery AS type,
            z.description AS description,
            z.width AS width,
            z.height AS height,
            z.chain AS chain,
            z.prepend AS prepend,
            z.append AS append,
            z.appendtype AS appendtype,
            z.forceappend AS forceappend,
            z.inventory_forecast_type AS inventory_forecast_type,
            z.block AS block_zone,
            z.capping AS cap_zone,
            z.session_capping AS session_cap_zone,
            z.show_capped_no_cookie AS show_capped_no_cookie_zone,
            z.ext_adselection AS ext_adselection,
            z.affiliateid AS publisher_id,
            a.agencyid AS agency_id,
            a.account_id AS trafficker_account_id,
            m.account_id AS manager_account_id,
            m.status AS account_status
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['zones'])." AS z,
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['affiliates'])." AS a,
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['agency'])." AS m
        WHERE
            z.zoneid = {$var_96}
          AND
            z.affiliateid = a.affiliateid
          AND
            a.agencyid = m.agencyid";
$var_97 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_97)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : false;
}
$var_99 = OA_Dal_Delivery_fetchAssoc($var_97);
if (empty($var_99)) {
return [
'default' => true,
'default_banner_html' => $var_49['defaultBanner']['invalidZoneHtmlBanner'] ?? '',
'skip_log_request' => true,
'skip_log_blank' => true,
];
}
switch ($var_99['account_status']) {
case 4:  return [
'default' => true,
'default_banner_html' => $var_49['defaultBanner']['inactiveAccountHtmlBanner'] ?? '',
'skip_log_blank' => true,
];
case 1:  return [
'default' => true,
'default_banner_html' => $var_49['defaultBanner']['suspendedAccountHtmlBanner'] ?? '',
'skip_log_blank' => true,
];
}
$var_90 = "
        SELECT
            p.preference_id AS preference_id,
            p.preference_name AS preference_name
        FROM
            {$var_49['table']['prefix']}{$var_49['table']['preferences']} AS p
        WHERE
            p.preference_name = 'default_banner_image_url'
            OR
            p.preference_name = 'default_banner_destination_url'";
$var_100 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_100)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : false;
}
if (OA_Dal_Delivery_numRows($var_100) != 2) {
return $var_99;
}
$var_101 = OA_Dal_Delivery_fetchAssoc($var_100);
$var_102 = $var_101['preference_name'] . '_id';
$$var_102 = $var_101['preference_id'];
$var_101 = OA_Dal_Delivery_fetchAssoc($var_100);
$var_102 = $var_101['preference_name'] . '_id';
$$var_102 = $var_101['preference_id'];
$var_90 = "
        SELECT
            'default_banner_destination_url_trafficker' AS item,
            apa.value AS value
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['account_preference_assoc'])." AS apa
        WHERE
            apa.account_id = {$var_99['trafficker_account_id']}
            AND
            apa.preference_id = $var_103
        UNION
        SELECT
            'default_banner_destination_url_manager' AS item,
            apa.value AS value
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['account_preference_assoc'])." AS apa
        WHERE
            apa.account_id = {$var_99['manager_account_id']}
            AND
            apa.preference_id = $var_103
        UNION
        SELECT
            'default_banner_image_url_trafficker' AS item,
            apa.value AS value
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['account_preference_assoc'])." AS apa
        WHERE
            apa.account_id = {$var_99['trafficker_account_id']}
            AND
            apa.preference_id = $var_104
        UNION
        SELECT
            'default_banner_image_url_manager' AS item,
            apa.value AS value
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['account_preference_assoc'])." AS apa
        WHERE
            apa.account_id = {$var_99['manager_account_id']}
            AND
            apa.preference_id = $var_104
        UNION
        SELECT
            'default_banner_image_url_admin' AS item,
            apa.value AS value
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['account_preference_assoc'])." AS apa,
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['accounts'])." AS a
        WHERE
            apa.account_id = a.account_id
            AND
            a.account_type = 'ADMIN'
            AND
            apa.preference_id = $var_104
        UNION
        SELECT
            'default_banner_destination_url_admin' AS item,
            apa.value AS value
        FROM
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['account_preference_assoc'])." AS apa,
            ".OX_escapeIdentifier($var_49['table']['prefix'].$var_49['table']['accounts'])." AS a
        WHERE
            apa.account_id = a.account_id
            AND
            a.account_type = 'ADMIN'
            AND
            apa.preference_id = $var_103";
$var_105 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_105)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : false;
}
if (OA_Dal_Delivery_numRows($var_105) == 0) {
if ($var_49['defaultBanner']['imageUrl'] != '') {
$var_99['default_banner_image_url'] = $var_49['defaultBanner']['imageUrl'];
}
return $var_99;
}
$var_106 = array();
$var_107 = array();
while ($var_108 = OA_Dal_Delivery_fetchAssoc($var_105)) {
if (stristr($var_108['item'], 'default_banner_image_url')) {
$var_106[$var_108['item']] = $var_108['value'];
} else if (stristr($var_108['item'], 'default_banner_destination_url')) {
$var_107[$var_108['item']] = $var_108['value'];
}
}
$var_109 = array(
0 => 'admin',
1 => 'manager',
2 => 'trafficker'
);
foreach ($var_109 as $var_20) {
if (isset($var_106['default_banner_image_url_' . $var_20])) {
$var_99['default_banner_image_url'] = $var_106['default_banner_image_url_' . $var_20];
}
if (isset($var_107['default_banner_destination_url_' . $var_20])) {
$var_99['default_banner_destination_url'] = $var_107['default_banner_destination_url_' . $var_20];
}
}
return $var_99;
}
function fn_46($var_110) {
$var_4 = $var_455['_MAX']['CONF'];
$var_110 = (int)$var_110;
$var_111 = OA_Dal_Delivery_query("
    SELECT
        z.zoneid AS zone_id,
        z.affiliateid AS publisher_id,
        z.zonename AS name,
        z.delivery AS type
    FROM
        ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['zones'])." AS z
    WHERE
        z.affiliateid={$var_110}
    ");
if (!fn_43($var_111)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : false;
}
while ($var_112 = OA_Dal_Delivery_fetchAssoc($var_111)) {
$var_113[$var_112['zone_id']] = $var_112;
}
return ($var_113);
}
function fn_47($var_96) {
$var_4 = $var_455['_MAX']['CONF'];
$var_96 = (int)$var_96;
$var_114 = fn_45($var_96);
$var_114['xAds'] = array();
$var_114['ads'] = array();
$var_114['lAds'] = array();
$var_114['eAds'] = array();
$var_114['count_active'] = 0;
$var_114['zone_companion'] = false;
$var_114['count_active'] = 0;
$var_115 = array(
'xAds' => 0,
'ads' => 0,
'lAds' => 0
);
if (!empty($var_114['default'])) {
return $var_114;
}
$var_90 = "
        SELECT
            d.bannerid AS ad_id,
            d.campaignid AS placement_id,
            d.status AS status,
            d.description AS name,
            d.storagetype AS type,
            d.contenttype AS contenttype,
            d.pluginversion AS pluginversion,
            d.filename AS filename,
            d.imageurl AS imageurl,
            d.htmltemplate AS htmltemplate,
            d.htmlcache AS htmlcache,
            d.width AS width,
            d.height AS height,
            d.weight AS weight,
            d.seq AS seq,
            d.target AS target,
            d.url AS url,
            d.alt AS alt,
            d.statustext AS statustext,
            d.bannertext AS bannertext,
            d.adserver AS adserver,
            d.block AS block_ad,
            d.capping AS cap_ad,
            d.session_capping AS session_cap_ad,
            d.compiledlimitation AS compiledlimitation,
            d.acl_plugins AS acl_plugins,
            d.prepend AS prepend,
            d.append AS append,
            d.bannertype AS bannertype,
            d.alt_filename AS alt_filename,
            d.alt_imageurl AS alt_imageurl,
            d.alt_contenttype AS alt_contenttype,
            d.parameters AS parameters,
            d.transparent AS transparent,
            d.ext_bannertype AS ext_bannertype,
            d.iframe_friendly AS iframe_friendly,
            az.priority AS priority,
            az.priority_factor AS priority_factor,
            az.to_be_delivered AS to_be_delivered,
            c.campaignid AS campaign_id,
            c.campaignname AS campaign_name,
            c.priority AS campaign_priority,
            c.weight AS campaign_weight,
            c.companion AS campaign_companion,
            c.block AS block_campaign,
            c.capping AS cap_campaign,
            c.session_capping AS session_cap_campaign,
            c.show_capped_no_cookie AS show_capped_no_cookie,
            c.clientid AS client_id,
            c.expire_time AS expire_time,
            c.revenue_type AS revenue_type,
            c.ecpm_enabled AS ecpm_enabled,
            c.ecpm AS ecpm,
            c.clickwindow AS clickwindow,
            c.viewwindow AS viewwindow,
            m.advertiser_limitation AS advertiser_limitation,
            a.account_id AS account_id,
            z.affiliateid AS affiliate_id,
            a.agencyid as agency_id
        FROM
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['banners'])." AS d JOIN
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['ad_zone_assoc'])." AS az ON (d.bannerid = az.ad_id) JOIN
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['zones'])." AS z ON (az.zone_id = z.zoneid) JOIN
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['campaigns'])." AS c ON (c.campaignid = d.campaignid) LEFT JOIN
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['clients'])." AS m ON (m.clientid = c.clientid) LEFT JOIN
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['agency'])." AS a ON (a.agencyid = m.agencyid)
        WHERE
            az.zone_id = {$var_96}
          AND
            d.status <= 0
          AND
            c.status <= 0
    ";
$var_116 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_116)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
}
$var_117 = MAX_cacheGetTrackerLinkedCreatives();
while ($var_118 = OA_Dal_Delivery_fetchAssoc($var_116)) {
$var_118['tracker_status'] = (!empty($var_117[$var_118['ad_id']]['status'])) ? $var_117[$var_118['ad_id']]['status'] : null;
if ($var_118['campaign_priority'] == -1) {
$var_114['xAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} elseif ($var_118['campaign_priority'] == 0) {
$var_114['lAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} elseif ($var_118['campaign_priority'] == -2) {
$var_114['eAds'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} else {
$var_114['ads'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
}
if ($var_118['campaign_companion'] == 1) {
$var_114['zone_companion'][] = $var_118['placement_id'];
}
}
if (is_array($var_114['xAds'])) {
$var_115['xAds'] = _setPriorityFromWeights($var_114['xAds']);
}
if (is_array($var_114['ads'])) {
$var_115['ads'] = _getTotalPrioritiesByCP($var_114['ads']);
}
if (is_array($var_114['eAds'])) {
$var_115['eAds'] = _getTotalPrioritiesByCP($var_114['eAds']);
}
if (is_array($var_114['lAds'])) {
$var_115['lAds'] = _setPriorityFromWeights($var_114['lAds']);
}
$var_114['priority'] = $var_115;
return $var_114;
}
function fn_48($var_96) {
$var_4 = $var_455['_MAX']['CONF'];
$var_96 = (int)$var_96;
$var_114['xAds'] = array();
$var_114['ads'] = array();
$var_114['lAds'] = array();
$var_114['eAds'] = array();
$var_114['zone_companion'] = false;
$var_114['count_active'] = 0;
$var_90 =
"SELECT "
."d.bannerid AS ad_id, "  ."d.campaignid AS placement_id, "  ."d.status AS status, "  ."d.width AS width, "
."d.ext_bannertype AS ext_bannertype, "
."d.height AS height, "
."d.storagetype AS type, "  ."d.contenttype AS contenttype, "  ."d.weight AS weight, "  ."d.adserver AS adserver, "  ."d.block AS block_ad, "  ."d.capping AS cap_ad, "  ."d.session_capping AS session_cap_ad, "  ."d.compiledlimitation AS compiledlimitation, "  ."d.acl_plugins AS acl_plugins, "  ."d.alt_filename AS alt_filename, "  ."az.priority AS priority, "  ."az.priority_factor AS priority_factor, "  ."az.to_be_delivered AS to_be_delivered, "  ."c.campaignid AS campaign_id, "  ."c.priority AS campaign_priority, "  ."c.weight AS campaign_weight, "  ."c.companion AS campaign_companion, "  ."c.block AS block_campaign, "  ."c.capping AS cap_campaign, "  ."c.session_capping AS session_cap_campaign, " ."c.show_capped_no_cookie AS show_capped_no_cookie, "
."c.clientid AS client_id, "  ."c.expire_time AS expire_time, "
."c.revenue_type AS revenue_type, "
."c.ecpm_enabled AS ecpm_enabled, "
."c.ecpm AS ecpm, "
."ct.status AS tracker_status, "
.OX_Dal_Delivery_regex("d.htmlcache", "src\\s?=\\s?[\\'\"]http:")." AS html_ssl_unsafe, "
.OX_Dal_Delivery_regex("d.imageurl", "^http:")." AS url_ssl_unsafe "
."FROM "
.OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['banners'])." AS d JOIN "
.OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['ad_zone_assoc'])." AS az ON (d.bannerid = az.ad_id) JOIN "
.OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['campaigns'])." AS c ON (c.campaignid = d.campaignid) LEFT JOIN "
.OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['campaigns_trackers'])." AS ct ON (ct.campaignid = c.campaignid) "
."WHERE "
."az.zone_id = {$var_96} "
."AND "
."d.status <= 0 "
."AND "
."c.status <= 0 ";
$var_116 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_116)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
}
while ($var_118 = OA_Dal_Delivery_fetchAssoc($var_116)) {
if ($var_118['campaign_priority'] == -1) {
$var_114['xAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} elseif ($var_118['campaign_priority'] == 0) {
$var_114['lAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} elseif ($var_118['campaign_priority'] == -2) {
$var_114['eAds'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} else {
$var_114['ads'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
}
if ($var_118['campaign_companion'] == 1) {
$var_114['zone_companion'][] = $var_118['placement_id'];  }
}
return $var_114;
}
function fn_49($var_119, $var_120 = '', $var_121 = true) {
$var_4 = $var_455['_MAX']['CONF'];
$var_120 = (int)$var_120;
if ($var_120 > 0) {
$var_122 = " AND d.campaignid = '".$var_120."' ";
} else {
$var_122 = '';
}
$var_114['xAds'] = array();
$var_114['ads'] = array();
$var_114['lAds'] = array();
$var_114['count_active'] = 0;
$var_114['zone_companion'] = false;
$var_114['count_active'] = 0;
$var_115 = array(
'xAds' => 0,
'ads' => 0,
'lAds' => 0
);
$var_90 = OA_Dal_Delivery_buildAdInfoQuery($var_119, $var_121, $var_122);
$var_116 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_116)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
}
while ($var_118 = OA_Dal_Delivery_fetchAssoc($var_116)) {
if ($var_118['campaign_priority'] == -1) {
$var_118['priority'] = $var_118['campaign_weight'] * $var_118['weight'];
$var_114['xAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
$var_115['xAds'] += $var_118['priority'];
} elseif ($var_118['campaign_priority'] == 0) {
$var_118['priority'] = $var_118['campaign_weight'] * $var_118['weight'];
$var_114['lAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
$var_115['lAds'] += $var_118['priority'];
} elseif ($var_118['campaign_priority'] == -2) {
$var_114['eAds'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} else {
$var_114['ads'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
}
}
return $var_114;
}
function fn_50($var_119, $var_120 = '', $var_121 = true) {
$var_4 = $var_455['_MAX']['CONF'];
$var_120 = (int)$var_120;
if ($var_120 > 0) {
$var_122 = " AND d.campaignid = '".$var_120."' ";
} else {
$var_122 = '';
}
$var_114['xAds'] = array();
$var_114['ads'] = array();
$var_114['lAds'] = array();
$var_114['count_active'] = 0;
$var_114['zone_companion'] = false;
$var_114['count_active'] = 0;
$var_115 = array(
'xAds' => 0,
'ads' => 0,
'lAds' => 0
);
$var_90 = OA_Dal_Delivery_buildQuery($var_119, $var_121, $var_122);
$var_116 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_116)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
}
$var_117 = MAX_cacheGetTrackerLinkedCreatives();
while ($var_118 = OA_Dal_Delivery_fetchAssoc($var_116)) {
$var_118['tracker_status'] = (!empty($var_117[$var_118['ad_id']]['status'])) ? $var_117[$var_118['ad_id']]['status'] : null;
if ($var_118['campaign_priority'] == -1) {
$var_118['priority'] = $var_118['campaign_weight'] * $var_118['weight'];
$var_114['xAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
$var_115['xAds'] += $var_118['priority'];
} elseif ($var_118['campaign_priority'] == 0) {
$var_118['priority'] = $var_118['campaign_weight'] * $var_118['weight'];
$var_114['lAds'][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
$var_115['lAds'] += $var_118['priority'];
} elseif ($var_118['campaign_priority'] == -2) {
$var_114['eAds'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
} else {
$var_114['ads'][$var_118['campaign_priority']][$var_118['ad_id']] = $var_118;
$var_114['count_active']++;
}
}
if (isset($var_114['xAds']) && is_array($var_114['xAds'])) {
$var_115['xAds'] = _setPriorityFromWeights($var_114['xAds']);
}
if (isset($var_114['ads']) && is_array($var_114['ads'])) {
if (isset($var_114['lAds']) && is_array($var_114['lAds']) && count($var_114['lAds']) > 0) {
$var_115['ads'] = _getTotalPrioritiesByCP($var_114['ads'], true);
} else {
$var_115['ads'] = _getTotalPrioritiesByCP($var_114['ads'], false);
}
}
if (is_array($var_114['eAds'])) {
$var_115['eAds'] = _getTotalPrioritiesByCP($var_114['eAds']);
}
if (isset($var_114['lAds']) && is_array($var_114['lAds'])) {
$var_115['lAds'] = _setPriorityFromWeights($var_114['lAds']);
}
$var_114['priority'] = $var_115;
return $var_114;
}
function fn_51($var_123) {
$var_4 = $var_455['_MAX']['CONF'];
$var_123 = (int)$var_123;
$var_90 = "
        SELECT
        d.bannerid AS ad_id,
        d.campaignid AS placement_id,
        d.status AS status,
        d.description AS name,
        d.storagetype AS type,
        d.contenttype AS contenttype,
        d.pluginversion AS pluginversion,
        d.filename AS filename,
        d.imageurl AS imageurl,
        d.htmltemplate AS htmltemplate,
        d.htmlcache AS htmlcache,
        d.width AS width,
        d.height AS height,
        d.weight AS weight,
        d.seq AS seq,
        d.target AS target,
        d.url AS url,
        d.alt AS alt,
        d.statustext AS statustext,
        d.bannertext AS bannertext,
        d.adserver AS adserver,
        d.block AS block_ad,
        d.capping AS cap_ad,
        d.session_capping AS session_cap_ad,
        d.compiledlimitation AS compiledlimitation,
        d.acl_plugins AS acl_plugins,
        d.prepend AS prepend,
        d.append AS append,
        d.bannertype AS bannertype,
        d.alt_filename AS alt_filename,
        d.alt_imageurl AS alt_imageurl,
        d.alt_contenttype AS alt_contenttype,
        d.parameters AS parameters,
        d.transparent AS transparent,
        d.ext_bannertype AS ext_bannertype,
        d.iframe_friendly AS iframe_friendly,
        c.campaignid AS campaign_id,
        c.block AS block_campaign,
        c.capping AS cap_campaign,
        c.session_capping AS session_cap_campaign,
        c.show_capped_no_cookie AS show_capped_no_cookie,
        m.clientid AS client_id,
        c.clickwindow AS clickwindow,
        c.viewwindow AS viewwindow,
        m.advertiser_limitation AS advertiser_limitation,
        m.agencyid AS agency_id,
        c.status AS campaign_status
    FROM
        ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['banners'])." AS d,
        ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['campaigns'])." AS c,
        ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['clients'])." AS m
    WHERE
        d.bannerid={$var_123}
        AND
        d.campaignid = c.campaignid
        AND
        m.clientid = c.clientid
    ";
$var_124 = OA_Dal_Delivery_query($var_90);
if (!fn_43($var_124)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
} else {
return (OA_Dal_Delivery_fetchAssoc($var_124));
}
}
function fn_52($var_125) {
$var_4 = $var_455['_MAX']['CONF'];
$var_125 = (int)$var_125;
$var_126 = OA_Dal_Delivery_query("
    SELECT
            acl_plugins,compiledlimitation
    FROM
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['channel'])."
    WHERE
            channelid={$var_125}");
if (!fn_43($var_126)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
}
$var_127 = OA_Dal_Delivery_fetchAssoc($var_126);
return $var_127;
}
function fn_53($var_128)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_129 = OA_Dal_Delivery_query("
        SELECT
            contents,
            t_stamp
        FROM
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['images'])."
        WHERE
            filename = '".OX_escapeString($var_128)."'
    ");
if (!fn_43($var_129)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
} else {
$var_93 = OA_Dal_Delivery_fetchAssoc($var_129);
$var_93['contents'] = OX_unescapeBlob($var_93['contents']);
$var_93['t_stamp'] = strtotime($var_93['t_stamp'] . ' GMT');
return ($var_93);
}
}
function fn_54($var_130)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_130 = (int)$var_130;
$var_131 = OA_Dal_Delivery_query("
        SELECT
            t.clientid AS advertiser_id,
            t.trackerid AS tracker_id,
            t.trackername AS name,
            t.variablemethod AS variablemethod,
            t.description AS description,
            t.viewwindow AS viewwindow,
            t.clickwindow AS clickwindow,
            t.blockwindow AS blockwindow,
            t.appendcode AS appendcode
        FROM
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['trackers'])." AS t
        WHERE
            t.trackerid={$var_130}
    ");
if (!fn_43($var_131)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
} else {
return (OA_Dal_Delivery_fetchAssoc($var_131));
}
}
function fn_55($var_130 = null)
{
$var_49 = $var_455['_MAX']['CONF'];
$var_130 = (int)$var_130;
$var_132 = OA_Dal_Delivery_query("
        SELECT
            b.bannerid AS ad_id,
            b.campaignid AS placement_id,
            c.viewwindow AS view_window,
            c.clickwindow AS click_window,
            ct.status AS status,
            t.type AS tracker_type
        FROM
            {$var_49['table']['prefix']}{$var_49['table']['banners']} AS b,
            {$var_49['table']['prefix']}{$var_49['table']['campaigns_trackers']} AS ct,
            {$var_49['table']['prefix']}{$var_49['table']['campaigns']} AS c,
            {$var_49['table']['prefix']}{$var_49['table']['trackers']} AS t
        WHERE
          ct.trackerid=t.trackerid
          AND c.campaignid=b.campaignid
          AND b.campaignid = ct.campaignid
          " . ((!empty($var_130)) ? ' AND t.trackerid='.$var_130 : '') . "
    ");
if (!fn_43($var_132)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
} else {
$var_55 = array();
while ($var_108 = OA_Dal_Delivery_fetchAssoc($var_132)) {
$var_55[$var_108['ad_id']] = $var_108;
}
return $var_55;
}
}
function fn_56($var_130)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_130 = (int)$var_130;
$var_133 = OA_Dal_Delivery_query("
        SELECT
            v.variableid AS variable_id,
            v.trackerid AS tracker_id,
            v.name AS name,
            v.datatype AS type,
            purpose AS purpose,
			reject_if_empty AS reject_if_empty,
			is_unique AS is_unique,
			unique_window AS unique_window,
            v.variablecode AS variablecode
        FROM
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['variables'])." AS v
        WHERE
            v.trackerid={$var_130}
    ");
if (!fn_43($var_133)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
} else {
$var_55 = array();
while ($var_108 = OA_Dal_Delivery_fetchAssoc($var_133)) {
$var_55[$var_108['variable_id']] = $var_108;
}
return $var_55;
}
}
function fn_57()
{
$var_4 = $var_455['_MAX']['CONF'];
$var_88 = OA_Dal_Delivery_query("
        SELECT
            value AS maintenance_timestamp
        FROM
            ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['application_variable'])."
        WHERE name = 'maintenance_timestamp'
    ");
if (!fn_43($var_88)) {
return (defined('OA_DELIVERY_CACHE_FUNCTION_ERROR')) ? var_98 : null;
} else {
$var_88 = OA_Dal_Delivery_fetchAssoc($var_88);
return $var_88['maintenance_timestamp'];
}
}
function var_134($var_135, $var_121, $var_122)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_136 = array(
'd.bannerid AS ad_id',
'd.campaignid AS placement_id',
'd.status AS status',
'd.description AS name',
'd.storagetype AS type',
'd.contenttype AS contenttype',
'd.pluginversion AS pluginversion',
'd.filename AS filename',
'd.imageurl AS imageurl',
'd.htmltemplate AS htmltemplate',
'd.htmlcache AS htmlcache',
'd.width AS width',
'd.height AS height',
'd.weight AS weight',
'd.seq AS seq',
'd.target AS target',
'd.url AS url',
'd.alt AS alt',
'd.statustext AS statustext',
'd.bannertext AS bannertext',
'd.adserver AS adserver',
'd.block AS block_ad',
'd.capping AS cap_ad',
'd.session_capping AS session_cap_ad',
'd.compiledlimitation AS compiledlimitation',
'd.acl_plugins AS acl_plugins',
'd.prepend AS prepend',
'd.append AS append',
'd.bannertype AS bannertype',
'd.alt_filename AS alt_filename',
'd.alt_imageurl AS alt_imageurl',
'd.alt_contenttype AS alt_contenttype',
'd.parameters AS parameters',
'd.transparent AS transparent',
'd.ext_bannertype AS ext_bannertype',
'd.iframe_friendly AS iframe_friendly',
'az.priority AS priority',
'az.priority_factor AS priority_factor',
'az.to_be_delivered AS to_be_delivered',
'm.campaignid AS campaign_id',
'm.priority AS campaign_priority',
'm.weight AS campaign_weight',
'm.companion AS campaign_companion',
'm.block AS block_campaign',
'm.capping AS cap_campaign',
'm.session_capping AS session_cap_campaign',
'm.show_capped_no_cookie AS show_capped_no_cookie',
'm.clickwindow AS clickwindow',
'm.viewwindow AS viewwindow',
'cl.clientid AS client_id',
'm.expire_time AS expire_time',
'm.revenue_type AS revenue_type',
'm.ecpm_enabled AS ecpm_enabled',
'm.ecpm AS ecpm',
'cl.advertiser_limitation AS advertiser_limitation',
'a.account_id AS account_id',
'a.agencyid AS agency_id'
);
$var_137 = array(
"".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['banners'])." AS d",
"JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['campaigns'])." AS m ON (d.campaignid = m.campaignid) ",
"JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['clients'])." AS cl ON (m.clientid = cl.clientid) ",
"JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['ad_zone_assoc'])." AS az ON (d.bannerid = az.ad_id)"
);
$var_138 = "
      az.zone_id = 0
      AND m.status <= 0
      AND d.status <= 0";
if ($var_122 != '')
$var_138 .= " $var_122 ";
if ($var_135 != '')
{
$var_139 = '';
$var_140 = true;
$var_141 = explode(',', $var_135);
for ($var_142=0; $var_142 < count($var_141); $var_142++)
{
if (substr($var_141[$var_142], 0, 1) == '+' || substr($var_141[$var_142], 0, 1) == '_')
{
$var_143 = 'AND';
$var_141[$var_142] = substr($var_141[$var_142], 1);
}
elseif (substr($var_141[$var_142], 0, 1) == '-')
{
$var_143 = 'NOT';
$var_141[$var_142] = substr($var_141[$var_142], 1);
}
else
$var_143 = 'OR';
if($var_141[$var_142] != '' && $var_141[$var_142] != ' ')
{
if(var_144('
{
$width = (int)$m[1];
$height = (int)$m[2];
if ($operator == 'OR') {
$conditions .= "OR (d.width = {$width} AND d.height = {$height}) ";
} elseif ($operator == 'AND') {
$conditions .= "AND (d.width = {$width} AND d.height = {$height}) ";
} else {
$conditions .= "AND (d.width <> {$width} OR d.height <> {$height}) ";
}
$onlykeywords = false;
}
elseif (preg_match('
{
$var_145 = (int)$m[1];
$var_146 = !empty($m[2]);
$var_147 = (int)$m[3];
if (!$var_146 && $var_145) {
if ($var_143 == 'OR') {
$var_139 .= "OR d.width = {$var_145} ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.width = {$var_145} ";
} var_149 {
$var_139 .= "AND d.width <> {$var_145} ";
}
} var_149 {
if (!$var_145) {
$var_145 = 1;
}
var_150 (!$var_147)
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.width >= {$var_145} ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.width >= {$var_145} ";
} var_149 {
$var_139 .= "AND d.width < {$var_145} ";
}
} var_149 {
if ($var_143 == 'OR') {
$var_139 .= "OR (d.width >= {$var_145} AND d.width <= {$var_147}) ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND (d.width >= {$var_145} AND d.width <= {$var_147}) ";
} var_149 {
$var_139 .= "AND (d.width < {$var_145} OR d.width > {$var_147}) ";
}
}
}
$var_140 = false;
}
var_148 (var_144('
{
$min = (int)$m[1];
$range = !empty($m[2]);
$max = (int)$m[3];
if (!$range && $min) {
if ($operator == 'OR') {
$conditions .= "OR d.height = {$min} ";
} elseif ($operator == 'AND') {
$conditions .= "AND d.height = {$min} ";
} else {
$conditions .= "AND d.height <> {$min} ";
}
} else {
if (!$min) {
$min = 1;
}
if (!$max)
{
if ($operator == 'OR') {
$conditions .= "OR d.height >= {$min} ";
} elseif ($operator == 'AND') {
$conditions .= "AND d.height >= {$min} ";
} else {
$conditions .= "AND d.height < {$min} ";
}
} else {
if ($operator == 'OR') {
$conditions .= "OR (d.height >= {$min} AND d.height <= {$max}) ";
} elseif ($operator == 'AND') {
$conditions .= "AND (d.height >= {$min} AND d.height <= {$max}) ";
} else {
$conditions .= "AND (d.height < {$min} OR d.height > {$max}) ";
}
}
}
$onlykeywords = false;
}
elseif (preg_match('
{
$var_151 = (int)$m[1];
if ($var_151)
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.bannerid = {$var_151} ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.bannerid = {$var_151} ";
} var_149 {
$var_139 .= "AND d.bannerid <> {$var_151} ";
}
}
$var_140 = false;
}
var_148 (preg_match('
{
$campaignid = (int)$m[1];
if ($campaignid)
{
if ($operator == 'OR') {
$conditions .= "OR d.campaignid = {$campaignid} ";
} elseif ($operator == 'AND') {
$conditions .= "AND d.campaignid = {$campaignid} ";
} else {
$conditions .= "AND d.campaignid <> {$campaignid} ";
}
}
$onlykeywords = false;
}
elseif (substr($part_array[$k], 0, 7) == 'var_152:')
{
$var_152 = OX_escapeString(trim(stripslashes(substr($var_141[$var_142], 7))));
if (!empty($var_152))
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.contenttype = '{$var_152}' ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.contenttype = '{$var_152}' ";
} var_149 {
$var_139 .= "AND d.contenttype <> '{$var_152}' ";
}
}
$var_140 = false;
}
var_148 ($var_141[$var_142] == 'html')
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.storagetype = 'html' ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.storagetype = 'html' ";
} var_149 {
$var_139 .= "AND d.storagetype <> 'html' ";
}
$var_140 = false;
}
var_148 ($var_141[$var_142] == 'textad')
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.storagetype = 'txt' ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.storagetype = 'txt' ";
} var_149 {
$var_139 .= "AND d.storagetype <> 'txt' ";
}
$var_140 = false;
}
var_149
{
$var_139 .= OA_Dal_Delivery_getKeywordCondition($var_143, $var_141[$var_142]);
}
}
}
$var_139 = strstr($var_139, ' ');
if ($var_121 == true && $var_140 == true)
$var_139 .= OA_Dal_Delivery_getKeywordCondition('OR', 'global');
if ($var_139 != '') $var_138 .= ' AND ('.$var_139.') ';
}
$var_153 = implode(",\n    ", $var_136);
$var_154 = implode("\n    ", $var_137);
$var_155 = "
            LEFT JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['clients'])." AS c ON (c.clientid = m.clientid)
            LEFT JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['agency'])." AS a ON (a.agencyid = c.agencyid)
    ";
$var_90 = "SELECT\n    " . $var_153 . "\nFROM\n    " . $var_154 . $var_155 . "\nWHERE " . $var_138;
return $var_90;
}
function OA_Dal_Delivery_buildAdInfoQuery($var_135, $var_121, $var_122)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_136 = array(
'd.bannerid AS ad_id',
'd.campaignid AS placement_id',
'd.status AS status',
'd.storagetype AS type',
'd.contenttype AS contenttype',
'd.weight AS weight',
'd.width AS width',
'd.ext_bannertype AS ext_bannertype',
'd.height AS height',
'd.adserver AS adserver',
'd.block AS block_ad',
'd.capping AS cap_ad',
'd.session_capping AS session_cap_ad',
'd.compiledlimitation AS compiledlimitation',
'd.acl_plugins AS acl_plugins',
'd.alt_filename AS alt_filename',
'az.priority AS priority',
'az.priority_factor AS priority_factor',
'az.to_be_delivered AS to_be_delivered',
'm.campaignid AS campaign_id',
'm.priority AS campaign_priority',
'm.weight AS campaign_weight',
'm.companion AS campaign_companion',
'm.block AS block_campaign',
'm.capping AS cap_campaign',
'm.session_capping AS session_cap_campaign',
'm.show_capped_no_cookie AS show_capped_no_cookie',
'cl.clientid AS client_id',
'm.expire_time AS expire_time',
'm.revenue_type AS revenue_type',
'm.ecpm_enabled AS ecpm_enabled',
'm.ecpm AS ecpm',
'ct.status AS tracker_status',
OX_Dal_Delivery_regex("d.htmlcache", "src\\s?=\\s?[\\'\"]http:")." AS html_ssl_unsafe",
OX_Dal_Delivery_regex("d.imageurl", "^http:")." AS url_ssl_unsafe",
);
$var_137 = array(
"".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['banners'])." AS d",
"JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['ad_zone_assoc'])." AS az ON (d.bannerid = az.ad_id)",
"JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['campaigns'])." AS m ON (m.campaignid = d.campaignid) ",
);
$var_138 = "
      az.zone_id = 0
      AND m.status <= 0
      AND d.status <= 0";
if ($var_122 != '')
$var_138 .= " $var_122 ";
if ($var_135 != '')
{
$var_139 = '';
$var_140 = true;
$var_141 = explode(',', $var_135);
for ($var_142=0; $var_142 < count($var_141); $var_142++)
{
if (substr($var_141[$var_142], 0, 1) == '+' || substr($var_141[$var_142], 0, 1) == '_')
{
$var_143 = 'AND';
$var_141[$var_142] = substr($var_141[$var_142], 1);
}
var_148 (substr($var_141[$var_142], 0, 1) == '-')
{
$var_143 = 'NOT';
$var_141[$var_142] = substr($var_141[$var_142], 1);
}
var_149
$var_143 = 'OR';
if($var_141[$var_142] != '' && $var_141[$var_142] != ' ')
{
var_150(var_144('
{
$width = (int)$m[1];
$height = (int)$m[2];
if ($operator == 'OR') {
$conditions .= "OR (d.width = {$width} AND d.height = {$height}) ";
} elseif ($operator == 'AND') {
$conditions .= "AND (d.width = {$width} AND d.height = {$height}) ";
} else {
$conditions .= "AND (d.width <> {$width} OR d.height <> {$height}) ";
}
$onlykeywords = false;
}
elseif (preg_match('
{
$var_145 = (int)$m[1];
$var_146 = !empty($m[2]);
$var_147 = (int)$m[3];
if (!$var_146 && $var_145) {
if ($var_143 == 'OR') {
$var_139 .= "OR d.width = {$var_145} ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.width = {$var_145} ";
} var_149 {
$var_139 .= "AND d.width <> {$var_145} ";
}
} var_149 {
if (!$var_145) {
$var_145 = 1;
}
var_150 (!$var_147)
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.width >= {$var_145} ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.width >= {$var_145} ";
} var_149 {
$var_139 .= "AND d.width < {$var_145} ";
}
} var_149 {
if ($var_143 == 'OR') {
$var_139 .= "OR (d.width >= {$var_145} AND d.width <= {$var_147}) ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND (d.width >= {$var_145} AND d.width <= {$var_147}) ";
} var_149 {
$var_139 .= "AND (d.width < {$var_145} OR d.width > {$var_147}) ";
}
}
}
$var_140 = false;
}
var_148 (var_144('
{
$min = (int)$m[1];
$range = !empty($m[2]);
$max = (int)$m[3];
if (!$range && $min) {
if ($operator == 'OR') {
$conditions .= "OR d.height = {$min} ";
} elseif ($operator == 'AND') {
$conditions .= "AND d.height = {$min} ";
} else {
$conditions .= "AND d.height <> {$min} ";
}
} else {
if (!$min) {
$min = 1;
}
if (!$max)
{
if ($operator == 'OR') {
$conditions .= "OR d.height >= {$min} ";
} elseif ($operator == 'AND') {
$conditions .= "AND d.height >= {$min} ";
} else {
$conditions .= "AND d.height < {$min} ";
}
} else {
if ($operator == 'OR') {
$conditions .= "OR (d.height >= {$min} AND d.height <= {$max}) ";
} elseif ($operator == 'AND') {
$conditions .= "AND (d.height >= {$min} AND d.height <= {$max}) ";
} else {
$conditions .= "AND (d.height < {$min} OR d.height > {$max}) ";
}
}
}
$onlykeywords = false;
}
elseif (preg_match('
{
$var_151 = (int)$m[1];
if ($var_151)
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.bannerid = {$var_151} ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.bannerid = {$var_151} ";
} var_149 {
$var_139 .= "AND d.bannerid <> {$var_151} ";
}
}
$var_140 = false;
}
var_148 (preg_match('
{
$campaignid = (int)$m[1];
if ($campaignid)
{
if ($operator == 'OR') {
$conditions .= "OR d.campaignid = {$campaignid} ";
} elseif ($operator == 'AND') {
$conditions .= "AND d.campaignid = {$campaignid} ";
} else {
$conditions .= "AND d.campaignid <> {$campaignid} ";
}
}
$onlykeywords = false;
}
elseif (substr($part_array[$k], 0, 7) == 'var_152:')
{
$var_152 = OX_escapeString(trim(stripslashes(substr($var_141[$var_142], 7))));
if (!empty($var_152))
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.contenttype = '{$var_152}' ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.contenttype = '{$var_152}' ";
} var_149 {
$var_139 .= "AND d.contenttype <> '{$var_152}' ";
}
}
$var_140 = false;
}
var_148 ($var_141[$var_142] == 'html')
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.storagetype = 'html' ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.storagetype = 'html' ";
} var_149 {
$var_139 .= "AND d.storagetype <> 'html' ";
}
$var_140 = false;
}
var_148 ($var_141[$var_142] == 'textad')
{
if ($var_143 == 'OR') {
$var_139 .= "OR d.storagetype = 'txt' ";
} var_148 ($var_143 == 'AND') {
$var_139 .= "AND d.storagetype = 'txt' ";
} var_149 {
$var_139 .= "AND d.storagetype <> 'txt' ";
}
$var_140 = false;
}
var_149
{
$var_139 .= OA_Dal_Delivery_getKeywordCondition($var_143, $var_141[$var_142]);
}
}
}
$var_139 = strstr($var_139, ' ');
if ($var_121 == true && $var_140 == true)
$var_139 .= OA_Dal_Delivery_getKeywordCondition('OR', 'global');
if ($var_139 != '') $var_138 .= ' AND ('.$var_139.') ';
}
$var_153 = implode(",\n    ", $var_136);
$var_154 = implode("\n    ", $var_137);
$var_155 = "
            LEFT JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['campaigns_trackers'])." AS ct ON (ct.campaignid = m.campaignid)
            LEFT JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['clients'])." AS cl ON (cl.clientid = m.clientid)
            LEFT JOIN ".OX_escapeIdentifier($var_4['table']['prefix'].$var_4['table']['agency'])." AS a ON (a.agencyid = cl.agencyid)
    ";
$var_90 = "SELECT\n    " . $var_153 . "\nFROM\n    " . $var_154 . $var_155 . "\nWHERE " . $var_138;
return $var_90;
}
function _setPriorityFromWeights(&$var_156)
{
if (!count($var_156)) {
var_157 0;
}
$var_158 = array();
$var_159 = array();
foreach ($var_156 as $var_74) {
if (!isset($var_158[$var_74['placement_id']])) {
$var_158[$var_74['placement_id']] = $var_74['campaign_weight'];
$var_159[$var_74['placement_id']] = 0;
}
$var_159[$var_74['placement_id']] += $var_74['weight'];
}
foreach ($var_158 as $var_142 => $var_74) {
if ($var_159[$var_142]) {
$var_158[$var_142] /= $var_159[$var_142];
}
}
$var_160 = 0;
foreach ($var_156 as $var_142 => $var_74) {
$var_156[$var_142]['priority'] = $var_158[$var_74['placement_id']] * $var_74['weight'];
$var_160 += $var_156[$var_142]['priority'];
}
if ($var_160) {
foreach ($var_156 as $var_142 => $var_74) {
$var_156[$var_142]['priority'] /= $var_160;
}
var_157 1;
}
var_157 0;
}
var_161 var_162($var_163, $var_164 = true)
{
$var_115 = array();
$var_165 = array();
$var_166 = 1;
foreach ($var_163 as $var_167 => $var_156) {
$var_165[$var_167] = 0;
foreach ($var_156 as $var_13 => $var_118) {
$var_166 -= (double)$var_118['priority'];
if ($var_118['to_be_delivered']) {
$var_168 = $var_118['priority'] * $var_118['priority_factor'];
} var_149 {
$var_168 = 1e-05;
}
$var_165[$var_167] += $var_168;
}
}
$var_169 = 0;
if ($var_164) {
$var_169 = $var_166 <= 1e-15 ? 0 : $var_166;
}
ksort($var_165);
foreach($var_165 as $var_167 => $var_168) {
$var_169 += $var_168;
if ($var_169) {
$var_115[$var_167] = $var_168 / $var_169;
} var_149 {
$var_115[$var_167] = 0;
}
}
var_157 $var_115;
}

var_161 var_170()
{
static $var_171;
if (isset($var_171)) {
var_157;
}
$var_171 = true;
$var_4 = $var_455['_MAX']['CONF'];
}


var_161 var_172($var_130, $var_173, $var_174 = null)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_175 = '';
$var_50 = MAX_commonGetDeliveryUrl($var_4['file']['conversionvars']);
$var_176 = MAX_cacheGetTracker($var_130);
$var_177 = MAX_cacheGetTrackerVariables($var_130);
$var_178 = '';
if (empty($var_174)) {
$var_174 = md5(uniqid('', true));
} var_149 {
$var_176['variablemethod'] = 'default';
}
if (!empty($var_177)) {
if ($var_176['variablemethod'] == 'dom') {
$var_175 .= "
    function MAX_extractTextDom(o)
    {
        var txt = '';

        if (o.nodeType == 3) {
            txt = o.data;
        } else {
            for (var i = 0; i < o.childNodes.length; i++) {
                txt += MAX_extractTextDom(o.childNodes[i]);
            }
        }

        return txt;
    }

    function MAX_TrackVarDom(id, v)
    {
        if (max_trv[id][v]) { return; }
        var o = document.getElementById(v);
        if (o) {
            max_trv[id][v] = escape(o.tagName == 'INPUT' ? o.value : MAX_extractTextDom(o));
        }
    }";
$var_179 = 'MAX_TrackVarDom';
} var_148 ($var_176['variablemethod'] == 'default') {
$var_175 .= "
    function MAX_TrackVarDefault(id, v)
    {
        if (max_trv[id][v]) { return; }
        if (typeof(window[v]) == undefined) { return; }
        max_trv[id][v] = window[v];
    }";
$var_179 = 'MAX_TrackVarDefault';
} var_149 {
$var_175 .= "
    function MAX_TrackVarJs(id, v, c)
    {
        if (max_trv[id][v]) { return; }
        if (typeof(window[v]) == undefined) { return; }
        if (typeof(c) != 'undefined') {
            eval(c);
        }
        max_trv[id][v] = window[v];
    }";
$var_179 = 'MAX_TrackVarJs';
}
$var_175 .= "
    if (!max_trv) { var max_trv = new Array(); }
    if (!max_trv['{$var_174}']) { max_trv['{$var_174}'] = new Array(); }";
foreach($var_177 as $var_13 => $variable) {
$var_178 .= "&{$variable['name']}=\"+max_trv['{$var_174}']['{$variable['name']}']+\"";
if ($var_176['variablemethod'] == 'custom') {
$var_175 .= "
    {$var_179}('{$var_174}', '{$variable['name']}', '".addcslashes($variable['variablecode'], "'")."');";
} var_149 {
$var_175 .= "
    {$var_179}('{$var_174}', '{$variable['name']}');";
}
}
var_150 (!empty($var_178)) {
foreach ($var_173 as $var_180 => $var_181) {
$var_182 = array();
if (is_array($var_181)) {
foreach ($var_181 as $var_13 => $var_14) {
$var_182[] = $var_13 . '=' . urlencode($var_14);
}
}
$var_182 = '&' . implode('&', $var_182);
$var_175 .= "
    document.write (\"<\" + \"script language='JavaScript' type='text/javascript' src='\");
    document.write (\"$var_50?trackerid=$var_130&plugin={$var_180}{$var_182}{$var_178}'\");";
$var_175 .= "\n\tdocument.write (\"><\\/scr\"+\"ipt>\");";
}
}
}
var_150(!empty($var_176['appendcode'])) {
$var_176['appendcode'] = preg_replace('/("\?trackerid=\d+&amp;inherit)=1/', '$1='.$var_174, $var_176['appendcode']);
$var_183 = MAX_javascriptToHTML($var_176['appendcode'], "MAX_{$var_130}_appendcode");
$var_183 = preg_replace("/\{m3_trackervariable:(.+?)\}/", "\"+max_trv['{$var_174}']['$1']+\"", $var_183);
$var_175 .= "\n".preg_replace('/^/m', "\t", $var_183)."\n";
}
var_150 (empty($var_175)) {
$var_175 = "document.write(\"\");";
}
var_157 $var_175;
}
function var_184($var_130)
{
$var_185 = MAX_cacheGetTrackerLinkedCreatives($var_130);
if (empty($var_185)) {
var_157 false;
}
$var_186 = _getActionTypes();
$var_187 = MAX_commonGetTimeNow();
$var_49 = $var_455['_MAX']['CONF'];
$var_188 = array();
foreach ($var_185 as $var_189 => $var_190) {
foreach ($var_186 as $var_191 => $var_192) {
if (!empty($var_190[$var_192 . '_window']) && !empty($_COOKIE[$var_49['var']['last' . ucfirst($var_192)]][$var_189])) {
if (stristr($_COOKIE[$var_49['var']['last' . ucfirst($var_192)]][$var_189], ' ')) {
list($var_14, $var_193) = explode(' ', $_COOKIE[$var_49['var']['last' . ucfirst($var_192)]][$var_189], 2);
$_COOKIE[$var_49['var']['last' . ucfirst($var_192)]][$var_189] = $var_14;
} var_149 {
$var_193 = '';
}
var_194($var_195, $var_196) = explode('-', $_COOKIE[$var_49['var']['last' . ucfirst($var_192)]][$var_189]);
$var_195 = MAX_commonUnCompressInt($var_195);
$var_197 = $var_187 - $var_195;
if ($var_197 <= $var_190[$var_192 . '_window'] && $var_197 > 0) {
$var_188[$var_197] = array(
'action_type' => $var_191,
'tracker_type' => $var_190['tracker_type'],
'status' => $var_190['status'],
'cid' => $var_189,
'zid' => $var_196,
'dt' => $var_195,
'window' => $var_190[$var_192 . '_window'],
'extra' => $var_193,
);
}
}
}
}
var_150 (empty($var_188)) {
var_157 false;
}
var_198($var_188);
return array_shift($var_188);
}
var_161 var_199()
{
var_157 array(0 => 'view', 1 => 'click');
}
var_161 var_200()
{
var_157 array(1 => 'sale', 2 => 'lead', 3 => 'signup');
}

var_161 var_201($var_58, $var_196, $var_118 = array())
{
if (empty($var_455['_MAX']['CONF']['logging']['adRequests'])) { var_157 true; }
var_202('logRequest', array($var_58, $var_196, $var_118, _viewersHostOkayToLog($var_58, $var_196)));
}
var_161 var_203($var_58, $var_196)
{
if (empty($var_455['_MAX']['CONF']['logging']['adImpressions'])) { var_157 true; }
var_150 (MAX_commonIsAdActionBlockedBecauseInactive($var_58)) {
var_157 true;
}
var_202('logImpression', array($var_58, $var_196, _viewersHostOkayToLog($var_58, $var_196)));
}
var_161 var_204($var_58, $var_196)
{
if (empty($var_455['_MAX']['CONF']['logging']['adClicks'])) { var_157 true; }
var_202('logClick', array($var_58, $var_196, _viewersHostOkayToLog($var_58, $var_196)));
}
var_161 var_205($var_206, $var_207)
{
if (empty($var_455['_MAX']['CONF']['logging']['trackerImpressions'])) { var_157 true; }
$var_49 = $var_455['_MAX']['CONF'];
if (!empty($var_49['lb']['enabled'])) {
$var_49['rawDatabase']['host'] = $_SERVER['SERVER_ADDR'];
} var_149 {
$var_49['rawDatabase']['host'] = 'singleDB';
}
if (isset($var_49['rawDatabase']['serverRawIp'])) {
$var_208 = $var_49['rawDatabase']['serverRawIp'];
} var_149 {
$var_208 = $var_49['rawDatabase']['host'];
}
$var_209 = OX_Delivery_Common_hook('logConversion', array($var_206, $var_208, $var_207, _viewersHostOkayToLog(null, null, $var_206)));
if (is_array($var_209)) {
var_157 $var_209;
}
var_157 false;
}
var_161 var_210($var_211, $var_206, $var_212, $var_208, $var_213 = null)
{
$var_49 = $var_455['_MAX']['CONF'];
foreach ($var_211 as $var_214) {
if (isset($_GET[$var_214['name']])) {
$var_14 = $_GET[$var_214['name']];
if (!strlen($var_14) || $var_14 == 'undefined') {
unset($var_211[$var_214['variable_id']]);
continue;
}
switch ($var_214['type']) {
var_562 'int':
case 'numeric':
$var_14 = preg_replace('/[^0-9.]/', '', $var_14);
$var_14 = floatval($var_14);
break;
case 'date':
if (!empty($var_14)) {
$var_14 = date('Y-m-d H:i:s', strtotime($var_14));
} var_149 {
$var_14 = '';
}
var_563;
}
} var_149 {
unset($var_211[$var_214['variable_id']]);
continue;
}
$var_211[$var_214['variable_id']]['value'] = $var_14;
}
var_150 (count($var_211)) {
OX_Delivery_Common_hook(
'logConversionVariable',
array($var_211, $var_206, $var_212, $var_208, _viewersHostOkayToLog(null, null, $var_206)),
empty($var_213) ? null : $var_213.'Variable'
);
}
}
var_161 var_215($var_58=0, $var_196=0, $var_206=0)
{
$var_49 = $var_455['_MAX']['CONF'];
$var_216 = strtolower($_SERVER['HTTP_USER_AGENT']);
$var_217 = true;
if (!empty($var_49['logging']['enforceUserAgents'])) {
$var_218 = explode('|', strtolower($var_49['logging']['enforceUserAgents']));
$var_219 = false;
foreach ($var_218 as $var_220) {
if (strpos($var_216, $var_220) !== false) {
$var_219 = true;
break;
}
}
OX_Delivery_logMessage('user-agent browser : '.$var_216.' is '.($var_219 ? '' : 'not ').'allowed', 7);
if (!$var_219) {
$var_455['_MAX']['EVENT_FILTER_FLAGS'][] = 'enforceUserAgents';
$var_217 = false;
}
}
var_150 (!empty($var_49['logging']['ignoreUserAgents'])) {
$var_221 = explode('|', strtolower($var_49['logging']['ignoreUserAgents']));
foreach ($var_221 as $var_222) {
if (strpos($var_216, $var_222) !== false) {
OX_Delivery_logMessage('user-agent '.$var_216.' is a known bot '.$var_222, 7);
$var_455['_MAX']['EVENT_FILTER_FLAGS'][] = 'ignoreUserAgents';
$var_217 = false;
}
}
}
var_150 (!empty($var_49['logging']['ignoreHosts'])) {
$var_223 = str_replace(',', '|', $var_49['logging']['ignoreHosts']);
$var_223 = '
$hosts = str_replace('.', '\.', $hosts);
$hosts = str_replace('*', '[^.]+', $hosts);
if (preg_match($hosts, $_SERVER['REMOTE_ADDR'])) {
OX_Delivery_logMessage('viewer\'s ip is in the ignore list '.$_SERVER['REMOTE_ADDR'], 7);
$var_455['_MAX']['EVENT_FILTER_FLAGS'][] = 'ignoreHosts_ip';
$var_217 = false;
}
var_150 (preg_match($var_223, $_SERVER['REMOTE_HOST'])) {
OX_Delivery_logMessage('viewer\'s host is in the ignore list '.$_SERVER['REMOTE_HOST'], 7);
$var_455['_MAX']['EVENT_FILTER_FLAGS'][] = 'ignoreHosts_host';
$var_217 = false;
}
}
var_150 ($var_217) var_224('viewer\'s host is OK to log', 7);
$var_88 = var_225('var_226', array($var_58, $var_196, $var_206));
if (!var_227($var_88) && is_array($var_88)) {
foreach ($var_88 as $var_228 => $var_14) {
if ($var_14 == true) {
$var_455['_MAX']['EVENT_FILTER_FLAGS'][] = $var_228;
$var_217 = false;
}
}
}
var_157 $var_217;
}
function var_229(var_230 $var_42)
{
$var_231 = $var_455['_MAX']['CONF']['var'][$var_42];
return isset($_GET[$var_231]) ? explode($var_455['_MAX']['MAX_DELIVERY_MULTIPLE_DELIMITER'], $_GET[$var_231]) : array();
}
var_161 var_232(&$var_233, $var_234)
{
if (!is_array($var_233)) {
$var_233 = array();
}
var_150 (empty($var_233[$var_234])) {
$var_233[$var_234] = 0;
} var_149 {
if (!is_integer($var_233[$var_234])) {
$var_233[$var_234] = intval($var_233[$var_234]);
}
}
}
var_161 var_235($var_234, $var_156, $var_236)
{
_setLimitations('Ad', $var_234, $var_156, $var_236);
}
var_161 var_237($var_234, $var_238, $var_236)
{
_setLimitations('Campaign', $var_234, $var_238, $var_236);
}
var_161 var_239($var_234, $var_113, $var_236)
{
_setLimitations('Zone', $var_234, $var_113, $var_236);
}
var_161 var_240($var_234, $var_241, $var_242, $var_243, $var_192 = 'view')
{
$var_49 = $var_455['_MAX']['CONF'];
if (!empty($var_243[$var_234])) {
$var_244 = MAX_commonCompressInt(MAX_commonGetTimeNow()) . "-" . $var_242[$var_234];
$var_245 = OX_Delivery_Common_hook('addConversionParams', array(&$var_234, &$var_241, &$var_242, &$var_243, &$var_192, &$var_244));
if (!empty($var_245) && is_array($var_245)) {
foreach ($var_245 as $var_246) {
if (!empty($var_246) && is_array($var_246)) {
foreach ($var_246 as $var_13 => $var_14) {
$var_244 .= " {$var_14}";
}
}
}
}
fn_20("_{$var_49['var']['last' . ucfirst($var_192)]}[{$var_241[$var_234]}]", $var_244, fn_22());
}
}
var_161 var_247($var_234, $var_241)
{
$var_49 = $var_455['_MAX']['CONF'];
fn_20("_{$var_49['var']['blockLoggingClick']}[{$var_241[$var_234]}]", MAX_commonCompressInt(MAX_commonGetTimeNow()), fn_22());
}
var_161 var_248($var_58, $var_249)
{
if (isset($var_455['conf']['logging']['blockAdClicksWindow']) && $var_455['conf']['logging']['blockAdClicksWindow'] != 0) {
if (isset($var_249[$var_58])) {
$var_250 = MAX_commonUnCompressInt($var_249[$var_58]) + $var_455['conf']['logging']['blockAdClicksWindow'];
if ($var_250 >= MAX_commonGetTimeNow()) {
OX_Delivery_logMessage('adID '.$var_58.' click is still blocked by block logging window ', 7);
return true;
}
}
}
var_157 false;
}
var_161 var_251($var_20, $var_234, $var_252, $var_236)
{
MAX_Delivery_log_ensureIntegerSet($var_236['block'], $var_234);
MAX_Delivery_log_ensureIntegerSet($var_236['capping'], $var_234);
MAX_Delivery_log_ensureIntegerSet($var_236['session_capping'], $var_234);
fn_30(
$var_20,
$var_252[$var_234],
$var_236['block'][$var_234],
$var_236['capping'][$var_234],
$var_236['session_capping'][$var_234]
);
}

var_161 var_253($var_41 = null)
{
$var_4 = $var_455['_MAX']['CONF'];
if ($var_455['_MAX']['SSL_REQUEST']) {
$var_50 = MAX_commonConstructSecureDeliveryUrl($var_41);
} var_149 {
$var_50 = MAX_commonConstructDeliveryUrl($var_41);
}
var_157 $var_50;
}
var_161 var_254($var_41)
{
$var_4 = $var_455['_MAX']['CONF'];
return 'http:
}
function MAX_commonConstructSecureDeliveryUrl($file)
{
$conf = $GLOBALS['var_299']['CONF'];
if ($var_4['openads']['sslPort'] != 443) {
$var_44 = preg_replace('
} else {
$path = $conf['webpath']['deliverySSL'];
}
return 'https:
}
function MAX_commonConstructPartialDeliveryUrl($file, $ssl = false)
{
$conf = $GLOBALS['var_299']['CONF'];
if ($var_255) {
var_157 '
} else {
return '
}
}
function MAX_commonRemoveSpecialChars(&$var_256)
{
if (isset($var_256)) {
if (!is_array($var_256)) {
$var_256 = strip_tags($var_256);
$var_256 = str_replace(array("\n", "\r"), array('', ''), $var_256);
$var_256 = trim($var_256);
} var_149 {
array_walk($var_256, 'MAX_commonRemoveSpecialChars');
}
}
}
var_161 var_257($var_258, $var_259, $var_260 = 'UTF-8', $var_261 = null) {
if (($var_259 == $var_260) || empty($var_259)) {
var_157 $var_258;
}
var_150 (!isset($var_261) || !is_array($var_261)) {
$var_261 = array('iconv', 'mbstring', 'xml');
}
var_150 (is_array($var_258)) {
foreach ($var_258 as $var_13 => $var_14) {
$var_258[$var_13] = MAX_commonConvertEncoding($var_14, $var_259, $var_260, $var_261);
}
var_157 $var_258;
} var_149 {
$var_259 = strtoupper($var_259);
$var_260 = strtoupper($var_260);
$var_262 = array();
$var_262['mbstring']['WINDOWS-1255'] = 'ISO-8859-8';  $var_262['xml']['ISO-8859-15'] = 'ISO-8859-1';   $var_263 = false;
foreach ($var_261 as $var_264) {
$var_265 = isset($var_262[$var_264][$var_260]) ? $var_262[$var_264][$var_260] : $var_260;
$var_266 = isset($var_262[$var_264][$var_259]) ? $var_262[$var_264][$var_259] : $var_259;
switch ($var_264) {
var_562 'iconv':
if (function_exists('iconv')) {
$var_263 = @iconv($var_265, $var_266, $var_258);
}
var_563;
case 'mbstring':
if (function_exists('mb_convert_encoding')) {
$var_263 = @mb_convert_encoding($var_258, $var_266, $var_265);
}
var_563;
case 'xml':
if (function_exists('utf8_encode')) {
if ($var_266 == 'UTF-8' && $var_265 == 'ISO-8859-1') {
$var_263 = utf8_encode($var_258);
} var_148 ($var_266 == 'ISO-8859-1' && $var_265 == 'UTF-8') {
$var_263 = utf8_decode($var_258);
}
}
var_563;
}
}
var_157 $var_263 ? $var_263 : $var_258;
}
}
var_161 var_267($var_20 = 'text/html', $var_268 = null)
{
$var_83 = 'Content-type: ' . $var_20;
if (!empty($var_268) && preg_match('/^[a-zA-Z0-9_-]+$/D', $var_268)) {
$var_83 .= '; charset=' . $var_268;
}
MAX_header($var_83);
}
var_161 var_269()
{
MAX_header('Pragma: no-cache');
MAX_header('Cache-Control: no-cache, no-store, must-revalidate');
MAX_header('Expires: 0');
MAX_header('Access-Control-Allow-Origin: *');
}
var_161 var_270($var_271)
{
if (is_array($var_271)) {
reset($var_271);
while (list($var_142,$var_74) = each($var_271)) {
$var_271[$var_142] = MAX_commonAddslashesRecursive($var_74);
}
reset ($var_271);
return ($var_271);
} var_149 {
var_157 is_null($var_271) ? null : addslashes($var_271);
}
}
var_161 var_272($var_273 = array())
{
static $var_274;
if (!isset($var_274)) {
$var_274 = ini_get('magic_quotes_gpc');
}
$var_275 = false;
foreach($var_273 as $var_13) {
if (isset($_GET[$var_13])) {
$var_14 = $_GET[$var_13];
$var_275 = true;
}
var_150 (isset($_POST[$var_13])) {
$var_14 = $_POST[$var_13];
$var_275 = true;
}
var_150 ($var_275) {
if (!$var_274) {
if (!is_array($var_14)) {
$var_14 = addslashes($var_14);
} var_149 {
$var_14 = MAX_commonAddslashesRecursive($var_14);
}
}
$var_455[$var_13] = $var_14;
$var_275 = false;
}
}
}
var_161 var_276($var_277)
{
var_157 MAX_commonEncrypt(trim(urldecode($var_277)));
}
var_161 var_278($var_230)
{
$var_279 = '';
if (isset($var_230) && substr($var_230,1,4) != 'obfs' && $var_455['_MAX']['CONF']['delivery']['obfuscate']) {
$var_280 = strlen($var_230);
for ($var_281=0; $var_281 < $var_280; $var_281++) {
$var_282 = ord(substr($var_230,$var_281,1));
if (strlen($var_282) == 2) {
$var_282 = 0 . $var_282;
}
$var_282 = 324 - $var_282;
$var_279 .= $var_282;
}
$var_279 = '{obfs:' . $var_279 . '}';
return ($var_279);
} var_149 {
var_157 $var_230;
}
}
var_161 var_283($var_230)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_279 = '';
if (isset($var_230) && substr($var_230,1,4) == 'obfs' && $var_4['delivery']['obfuscate']) {
$var_280 = strlen($var_230);
for ($var_281=6; $var_281 < $var_280-1; $var_281 = $var_281+3) {
$var_282 = substr($var_230,$var_281,3);
$var_282 = 324 - $var_282;
$var_282 = chr($var_282);
$var_279 .= $var_282;
}
return ($var_279);
} var_149 {
return($var_230);
}
}
var_161 var_284()
{
MAX_commonRegisterGlobalsArray(array('context', 'source', 'target', 'withText', 'withtext', 'ct0', 'what', 'loc', 'referer', 'zoneid', 'campaignid', 'bannerid', 'clientid', 'charset'));
global $var_288, $var_277, $var_289, $var_285, $var_286, $var_287, $var_291, $var_293, $var_294, $var_96, $var_120, $var_151, $var_290, $var_268;
if (isset($var_285) && !isset($var_286)) $var_286 = $var_285;
$var_286 = (isset($var_286) && is_numeric($var_286) ? $var_286 : 0 );
$var_287 = (isset($var_287) ? $var_287 : '' );
$var_288 = (isset($var_288) ? $var_288 : array() );
$var_289 = (isset($var_289) && (!empty($var_289)) && (!strpos($var_289 , chr(32))) ? $var_289 : '' );
$var_268 = (isset($var_268) && (!empty($var_268)) && (!strpos($var_268, chr(32))) ? $var_268 : 'UTF-8' );
$var_151 = (isset($var_151) && is_numeric($var_151) ? $var_151 : '' );
$var_120 = (isset($var_120) && is_numeric($var_120) ? $var_120 : '' );
$var_290 = (isset($var_290) && is_numeric($var_290) ? $var_290 : '' );
$var_96 = (isset($var_96) && is_numeric($var_96) ? $var_96 : '' );
if (!isset($var_291))
{
if (!empty($var_151)) {
$var_291 = 'bannerid:'.$var_151;
} var_148 (!empty($var_120)) {
$var_291 = 'campaignid:'.$var_120;
} var_148 (!empty($var_96)) {
$var_291 = 'zone:'.$var_96;
} var_149 {
$var_291 = '';
}
}
var_148 (preg_match('/^([a-z]+):(\d+)$/', $var_291, $var_292))
{
switch ($var_292[1])
{
var_562 'zoneid':
case 'zone':
$var_96 = $var_292[2];
break;
case 'bannerid':
$var_151 = $var_292[2];
break;
case 'campaignid':
$var_120 = $var_292[2];
break;
case 'clientid':
$var_290 = $var_292[2];
break;
}
}
var_150 (!isset($var_290)) $var_290 = '';
if (var_227($var_120)) $var_120 = $var_290;
$var_277 = var_276($var_277);
if (!empty($var_293)) {
$var_293 = stripslashes($var_293);
} elseif (!empty($_SERVER['HTTP_REFERER'])) {
$var_293 = $_SERVER['HTTP_REFERER'];
} var_149 {
$var_293 = '';
}
if (!empty($var_294)) {
$_SERVER['HTTP_REFERER'] = stripslashes($var_294);
} var_149 {
if (isset($_SERVER['HTTP_REFERER'])) var_295($_SERVER['HTTP_REFERER']);
}
$var_455['_MAX']['COOKIE']['LIMITATIONS']['arrCappingCookieNames'] = array(
$var_455['_MAX']['CONF']['var']['blockAd'],
$var_455['_MAX']['CONF']['var']['capAd'],
$var_455['_MAX']['CONF']['var']['sessionCapAd'],
$var_455['_MAX']['CONF']['var']['blockCampaign'],
$var_455['_MAX']['CONF']['var']['capCampaign'],
$var_455['_MAX']['CONF']['var']['sessionCapCampaign'],
$var_455['_MAX']['CONF']['var']['blockZone'],
$var_455['_MAX']['CONF']['var']['capZone'],
$var_455['_MAX']['CONF']['var']['sessionCapZone'],
$var_455['_MAX']['CONF']['var']['lastClick'],
$var_455['_MAX']['CONF']['var']['lastView'],
$var_455['_MAX']['CONF']['var']['blockLoggingClick'],
);
if (strtolower($var_268) == 'unicode') { $var_268 = 'utf-8'; }
}
var_161 var_296($var_58)
{
if (!empty($var_455['_MAX']['CONF']['logging']['blockInactiveBanners'])) {
$var_297 = MAX_cacheGetAd($var_58);
return $var_297['status'] || $var_297['campaign_status'];
}
var_157 false;
}
var_161 var_298()
{
MAX_header('Content-Type: image/gif');
";
}
function MAX_commonGetTimeNow()
{
if (!isset($var_455['var_299']['NOW'])) {
$var_455['var_299']['NOW'] = time();
}
return $var_455['var_299']['NOW'];
}
function MAX_getRandomNumber($var_300 = 10)
{
return substr(md5(uniqid(time(), true)), 0, $var_300);
}
function MAX_header($var_14)
{
 header($var_14);
}
function MAX_redirect($var_50)
{
if (!preg_match('/^(?:javascript|data):/i', $var_50)) {
$var_6 = @parse_url($var_50, PHP_URL_HOST);
if (function_exists('idn_to_ascii')) {
$var_301 = idn_to_ascii($var_6);
if ($var_6 != $var_301) {
$var_50 = preg_replace('
}
}
header('Location: '.$var_50);
MAX_sendStatusCode(302);
}
}
function MAX_sendStatusCode($var_302) {
$var_49 = $var_455['var_299']['CONF'];
$var_303 = array(
100 => 'Continue',
101 => 'Switching Protocols',
200 => 'OK',
201 => 'Created',
202 => 'Accepted',
203 => 'Non-Authoritative Information',
204 => 'No Content',
205 => 'Reset Content',
206 => 'Partial Content',
300 => 'Multiple Choices',
301 => 'Moved Permanently',
302 => 'Found',
303 => 'See Other',
304 => 'Not Modified',
305 => 'Use Proxy',
306 => '[Unused]',
307 => 'Temporary Redirect',
400 => 'Bad Request',
401 => 'Unauthorized',
402 => 'Payment Required',
403 => 'Forbidden',
404 => 'Not Found',
405 => 'Method Not Allowed',
406 => 'Not Acceptable',
407 => 'Proxy Authentication Required',
408 => 'Request Timeout',
409 => 'Conflict',
410 => 'Gone',
411 => 'Length Required',
412 => 'Precondition Failed',
413 => 'Request Entity Too Large',
414 => 'Request-URI Too Long',
415 => 'Unsupported Media Type',
416 => 'Requested Range Not Satisfiable',
417 => 'Expectation Failed',
500 => 'Internal Server Error',
501 => 'Not Implemented',
502 => 'Bad Gateway',
503 => 'Service Unavailable',
504 => 'Gateway Timeout',
505 => 'HTTP Version Not Supported'
);
if (isset($var_303[$var_302])) {
$var_304 = $var_302 . ' ' . $var_303[$var_302];
if (!empty($var_49['var_305']['cgiForceStatusHeader']) && strpos(php_sapi_name(), 'cgi') !== 0) {
MAX_header('Status: ' . $var_304);
} else {
MAX_header($_SERVER["var_306"] .' ' . $var_304);
}
}
}
function MAX_commonPackContext($var_288 = array())
{
$var_307 = array();
$var_308 = array();
foreach ($var_288 as $var_309 => $var_14) {
reset($var_14);
list($var_13, $var_14) = each($var_14);
list($var_310,$var_64) = explode(':', $var_14);
switch ($var_310) {
case 'campaignid': $var_14 = 'c:' . $var_64; break;
case 'clientid': $var_14 = 'a:' . $var_64; break;
case 'bannerid': $var_14 = 'b:' . $var_64; break;
case 'companionid': $var_14 = 'p:' . $var_64; break;
}
switch ($var_13) {
case '!=': $var_308[$var_14] = true; break;
case '==': $var_307[$var_14] = true; break;
}
}
$var_308 = array_keys($var_308);
$var_307 = array_keys($var_307);
return base64_encode(implode('
}
function MAX_commonUnpackContext($var_288 = '')
{
list($var_308,$var_307) = explode('|', base64_decode($var_288));
return array_merge(_convertContextArray('!=', explode('
}
function MAX_commonCompressInt($var_311)
{
return base_convert($var_311, 10, 36);
}
function MAX_commonUnCompressInt($var_230)
{
return base_convert($var_230, 36, 10);
}
function _convertContextArray($var_13, $var_312)
{
$var_313 = array();
foreach ($var_312 as $var_14) {
if (empty($var_14)) { continue; }
list($var_310, $var_64) = explode(':', $var_14);
switch ($var_310) {
case 'c': $var_313[] = array($var_13 => 'campaignid:' . $var_64); break;
case 'a': $var_313[] = array($var_13 => 'clientid:' . $var_64); break;
case 'b': $var_313[] = array($var_13 => 'bannerid:' . $var_64); break;
case 'p': $var_313[] = array($var_13 => 'companionid:'.$var_64); break;
}
}
return $var_313;
}
function OX_Delivery_Common_hook($var_314, $var_315 = array(), $var_316 = '')
{
$var_157 = null;
if (!empty($var_316)) {
$var_317 = explode(':', $var_316);
if (count($var_317) === 3) {
$var_316 = OX_Delivery_Common_getFunctionFromComponentIdentifier($var_316, $var_314);
}
if (function_exists($var_316)) {
$var_157 = call_user_func_array($var_316, $var_315);
}
} else {
if (!empty($var_455['var_299']['CONF']['deliveryHooks'][$var_314])) {
$var_157 = array();
$var_318 = explode('|', $var_455['var_299']['CONF']['deliveryHooks'][$var_314]);
foreach ($var_318 as $var_319) {
$var_316 = OX_Delivery_Common_getFunctionFromComponentIdentifier($var_319, $var_314);
if (function_exists($var_316)) {
OX_Delivery_logMessage('calling on '.$var_316, 7);
$var_157[$var_319] = call_user_func_array($var_316, $var_315);
}
}
}
}
return $var_157;
}
function OX_Delivery_Common_getFunctionFromComponentIdentifier($var_319, $var_320 = null)
{
if (preg_match('/[^a-zA-Z0-9:]/', $var_319)) {
if (PHP_SAPI === 'cli') {
exit(1);
} else {
MAX_sendStatusCode(400);
exit;
}
}
$var_321 = explode(':', $var_319);
$var_316 = 'Plugin_' . implode('_', $var_321) . '_Delivery' . (!empty($var_320) ? '_' . $var_320 : '');
if (!function_exists($var_316)) {
if (!empty($var_455['var_299']['CONF']['pluginSettings']['useMergedFunctions'])) _includeDeliveryPluginFile('/var/cache/' . OX_getHostName() . '_mergedDeliveryFunctions.php');
if (!function_exists($var_316)) {
_includeDeliveryPluginFile($var_455['var_299']['CONF']['pluginPaths']['plugins'] . '/' . implode('/', $var_321) . '.delivery.php');
if (!function_exists($var_316)) {
_includeDeliveryPluginFile('/lib/OX/Extension/' . $var_321[0] . '/' . $var_321[0] . 'Delivery.php');
$var_316 = 'Plugin_' . $var_321[0] . '_delivery';
if (!empty($var_320) && function_exists($var_316 . '_' . $var_320)) {
$var_316 .= '_' . $var_320;
}
}
}
}
return $var_316;
}
function OX_Delivery_Common_getClickSignature(int $var_58, int $var_196, string $var_322): string
{
if (empty($var_455['var_299']['CONF']['delivery']['secret'])) {
throw new InvalidArgumentException('Empty delivery secret');
}
$var_323 = join("\t", [
base64_decode($var_455['_MAX']['CONF']['delivery']['secret']),
$var_58,
$var_196
]);
return hash_hmac(
'sha256',
$var_322,
$var_323
);
}
var_161 var_324($var_325)
{
if (!in_array($var_325, array_keys($var_455['_MAX']['FILES']))) {
$var_455['_MAX']['FILES'][$var_325] = true;
if (file_exists(var_5 . $var_325)) {
}
}
}
var_161 var_224($var_326, $var_168 = 6)
{
$var_4 = $var_455['_MAX']['CONF'];
if (empty($var_4['deliveryLog']['enabled'])) var_157 true;
$var_327 = is_numeric($var_4['deliveryLog']['priority']) ? $var_4['deliveryLog']['priority'] : 6;
if ($var_168 > $var_327 && empty($_REQUEST[$var_4['var']['trace']])) { var_157 true; }
error_log('[' . date('r') . "] {$var_4['log']['ident']}-delivery-{$var_455['_MAX']['thread_id']}: {$var_326}\n", 3, var_5 . '/var/' . $var_4['deliveryLog']['name']);
OX_Delivery_Common_hook('logMessage', array($var_326, $var_168));
return true;
}


$var_41 = '/lib/max/Delivery/cache.php';
$var_455['_MAX']['FILES'][$var_41] = true;
define ('OA_DELIVERY_CACHE_FUNCTION_ERROR', 'Function call returned an error');
$var_455['OA_Delivery_Cache'] = array(
'prefix' => 'deliverycache_',
'host' => fn_12(),
'expiry' => $var_455['_MAX']['CONF']['delivery']['cacheExpire']
);
function OA_Delivery_Cache_fetch($var_42, $var_328 = false, $var_329 = null)
{
$var_128 = OA_Delivery_Cache_buildFileName($var_42, $var_328);
$var_330 = OX_Delivery_Common_hook(
'cacheRetrieve',
array($var_128),
$var_455['_MAX']['CONF']['delivery']['cacheStorePlugin']
);
if ($var_330 !== false) {
if ($var_330['cache_name'] != $var_42) {
OX_Delivery_logMessage("Cache ERROR: {$var_42} != {$var_330['cache_name']}", 7);
return false;
}
var_150 ($var_329 === null) {
$var_329 = $var_455['OA_Delivery_Cache']['expiry'];
}
$var_187 = MAX_commonGetTimeNow();
if ( (isset($var_330['cache_time']) && $var_330['cache_time'] + $var_329 < $var_187)
|| (isset($var_330['cache_expire']) && $var_330['cache_expire'] < $var_187) )
{
OA_Delivery_Cache_store($var_42, $var_330['cache_contents'], $var_328);
OX_Delivery_logMessage("Cache EXPIRED: {$var_42}", 7);
return false;
}
OX_Delivery_logMessage("Cache HIT: {$var_42}", 7);
return $var_330['cache_contents'];
}
var_224("Cache MISS {$var_42}", 7);
return false;
}
var_161 var_331($var_42, $var_332, $var_328 = false, $var_333 = null)
{
if ($var_332 === var_98) {
var_157 false;
}
$var_128 = OA_Delivery_Cache_buildFileName($var_42, $var_328);
$var_330 = array();
$var_330['cache_contents'] = $var_332;
$var_330['cache_name'] = $var_42;
$var_330['cache_time'] = MAX_commonGetTimeNow();
$var_330['cache_expire'] = $var_333;
return OX_Delivery_Common_hook(
'cacheStore',
array($var_128, $var_330),
$var_455['_MAX']['CONF']['delivery']['cacheStorePlugin']
);
}
var_161 var_334($var_42, $var_332, $var_328 = false, $var_333 = null)
{
OX_Delivery_Common_hook(
'preCacheStore_'.OA_Delivery_Cache_getHookName($var_42),
array($var_42, &$var_332)
);
if (OA_Delivery_Cache_store($var_42, $var_332, $var_328, $var_333)) {
var_157 $var_332;
}
$var_335 = OA_Delivery_Cache_fetch($var_42, $var_328);
if ($var_335 === false) {
var_157 $var_332;
}
var_157 $var_335;
}
var_161 var_336($var_42)
{
$var_22 = strpos($var_42, '^');
return $var_22 ? substr($var_42, 0, $var_22) : substr($var_42, 0, strpos($var_42, '@'));
}
var_161 var_337($var_42, $var_328 = false)
{
if(!$var_328) {
$var_42 = md5($var_42);
}
var_157 $var_455['OA_Delivery_Cache']['prefix'].$var_42.'.php';
}
var_161 var_338($var_316)
{
$var_273 = func_get_args();
$var_273[0] = strtolower(str_replace('MAX_cacheGet', '', $var_273[0]));
return join('^', $var_273).'@'.$var_455['OA_Delivery_Cache']['host'];
}
var_161 var_339($var_123, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_123);
if (!$var_340 || ($var_114 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_114 = fn_51($var_123);
$var_114 = OA_Delivery_Cache_store_return($var_341, $var_114);
}
var_157 $var_114;
}
var_161 var_343($var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342);
if (!$var_340 || ($var_93 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_93 = fn_44();
$var_93 = OA_Delivery_Cache_store_return($var_341, $var_93);
}
var_157 $var_93;
}
var_161 var_344($var_196, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_196);
if (!$var_340 || ($var_114 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_114 = fn_47($var_196);
$var_114 = OA_Delivery_Cache_store_return($var_341, $var_114);
}
var_157 $var_114;
}
var_161 var_345($var_196, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_196);
if (!$var_340 || ($var_114 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_114 = fn_48($var_196);
$var_114 = OA_Delivery_Cache_store_return($var_341, $var_114);
}
var_157 $var_114;
}
var_161 var_346($var_196, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_196);
if (!$var_340 || ($var_114 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_114 = fn_45($var_196);
$var_114 = OA_Delivery_Cache_store_return($var_341, $var_114);
}
var_157 $var_114;
}
var_161 var_347($var_119, $var_120, $var_348, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_119, $var_120, $var_348);
if (!$var_340 || ($var_156 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_156 = fn_50($var_119, $var_120, $var_348);
$var_156 = OA_Delivery_Cache_store_return($var_341, $var_156);
}
var_157 $var_156;
}
var_161 var_349($var_119, $var_120, $var_348, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_119, $var_120, $var_348);
if (!$var_340 || ($var_156 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_156 = fn_49($var_119, $var_120, $var_348);
$var_156 = OA_Delivery_Cache_store_return($var_341, $var_156);
}
var_157 $var_156;
}
var_161 var_350($var_128, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_128);
if (!$var_340 || ($var_351 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_351 = fn_53($var_128);
$var_351['contents'] = addslashes(serialize($var_351['contents']));
$var_351 = OA_Delivery_Cache_store_return($var_341, $var_351);
}
$var_351['contents'] = unserialize(stripslashes($var_351['contents']));
return $var_351;
}
var_161 var_352($var_130, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_130);
if (!$var_340 || ($var_353 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_353 = fn_54($var_130);
$var_353 = OA_Delivery_Cache_store_return($var_341, $var_353);
}
var_157 $var_353;
}
var_161 var_354($var_130 = null, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_130);
if (!$var_340 || ($var_353 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_353 = fn_55($var_130);
$var_353 = OA_Delivery_Cache_store_return($var_341, $var_353);
}
var_157 $var_353;
}
var_161 var_355($var_130, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_130);
if (!$var_340 || ($var_211 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_211 = fn_56($var_130);
$var_211 = OA_Delivery_Cache_store_return($var_341, $var_211);
}
var_157 $var_211;
}
var_161 var_356($var_340 = true)
{
$var_357 = $var_455['_MAX']['CONF']['maintenance']['operationInterval'] * 60;
$var_358 = intval(($var_455['_MAX']['CONF']['maintenance']['operationInterval'] / 12) * 60);
$var_187 = MAX_commonGetTimeNow();
$var_359 = strtotime(date('Y-m-d'), $var_187);
$var_360 = $var_359 + (floor(($var_187 - $var_359) / $var_357) + 1) * $var_357 + $var_358;
if ($var_360 - $var_187 > $var_357) {
$var_360 -= $var_357;
}
$var_361 = OA_Delivery_Cache_getName(var_342);
if (!$var_340 || ($var_362 = OA_Delivery_Cache_fetch($var_361)) === false) {
MAX_Dal_Delivery_Include();
$var_362 = fn_57();
if ($var_362 >= $var_360 - $var_358) {
$var_360 += $var_357;
}
OA_Delivery_Cache_store($var_361, $var_362, false, $var_360);
}
var_157 $var_362 < $var_360 - $var_357;
}
var_161 var_363($var_125, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_125);
if (!$var_340 || ($var_127 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_127 = fn_52($var_125);
$var_127 = OA_Delivery_Cache_store_return($var_341, $var_127);
}
var_157 $var_127;
}
var_161 var_364($var_365, $var_340 = true)
{
$var_341 = OA_Delivery_Cache_getName(var_342, $var_365);
if (!$var_340 || ($var_55 = OA_Delivery_Cache_fetch($var_341)) === false) {
MAX_Dal_Delivery_Include();
$var_55 = fn_46($var_365);
$var_55 = OA_Delivery_Cache_store_return($var_341, $var_55);
}
var_157 $var_55;
}

var_224('starting delivery script: ' . basename($_SERVER['REQUEST_URI']), 7);
if (!empty($_REQUEST[$var_4['var']['trace']])) {
OX_Delivery_logMessage('trace enabled: ' . $_REQUEST[$var_4['var']['trace']], 7);
}
var_77();
var_284();
var_47();
var_52();
if (empty($var_455['_OA']['invocationType']) || $var_455['_OA']['invocationType'] != 'xmlrpc') {
OX_Delivery_Common_hook('postInit');
}



var_161 var_366($var_94, $var_277 = '')
{
if (!empty($var_94['compiledlimitation'])) {
if (!isset($var_455['_MAX']['FILES']['aIncludedPlugins'])) {
$var_455['_MAX']['FILES']['aIncludedPlugins'] = array();
}
$var_88 = true;
$var_49 = $var_455['_MAX']['CONF'];
if(strlen($var_94['acl_plugins'])) {
$var_367 = explode(',', $var_94['acl_plugins']);
foreach ($var_367 as $var_368) {
list($var_264, $var_369, $var_42) = explode(':', $var_368);
$var_370 = var_5 . $var_49['pluginPaths']['plugins'] . "{$var_264}/{$var_369}/{$var_42}.delivery.php";
if (!isset($var_455['_MAX']['FILES']['aIncludedPlugins'][$var_370])) {
if (include($var_370)) {
$var_455['_MAX']['FILES']['aIncludedPlugins'][$var_370] = true;
} var_149 {
var_157 true;
}
}
}
}
@var_371('$result = (' . $var_94['compiledlimitation'] . ');');
return $var_88;
} var_149 {
var_157 true;
}
}
var_161 var_372($var_118)
{
$var_58 = $var_118['ad_id'];
$var_373 = $var_118['placement_id'];
$var_374 = (bool)$var_118['show_capped_no_cookie'];
return (_limitationsIsAdCapped($var_58, $var_118['cap_ad'], $var_118['session_cap_ad'], $var_118['block_ad'], $var_374) ||
_limitationsIsCampaignCapped($var_373, $var_118['cap_campaign'], $var_118['session_cap_campaign'], $var_118['block_campaign'], $var_374));
}
var_161 var_375($var_196, $var_376)
{
$var_377 = isset($var_376['cap_zone']) ? $var_376['cap_zone'] : null;
$var_378 = isset($var_376['session_cap_zone']) ? $var_376['session_cap_zone'] : null;
$var_379 = isset($var_376['block_zone']) ? $var_376['block_zone'] : null;
$var_374 = !empty($var_376['show_capped_no_cookie_zone']);
return (_limitationsIsZoneCapped($var_196, $var_377, $var_378, $var_379, $var_374));
}
var_161 var_380($var_58, $var_66, $var_67 = 0, $var_65, $var_374)
{
var_157 _limitationsIsCapped('Ad', $var_58, $var_66, $var_67, $var_65, $var_374);
}
var_161 var_381($var_373, $var_66, $var_67 = 0, $var_65, $var_374)
{
var_157 _limitationsIsCapped('Campaign', $var_373, $var_66, $var_67, $var_65, $var_374);
}
var_161 var_382($var_196, $var_66, $var_67 = 0, $var_65, $var_374)
{
var_157 _limitationsIsCapped('Zone', $var_196, $var_66, $var_67, $var_65, $var_374);
}
var_161 var_383($var_20, $var_64, $var_66, $var_67, $var_65, $var_374)
{
if (_areCookiesDisabled((($var_66 > 0) || ($var_67 > 0) || ($var_65 > 0)) && !$var_374)) {
var_157 true;
}
$var_4 = $var_455['_MAX']['CONF'];
$var_54 = $var_4['var']['cap' . $var_20];
if (isset($_COOKIE[$var_54][$var_64])) {
$var_384 = $_COOKIE[$var_54][$var_64];
}
$var_54 = $var_4['var']['sessionCap' . $var_20];
if (isset($_COOKIE[$var_54][$var_64])) {
$var_385 = $_COOKIE[$var_54][$var_64];
}
$var_54 = $var_4['var']['block' . $var_20];
if (isset($_COOKIE[$var_54][$var_64])) {
$var_386 = $_COOKIE[$var_54][$var_64];
}
if ((($var_66 > 0) && isset($var_384) && ($var_384 >= $var_66)) ||
(($var_67 > 0) && isset($var_385) && ($var_385 >= $var_67))) {
if ($var_65 > 0 && MAX_commonGetTimeNow() > $var_386 + $var_65) {
var_157 false;
} var_149 {
var_157 true;
}
} var_149 if ($var_65 > 0 && ($var_66 == 0 && $var_67 == 0) && MAX_commonGetTimeNow() <= $var_386 + $var_65) {
var_157 true;
} var_149 {
var_157 false;
}
}
var_161 var_387($var_388 = true)
{
var_157 !empty($var_455['_MAX']['COOKIE']['newViewerId']) && $var_388;
}


var_161 var_389(array &$var_390, var_311 $var_196 = 0, var_230 $var_277 = '', var_230 $var_289 = '', var_230 $var_287 = '', var_391 $var_285 = false, var_230 $var_268 = '', var_391 $var_392 = true, var_391 $var_393 = true, var_391 $var_394 = true, var_230 $var_293 = '', var_230 $var_294 = null, array &$var_288 = [])
{
$var_390['bannerContent'] = "";
if (empty($var_289)) {
$var_289 = !empty($var_390['target']) ? $var_390['target'] : '_blank';
}
$var_289 = htmlspecialchars($var_289, var_395);
$var_277 = htmlspecialchars($var_277, var_395);
OX_Delivery_Common_hook('preAdRender', [&$var_390, &$var_196, &$var_277, &$var_287, &$var_285, &$var_392, &$var_393, null, &$var_394, &$var_293, &$var_294]);
$var_316 = _getAdRenderFunction($var_390, $var_394);
$var_396 = OX_Delivery_Common_hook('adRender', [&$var_390, &$var_196, &$var_277, &$var_287, &$var_285, &$var_392, &$var_393, null, &$var_394, &$var_293, &$var_294], $var_316);
$var_397 = rtrim(MAX_commonGetDeliveryUrl(), '/');
$var_398 = rtrim(_adRenderBuildImageUrlPrefix(), '/');
$var_399 = [
'{timestamp}' => MAX_commonGetTimeNow(),
'{random}' => MAX_getRandomNumber(),
'{target}'=> $var_289,
'{url_prefix}' => $var_397,
'{img_url_prefix}' => $var_398,
'{bannerid}' => $var_390['ad_id'],
'{zoneid}' => $var_196,
'{source}' => $var_277,
'{pageurl}' => urlencode($var_293),
'{width}' => $var_390['width'],
'{height}' => $var_390['height'],
'{websiteid}' => $var_390['affiliate_id'] ?? 0,
'{campaignid}' => $var_390['campaign_id'],
'{advertiserid}' => $var_390['client_id'],
'{referer}' => $var_294 ?? '',
'{logurl}' => '',  '{logurl_enc}' => '',  '{logurl_html}' => '',  '{clickurl}' => '',  '{clickurl_enc}' => '',  '{clickurl_html}' => '',  ];
preg_match_all('
for ($i = 0; $i < count($aMatches[1]); $i++) {
if (isset($aMagicMacros[$aMatches[0][$i]])) {
continue;
}
if (!isset($_REQUEST[$aMatches[1][$i]])) {
continue;
}
$value = stripslashes($_REQUEST[$aMatches[1][$i]]);
$aMagicMacros[$aMatches[0][$i]] = empty($macros[2][$i]) ?
htmlspecialchars($value, ENT_QUOTES) :
urlencode($value);
}
$componentParams = OX_Delivery_Common_hook('var_400', [$var_390]);
if (!empty($var_401) && is_array($var_401)) {
foreach ($var_401 as $var_246) {
if (!empty($var_246) && is_array($var_246)) {
foreach ($var_246 as $var_13 => $var_14) {
$var_13 = '{'.$var_13.'}';
if (isset($var_399[$var_13])) {
var_402;
}
$var_399[$var_13] = urlencode($var_14);
}
}
}
}
$var_390['aMagicMacros'] = $var_399;
preg_match_all('
for ($i = 0; $i < count($aMatches[2]); $i++) {
if (isset($aMagicMacros[$aMatches[0][$i]])) {
continue;
}
$dest = ':
$var_403 = _adRenderBuildSignedClickUrl($var_390, $var_196, $var_277, $var_392, $var_403);
switch ($aMatches[1][$var_281]) {
default:
$var_399[$aMatches[0][$var_281]] = $var_403;
break;
case '_enc':
$var_399[$aMatches[0][$var_281]] = urlencode($var_403);
break;
case '_html':
$var_399[$aMatches[0][$var_281]] = htmlspecialchars($var_403, var_395);
break;
}
}
$var_390['logUrl'] = _adRenderBuildLogURL($var_390, $var_196, $var_277, $var_293, $var_294, '&');
$var_390['clickUrl'] = _adRenderBuildSignedClickUrl($var_390, $var_196, $var_277, $var_392);
unset($var_399['{logurl}'], $var_399['{logurl_enc}'], $var_399['{logurl_html}'], $var_399['{clickurl}'], $var_399['{clickurl_enc}'], $var_399['{clickurl_html}']);
$var_399['{logurl}'] = $var_390['logUrl'];
$var_399['{logurl_enc}'] = urlencode($var_390['logUrl']);
$var_399['{logurl_html}'] = htmlspecialchars($var_390['logUrl'], var_395);
$var_399['{clickurl}'] = $var_390['clickUrl'];
$var_399['{clickurl_enc}'] = urlencode($var_390['clickUrl']);
$var_399['{clickurl_html}'] = htmlspecialchars($var_390['clickUrl'], var_395);
$var_390['aMagicMacros'] = $var_399;
$var_390['aSearch'] = array_keys($var_399);
$var_390['aReplace'] = array_values($var_399);
$var_396 = _adRenderReplaceMagicMacros($var_390, $var_396);
OX_Delivery_Common_hook('postAdRender', [&$var_396, $var_390, &$var_288]);
return MAX_commonConvertEncoding($var_396, $var_268);
}
function MAX_adRenderImageBeacon($var_404, $var_405 = 'beacon', $var_406 = null)
{
if (!isset($var_406) && isset($_SERVER['HTTP_USER_AGENT'])) {
$var_406 = $_SERVER['HTTP_USER_AGENT'];
}
$var_405 .= '_{random}';
if (isset($var_406) && var_144("
&& !preg_match("
$var_407 = "<var_408 var_64='{$var_405}' width='0' var_409='0' var_410='0' var_411='var_412'>";
$var_413 = '';
$var_414 = '</layer>';
} else {
$var_407 = "<var_407 var_64='{$var_405}' style='var_415: var_416; var_417: 0var_418; var_419: 0var_418; var_411: var_420;'>";
$var_413 = " var_413='width: 0px; height: 0px;'";
$var_414 = '</div>';
}
$var_421 = "$var_407<img src='".htmlspecialchars($var_404, var_395)."' width='0' height='0' alt=''{$var_413} />{$var_414}";
return $var_421;
}
function MAX_adRenderBlankBeacon($var_196, $var_277, $var_293, $var_294)
{
$var_404 = _adRenderBuildLogURL(array(
'ad_id' => 0,
'placement_id' => 0,
), $var_196, $var_277, $var_293, $var_294, '&');
return str_replace('{random}', MAX_getRandomNumber(), MAX_adRenderImageBeacon($var_404));
}
var_161 _adRenderImage(&$var_390, $var_196=0, $var_277='', $var_287='', $var_285=false, $var_392=true, $var_393=true, $var_422=false, $var_394=true, $var_293='', $var_294='', $var_288=array(), $var_423=true)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_390['bannerContent'] = $var_424 = _adRenderBuildFileUrl($var_390, $var_422);
if (!$var_394) {
var_157 _adRenderBuildFileUrl($var_390, $var_422);
}
$var_425 = (!empty($var_390['prepend']) && $var_423) ? $var_390['prepend'] : '';
$var_426 = (!empty($var_390['append']) && $var_423) ? $var_390['append'] : '';
if (!empty($var_390['url'])) {  $var_427 = _adRenderBuildStatusCode($var_390);
$var_428 = "<a href='{clickurl_html}' target='{target}'{$var_427}>";
$var_429 = '</a>';
} var_149 {
$var_428 = '';
$var_429 = '';
}
if (!empty($var_424)) {
$var_430 = empty($var_428) && !empty($var_427) ? $var_427 : '';
$var_431 = !empty($var_390['width']) ? $var_390['width'] : 0;
$var_409 = !empty($var_390['height']) ? $var_390['height'] : 0;
$var_432 = !empty($var_390['alt']) ? htmlspecialchars($var_390['alt'], var_395) : '';
$var_433 = "$var_428<img src='".htmlspecialchars($var_424, var_395)."' width='$var_431' height='$var_409' alt='$var_432' title='$var_432' border='0'$var_430 />$var_429";
} var_149 {
$var_433 = '';
}
$var_434 = $var_285 && !empty($var_390['bannertext']) ? "<br />$var_428" . htmlspecialchars($var_390['bannertext'], var_395) . "$var_429" : '';
$var_435 = ($var_393 && $var_4['logging']['adImpressions']) ? _adRenderImageBeacon($var_390, $var_196, $var_277, $var_293, $var_294) : '';
return $var_425 . $var_433 . $var_434 . $var_435 . $var_426;
}
var_161 var_436(&$var_390, $var_196=0, $var_277='', $var_287='', $var_285=false, $var_392=true, $var_393=true, $var_422=false, $var_394=true, $var_293='', $var_294='', $var_288=array())
{
if (!function_exists('Plugin_BannerTypeHtml_delivery_adRender')) {
_includeDeliveryPluginFile('/lib/OX/Extension/bannerTypeHtml/bannerTypeHtmlDelivery.php');
}
var_157 var_437($var_390, $var_196, $var_277, $var_287, $var_285, $var_392, $var_393, $var_422, $var_394, $var_293, $var_294);
}
var_161 var_438(&$var_390, $var_196=0, $var_277='', $var_287='', $var_285=false, $var_392=true, $var_393=true, $var_422=false, $var_394=false, $var_293='', $var_294='', $var_288=array())
{
$var_49 = $var_455['_MAX']['CONF'];
if (!function_exists('Plugin_BannerTypeText_delivery_adRender')) {
@include var_439 . '/Extension/bannerTypeText/bannerTypeTextDelivery.php';
}
var_157 Plugin_BannerTypeText_delivery_adRender($var_390, $var_196, $var_277, $var_287, $var_285, $var_392, $var_393, $var_422, $var_394, $var_293, $var_294);
}
var_161 var_440($var_390, $var_422 = false, $var_246 = '')
{
$var_4 = $var_455['_MAX']['CONF'];
$var_441 = '';
if ($var_390['type'] == 'url') {
$var_441 = $var_422 ? $var_390['alt_imageurl'] : $var_390['imageurl'];
if (!empty($var_246)) {
$var_441 .= "?{$var_246}";
}
} var_149 {
$var_325 = $var_422 ? $var_390['alt_filename'] : $var_390['filename'];
$var_246 = !empty($var_246) ? $var_246 : '';
if (!empty($var_325)) {
if ($var_390['type'] == 'web') {
$var_441 = _adRenderBuildImageUrlPrefix() . "/{$var_325}";
if (!empty($var_246)) {
$var_441 .= "?{$var_246}";
}
} var_148 ($var_390['type'] == 'sql') {
$var_441 = MAX_commonGetDeliveryUrl($var_4['file']['image']) . "?filename={$var_325}&contenttype={$var_390['contenttype']}";
if (!empty($var_246)) {
$var_441 .= "&{$var_246}";
}
}
}
}
var_157 $var_441;
}
var_161 var_442()
{
$var_4 = $var_455['_MAX']['CONF'];
return $var_455['_MAX']['SSL_REQUEST'] ? 'https:
}
function _adRenderBuildLogURL($aBanner, $zoneId = 0, $source = '', $var_293 = '', $var_294 = '', $var_443 = '&amp;', $var_444 = false)
{
$var_4 = $var_455['_MAX']['CONF'];
$var_445 = $var_455['_MAX']['MAX_DELIVERY_MULTIPLE_DELIMITER'];
$var_446 = (!empty($var_390['viewwindow']) && !empty($var_390['tracker_status'])) ? '1' : '';
if (!empty($var_455['_MAX']['adChain'])) {
foreach ($var_455['_MAX']['adChain'] as $var_234 => $var_447) {
$var_390['ad_id'] .= $var_445 . $var_447['ad_id'];
$var_390['placement_id'] .= $var_445 . $var_447['placement_id'];
$var_196 .= $var_445 . $var_447['zoneid'];
$var_390['block_ad'] .= $var_445 . $var_447['block_ad'];
$var_390['cap_ad'] .= $var_445 . $var_447['cap_ad'];
$var_390['session_cap_ad'] .= $var_445 . $var_447['session_cap_ad'];
$var_390['block_campaign'] .= $var_445 . $var_447['block_campaign'];
$var_390['cap_campaign'] .= $var_445 . $var_447['cap_campaign'];
$var_390['session_cap_campaign'] .= $var_445 . $var_447['session_cap_campaign'];
$var_390['block_zone'] .= $var_445 . $var_447['block_zone'];
$var_390['cap_zone'] .= $var_445 . $var_447['cap_zone'];
$var_390['session_cap_zone'] .= $var_445 . $var_447['session_cap_zone'];
$var_446 .= $var_445 . (!empty($var_447['viewwindow']) && !empty($var_447['tracker_status'])) ? '1' : '0';
}
}
$var_50 = MAX_commonGetDeliveryUrl($var_4['file']['log']);
$var_50 .= "?" . $var_4['var']['var_58'] . "=" . $var_390['ad_id'];
$var_50 .= $var_443 . $var_4['var']['campaignId'] . "=" . $var_390['placement_id'];
$var_50 .= $var_443 . $var_4['var']['zoneId'] . "=" . $var_196;
if (!empty($var_277)) $var_50 .= $var_443 . $var_4['var']['channel'] . "=" . $var_277;
if (!empty($var_390['block_ad'])) $var_50 .= $var_443 . $var_4['var']['blockAd'] . "=" . $var_390['block_ad'];
if (!empty($var_390['cap_ad'])) $var_50 .= $var_443 . $var_4['var']['capAd'] . "=" . $var_390['cap_ad'];
if (!empty($var_390['session_cap_ad'])) $var_50 .= $var_443 . $var_4['var']['sessionCapAd'] . "=" . $var_390['session_cap_ad'];
if (!empty($var_390['block_campaign'])) $var_50 .= $var_443 . $var_4['var']['blockCampaign'] . "=" . $var_390['block_campaign'];
if (!empty($var_390['cap_campaign'])) $var_50 .= $var_443 . $var_4['var']['capCampaign'] . "=" . $var_390['cap_campaign'];
if (!empty($var_390['session_cap_campaign'])) $var_50 .= $var_443 . $var_4['var']['sessionCapCampaign'] . "=" . $var_390['session_cap_campaign'];
if (!empty($var_390['block_zone'])) $var_50 .= $var_443 . $var_4['var']['blockZone'] . "=" . $var_390['block_zone'];
if (!empty($var_390['cap_zone'])) $var_50 .= $var_443 . $var_4['var']['capZone'] . "=" . $var_390['cap_zone'];
if (!empty($var_390['session_cap_zone'])) $var_50 .= $var_443 . $var_4['var']['sessionCapZone'] . "=" . $var_390['session_cap_zone'];
if (!empty($var_446)) $var_50 .= $var_443 . $var_4['var']['lastView'] . "=" . $var_446;
if (!empty($var_293)) $var_50 .= $var_443 . "loc=" . urlencode($var_293);
if (!empty($var_294)) $var_50 .= $var_443 . "referer=" . urlencode($var_294);
if (!empty($var_444)) $var_50 .= $var_443 . $var_4['var']['fallBack'] . '=1';
$var_50 .= $var_443 . "cb={random}";
$var_401 = OX_Delivery_Common_hook('addUrlParams', array($var_390));
if (!empty($var_401) && is_array($var_401)) {
foreach ($var_401 as $var_246) {
if (!empty($var_246) && is_array($var_246)) {
foreach ($var_246 as $var_13 => $var_14) {
$var_50 .= $var_443 . urlencode($var_13) . '=' . urlencode($var_14);
}
}
}
}
var_157 _adRenderReplaceMagicMacros($var_390, $var_50);
}
function _adRenderImageBeacon($var_390, $var_196 = 0, $var_277 = '', $var_293 = '', $var_294 = '', $var_404 = '')
{
if (empty($var_404)) {
$var_404 = _adRenderBuildLogURL($var_390, $var_196, $var_277, $var_293, $var_294, '&');
}
var_157 var_448($var_404);
}
var_161 _adRenderBuildClickQueryString(array $var_390, var_311 $var_196 = 0, var_230 $var_277 = '', var_391 $var_392 = true, var_230 $var_449 = null): var_230
{
if (isset($var_390['ad_id']) && empty($var_390['bannerid'])) {
$var_390['bannerid'] = $var_390['ad_id'];
}
$var_4 = $var_455['_MAX']['CONF'];
$var_445 = $var_455['_MAX']['MAX_DELIVERY_MULTIPLE_DELIMITER'];
$var_450 = (!empty($var_390['clickwindow'])) ? '1' : '';
if (!empty($var_455['_MAX']['adChain'])) {
foreach ($var_455['_MAX']['adChain'] as $var_234 => $var_447) {
$var_390['bannerid'] .= $var_445 . $var_447['bannerid'];
$var_390['placement_id'] .= $var_445 . $var_447['placement_id'];
$var_196 .= $var_445 . $var_447['zoneid'];
$var_450 .= (!empty($var_390['clickwindow'])) ? '1' : '0';
}
}
$var_315 = [
$var_4['var']['adId'] => $var_390['bannerid'] ?? '0',
$var_4['var']['zoneId'] => $var_196,
];
if (!empty($var_277)) {
$var_315['source'] = $var_277;
}
if (!$var_392) {
$var_315[$var_4['var']['logClick']] = 'no';
}
if (!empty($var_450)) {
$var_315[$var_4['var']['lastClick']] = $var_450;
}
$var_403 = _adRenderReplaceMagicMacros($var_390, $var_449 ?? $var_390['url'] ?? '');
if ($var_403) {
$var_315[$var_4['var']['signature']] = OX_Delivery_Common_getClickSignature(
$var_390['bannerid'] ?? 0,
$var_196,
$var_403
);
$var_315[$var_4['var']['dest']] = $var_403;
}
var_157 http_build_query($var_315);
}
var_161 var_451(array $var_390, var_230 $var_452): var_230
{
if (!isset($var_390['aMagicMacros'])) {
var_157 $var_452;
}
var_157 var_453(
array_keys($var_390['aMagicMacros']),
array_values($var_390['aMagicMacros']),
$var_452
);
}
var_161 var_454(array $var_390, var_311 $var_196 = 0, var_230 $var_277 = '', var_391 $var_392 = true, var_230 $var_449 = null): string
{
return var_253($var_455['var_299']['var_456']['var_41']['var_457']).'?'.
_adRenderBuildClickQueryString($var_390, $var_196, $var_277, $var_392, $var_449);
}
var_161 var_458($var_390, $var_196=0, $var_277='', $var_287='', $var_392=true, $var_459=false)
{
if (isset($var_390['ad_id']) && empty($var_390['bannerid'])) {
$var_390['bannerid'] = $var_390['ad_id'];
}
$var_4 = $var_455['_MAX']['CONF'];
$var_445 = $var_455['_MAX']['MAX_DELIVERY_MULTIPLE_DELIMITER'];
$var_450 = (!empty($var_390['clickwindow'])) ? '1' : '';
if (!empty($var_455['_MAX']['adChain'])) {
foreach ($var_455['_MAX']['adChain'] as $var_234 => $var_447) {
$var_390['bannerid'] .= $var_445 . $var_447['bannerid'];
$var_390['placement_id'] .= $var_445 . $var_447['placement_id'];
$var_196 .= $var_445 . $var_447['zoneid'];
$var_450 .= (!empty($var_390['clickwindow'])) ? '1' : '0';
}
}
$var_460 = '';
if (!empty($var_390['url']) || $var_459) {
$var_461 = $var_4['delivery']['ctDelimiter'];
$var_462 = strlen($var_461);
$var_463 = "{$var_461}{$var_4['var']['cacheBuster']}={random}";
$var_464 = !empty($var_390['bannerid']) ? "{$var_461}{$var_4['var']['adId']}={$var_390['bannerid']}" : '';
$var_196 = "{$var_461}{$var_4['var']['zoneId']}={$var_196}";
$var_277 = !empty($var_277) ? "{$var_461}source=" . urlencode($var_277) : '';
$var_465 = $var_392 ? '' : "{$var_461}{$var_4['var']['logClick']}=no";
$var_465 .= (!empty($var_450)) ? $var_461 . $var_4['var']['lastClick'] . '=' . $var_450 : '';
$var_460 = $var_462 . $var_464 . $var_196 . $var_277 . $var_465 . $var_463;
$var_401 = OX_Delivery_Common_hook('addUrlParams', array($var_390));
if (!empty($var_401) && is_array($var_401)) {
foreach ($var_401 as $var_246) {
if (!empty($var_246) && is_array($var_246)) {
foreach ($var_246 as $var_13 => $var_14) {
$var_460 .= $var_461 . urlencode($var_13) . '=' . urlencode($var_14);
}
}
}
}
}
var_157 $var_460;
}
var_161 var_466($var_390, $var_196 = 0, $var_277 = '', $var_287 = '', $var_392 = true, $var_459 = false)
{
$var_4 = $var_455['_MAX']['CONF'];
if (empty($var_390['url']) && !$var_459) {
var_157 '';
}
var_157 MAX_commonGetDeliveryUrl($var_4['file']['click']) . '?' . $var_4['var']['params'] . '=' . _adRenderBuildParams($var_390, $var_196, $var_277, $var_287, $var_392, $var_459);
}
var_161 var_467($var_390)
{
var_157 !empty($var_390['status']) ? " onmouseover=\"self.status='" . addslashes($var_390['status']) . "'; return true;\" onmouseout=\"self.status=''; return true;\"" : '';
}
var_161 var_468($var_390, $var_394 = true)
{
$var_316 = false;
if (!empty($var_390['ext_bannertype'])) {
var_157 OX_Delivery_Common_getFunctionFromComponentIdentifier($var_390['ext_bannertype'], 'adRender');
} var_149 {
switch ($var_390['contenttype']) {
var_562 'gif' :
case 'jpeg' :
case 'png' :
$var_316 = '_adRenderImage';
break;
case 'txt' :
$var_316 = '_adRenderText';
break;
default :
switch ($var_390['type']) {
var_562 'html' :
$var_316 = '_adRenderHtml';
break;
case 'url' :  $var_316 = '_adRenderImage';
break;
case 'txt' :
$var_316 = '_adRenderText';
break;
default:
$var_316 = '_adRenderHtml';
break;
}
var_563;
}
}
var_157 $var_316;
}


var_469 ("PRI_ECPM_FROM", 6);
var_469 ("PRI_ECPM_TO", 9);
$var_455['OX_adSelect_SkipOtherPriorityLevels'] = -1;
function MAX_adSelect($var_291, $var_120 = '', $var_289 = '', $var_277 = '', $var_286 = 0, $var_268 = '', $var_288 = array(), $var_470 = true, $var_287 = '', $var_293 = '', $var_294 = '')
{
$var_4 = $var_455['_MAX']['CONF'];
if (empty($var_455['source'])) {
$var_455['source'] = $var_277;
}
if (empty($var_455['loc'])) {
$var_455['loc'] = $var_293;
}
$var_471 = null;
if (strpos($var_291,'zone:') === 0) {
$var_471 = intval(substr($var_291,5));
} elseif (strpos($var_291,'campaignid:') === 0) {
$var_472 = intval(substr($var_291,11));
} elseif (strpos($var_291, 'bannerid:') === 0) {
$var_473 = intval(substr($var_291,9));
}
$var_474 = fn_27();
fn_20($var_4['var']['viewerId'], $var_474, fn_23());
$var_475 = '';
$var_275 = false;
$var_455['_MAX']['followedChain'] = array();
$var_455['_MAX']['adChain'] = array();
$var_455['_MAX']['considered_ads'] = array();
$var_476 = true;
global $var_477, $var_478;
$var_477 = '';
$var_478 = '';
if(!empty($var_291)) {
while ($var_476 || ($var_291 != '' && $var_275 == false)) {
$var_476 = false;
$var_479 = strpos($var_291, '|');
if ($var_479 === false) {
$var_480 = '';
} var_149 {
$var_480 = substr($var_291, $var_479+1);
$var_291 = substr($var_291, 0, $var_479);
}
if (strpos($var_291, 'zone:') === 0) {
$var_196 = intval(substr($var_291,5));
$var_94 = _adSelectZone($var_196, $var_288, $var_277, $var_470);
} var_149 {
if (strpos($var_291, '/') > 0) {
if (strpos($var_291, '@') > 0) {
list ($var_291, $var_426) = explode ('@', $var_291);
} var_149 {
$var_426 = '';
}
$var_481 = explode ('/', $var_291);
$var_482 = '';
$var_483 = array();
reset($var_481);
while (list(,$var_74) = each($var_481)) {
$var_482 .= ($var_482 != '' ? ',+' : '') . $var_74;
$var_483[] = $var_482 . ($var_426 != '' ? ',+'.$var_426 : '');
}
$var_291 = strtok(implode('|', array_reverse ($var_483)), '|');
$var_480 = strtok('').($var_480 != '' ? '|'.$var_480 : '');
}
$var_94 = _adSelectDirect($var_291, $var_120, $var_288, $var_277, $var_470, $var_480 == '');
}
var_150 (is_array($var_94) && empty($var_94['default'])) {
MAX_Delivery_log_logAdRequest($var_94['bannerid'], $var_94['zoneid'], $var_94);
if (($var_94['adserver'] == 'max' || $var_94['adserver'] == '3rdPartyServers:ox3rdPartyServers:max')
&& preg_match("
$var_455['var_299']['adChain'][] = $var_94;
$var_275 = false;
$var_291 = "zone:{$var_292[1]}";
} else {
$var_275 = true;
}
} else {
if (empty($var_94['var_484'])) {
MAX_Delivery_log_logAdRequest(null, $var_471, null);
}
$var_291 = $var_480;
}
}
}
if ($var_275) {
$var_196 = empty($var_94['var_96']) ? 0 : $var_94['var_96'];
if (!empty($var_455['var_299']['adChain'])) {
foreach ($var_455['var_299']['adChain'] as $var_234 => $var_447) {
if (($var_447['var_123'] != $var_94['var_123']) && !empty($var_447['var_426'])) {
$var_94['var_426'] .= $var_447['var_426'];
}
}
}
$var_475 = MAX_adRender($var_94, $var_196, $var_277, $var_289, $var_287, $var_286, $var_268, true, true, $var_470, $var_293, $var_294, $var_288);
$var_55 = array(
'html' => $var_475,
'bannerid' => $var_94['var_151'],
'contenttype' => $var_94['var_485'],
'alt' => $var_94['var_432'],
'width' => $var_94['var_431'],
'height' => $var_94['var_409'],
'url' => $var_94['var_50'],
'campaignid' => $var_94['var_120'],
'clickUrl' => $var_94['var_486'],
'logUrl' => $var_94['var_404'],
'aSearch' => $var_94['var_487'],
'aReplace' => $var_94['var_488'],
'aMagicMacros' => $var_94['var_399'],
'bannerContent' => $var_94['var_489'],
'clickwindow' => $var_94['var_490'],
'aRow' => $var_94,
'context' => _adSelectBuildContext($var_94, $var_288),
'iframeFriendly' => (bool)$var_94['var_491'],
);
$var_94 += array(
'block_ad' => 0,
'cap_ad' => 0,
'session_cap_ad' => 0,
'block_campaign' => 0,
'cap_campaign' => 0,
'session_cap_campaign' => 0,
'block_zone' => 0,
'cap_zone' => 0,
'session_cap_zone' => 0,
);
if (MAX_Delivery_cookie_cappingOnRequest()) {
if ($var_94['var_492'] > 0 || $var_94['var_493'] > 0 || $var_94['var_494'] > 0) {
MAX_Delivery_cookie_setCapping('Ad', $var_94['var_151'], $var_94['var_492'], $var_94['var_493'], $var_94['var_494']);
}
if ($var_94['var_495'] > 0 || $var_94['var_496'] > 0 || $var_94['var_497'] > 0) {
MAX_Delivery_cookie_setCapping('Campaign', $var_94['var_498'], $var_94['var_495'], $var_94['var_496'], $var_94['var_497']);
}
if ($var_94['var_499'] > 0 || $var_94['var_500'] > 0 || $var_94['var_501'] > 0) {
MAX_Delivery_cookie_setCapping('Zone', $var_94['var_96'], $var_94['var_499'], $var_94['var_500'], $var_94['var_501']);
}
MAX_Delivery_log_setLastAction(0, array($var_94['var_151']), array($var_196), array($var_94['var_502']));
}
} else {
if (!empty($var_196)) {
if (empty($var_94['var_503'])) {
$var_477 = MAX_adRenderBlankBeacon($var_196, $var_277, $var_293, $var_294).$var_477;
}
$var_475 = join("\var_504", OX_Delivery_Common_hook('blankAdSelect', array($var_196, $var_288, $var_277, $var_470)) ?: []);
}
if (!var_227($var_475)) {
$var_475 = $var_478 . $var_475 . $var_477;
$var_55 = ['var_577' => $var_475, 'var_151' => ''];
} var_148 (!empty($var_94['default'])) {
if (!empty($var_94['default_banner_html'])) {
$var_475 = $var_478 . $var_94['default_banner_html'] . $var_477;
$var_55 = ['html' => $var_475, 'bannerid' => ''];
} var_149 {
if (empty($var_289)) {
$var_289 = '_blank';  }
$var_475 = $var_478 . '<a href=\'' . $var_94['default_banner_destination_url'] . '\' target=\'' .
$var_289 . '\'><img src=\'' . $var_94['default_banner_image_url'] .
'\' border=\'0\' alt=\'\'></a>' . $var_477;
$var_55 = ['html' => $var_475, 'bannerid' => '', 'default_banner_image_url' => $var_94['default_banner_image_url']];
}
} var_148 (!empty($var_4['defaultBanner']['imageUrl'])) {
if (empty($var_289)) {
$var_289 = '_blank';  }
$var_475 = "{$var_478}<img src='{$var_4['defaultBanner']['imageUrl']}' border='0' alt=''>{$var_477}";
$var_55 = ['html' => $var_475, 'bannerid' => '', 'default_banner_image_url' => $var_4['defaultBanner']['imageUrl']];
} var_149 {
$var_475 = $var_478 . $var_477;
$var_55 = ['html' => $var_475, 'bannerid' => ''];
}
}
var_202('postAdSelect', [&$var_55]);
return $var_55;
}
var_161 var_505($var_291, $var_120 = '', $var_288 = array(), $var_277 = '', $var_394 = true, $var_121 = true)
{
$var_506 = MAX_cacheGetLinkedAdInfos($var_291, $var_120, $var_121);
$var_455['_MAX']['DIRECT_SELECTION'] = true;
$var_507 = _adSelectCommon($var_506, $var_288, $var_277, $var_394);
if (is_array($var_507)) {
$var_507['zoneid'] = 0;
$var_507['bannerid'] = $var_507['ad_id'];
$var_507['storagetype'] = $var_507['type'];
$var_507['campaignid'] = $var_507['placement_id'];
return $var_507;
}
if (!empty($var_506['default_banner_image_url'])) {
var_157 array(
'default' => true,
'default_banner_image_url' => $var_506['default_banner_image_url'],
'default_banner_destination_url' => $var_506['default_banner_destination_url']
);
}
var_157 false;
}
var_161 var_508($var_196, $var_509)
{
if (!empty($var_509['chain']) && (substr($var_509['chain'],0,5) == 'zone:')) {
var_157 intval(substr($var_509['chain'],5));
}
var_149 {
var_157 $var_196;
}
}
var_161 var_510($var_196, $var_288 = array(), $var_277 = '', $var_394 = true)
{
$var_49 = $var_455['_MAX']['CONF'];
if ($var_196 === 0) { var_157 false; }
var_547 $var_477, $var_478;
while (!in_array($var_196, $var_455['_MAX']['followedChain'])) {
$var_455['_MAX']['followedChain'][] = $var_196;
$var_511 = false;
$var_99 = MAX_cacheGetZoneInfo($var_196);
if (empty($var_99)) {
var_157 false;
}
if (!empty($var_99['default'])) {
var_157 [
'default' => true,
'default_banner_html' => $var_99['default_banner_html'] ?? '',
'skip_log_request' => !empty($var_99['skip_log_request']),
'skip_log_blank' => !empty($var_99['skip_log_blank']),
];
}
if ($var_196 != 0 && MAX_limitationsIsZoneForbidden($var_196, $var_99)) {
$var_196 = _getNextZone($var_196, $var_99);
continue;
}
$var_512 = MAX_cacheGetZoneLinkedAdInfos ($var_196);
if (is_array($var_99)) {
if (isset($var_99['forceappend']) && $var_99['forceappend'] == 't') {
$var_478 .= $var_99['prepend'];
$var_477 = $var_99['append'] . $var_477;
$var_511 = true;
}
$var_512 += $var_99;
$var_507 = _adSelectCommon($var_512, $var_288, $var_277, $var_394);
if (is_array($var_507)) {
$var_507['zoneid'] = $var_196;
$var_507['bannerid'] = $var_507['ad_id'];
$var_507['storagetype'] = $var_507['type'];
$var_507['campaignid'] = $var_507['placement_id'];
$var_507['zone_companion'] = $var_512['zone_companion'];
$var_507['block_zone'] = @$var_99['block_zone'];
$var_507['cap_zone'] = @$var_99['cap_zone'];
$var_507['session_cap_zone'] = @$var_99['session_cap_zone'];
$var_507['affiliate_id'] = @$var_99['publisher_id'];
if (!$var_511) {
$var_507['append'] .= @$var_99['append'] . $var_477;
$var_507['prepend'] = $var_478 . @$var_99['prepend'] . $var_507['prepend'];
} var_149 {
$var_507['append'] .= $var_477;
$var_507['prepend'] = $var_478 . $var_507['prepend'];
}
return ($var_507);
}
$var_196 = _getNextZone($var_196, $var_99);
}
}
var_150 (!empty($var_99['default_banner_image_url'])) {
var_157 [
'default' => true,
'default_banner_image_url' => $var_99['default_banner_image_url'],
'default_banner_destination_url' => $var_99['default_banner_destination_url']
];
}
var_157 false;
}
var_161 var_513($var_156, $var_288, $var_277, $var_394)
{
OX_Delivery_Common_hook('preAdSelect', array(&$var_156, &$var_288, &$var_277, &$var_394));
if (!empty($var_156['ext_adselection'])) {
$var_514 = OX_Delivery_Common_getFunctionFromComponentIdentifier($var_156['ext_adselection'], 'adSelect');
}
if (empty($var_514) || !function_exists($var_514)) {
$var_514 = '_adSelect';
}
if (!empty($var_156['count_active'])) {
if (isset($var_156['zone_companion']) && isset($var_288)) {
foreach ($var_288 as $var_515) {
if (isset($var_515['==']) && preg_match('/^companionid:/', $var_515['=='])) {
if ($var_507 = _adSelectInnerLoop($var_514, $var_156, $var_288, $var_277, $var_394, true)) {
var_157 $var_507;
}
}
}
}
$var_507 = _adSelectInnerLoop($var_514, $var_156, $var_288, $var_277, $var_394);
if (is_array($var_507)) {
var_157 $var_507;
}
}
var_157 false;
}
var_161 var_516($var_514, $var_156, $var_288, $var_277, $var_394, $var_517 = false)
{
$var_518 = array(
'xAds' => false,  'ads' => array(10, 9, 8, 7, 6, 5, 4, 3, 2, 1),
'lAds' => false,  'eAds' => array(-2),  );
$var_455['_MAX']['considered_ads'][] = &$var_156;
foreach ($var_518 as $var_20 => $var_519) {
if ($var_519) {
$var_520 = false;
foreach ($var_519 as $var_521) {
if (!$var_520) {
$var_507 = OX_Delivery_Common_hook('adSelect',
array(&$var_156, &$var_288, &$var_277, &$var_394, $var_517, $var_20, $var_521), $var_514);
if (is_array($var_507)) {
$var_520 = true;
}
if ($var_507 == $var_455['OX_adSelect_SkipOtherPriorityLevels']) {
$var_520 = true;
}
}
var_149
{
if (!empty($var_156[$var_20][$var_521])) {
$var_522 = _adSelectBuildContextArray($var_156[$var_20][$var_521], $var_20, $var_288);
_adSelectDiscardNonMatchingAds($var_156[$var_20][$var_521], $var_522, $var_277, $var_394);
}
}
}
var_150 ($var_520 && is_array ($var_507)) {
var_157 $var_507;
}
} var_149 {
$var_507 = OX_Delivery_Common_hook('adSelect', array(&$var_156, &$var_288, &$var_277, &$var_394, $var_517, $var_20), $var_514);
if (is_array($var_507)) {
var_157 $var_507;
}
}
}
var_157 false;
}
var_161 var_523(&$var_524, $var_288, $var_277, $var_394, $var_517, $var_525 = 'ads', $var_526 = null)
{
if (!is_array($var_524)) { var_157; }
var_150 (!is_null($var_526) && isset($var_524[$var_525][$var_526])) {
$var_156 = &$var_524[$var_525][$var_526];
} var_148 (is_null($var_526) && isset($var_524[$var_525])) {
$var_156 = &$var_524[$var_525];
} var_149 {
$var_156 = array();
}
var_150 (count($var_156) == 0) {
var_157;
}
$var_522 = _adSelectBuildContextArray($var_156, $var_525, $var_288, $var_517);
_adSelectDiscardNonMatchingAds($var_156, $var_522, $var_277, $var_394);
if (count($var_156) == 0) {
var_157;
}
var_547 $var_504;
mt_srand
(floor
((isset ($var_504) && strlen ($var_504) > 5
? hexdec ($var_504[0].$var_504[2].$var_504[3].$var_504[4].$var_504[5])
: 1000000) * (double) microtime ()));
$var_4 = $var_455['_MAX']['CONF'];
if ($var_525 == 'eAds') {
if (!empty ($var_4['delivery']['ecpmSelectionRate'])) {
$var_527 = floatval ($var_4['delivery']['ecpmSelectionRate']);
if (!_controlTrafficEnabled ($var_156) ||
(mt_rand (0, $var_455['_MAX']['MAX_RAND']) /
$var_455['_MAX']['MAX_RAND']) <= $var_527)
{
$var_528 = 0;
$var_529 = array();
foreach ($var_156 as $var_13 => $var_447) {
if ($var_447['ecpm'] < $var_528) {
var_402;
} var_148 ($var_447['ecpm'] > $var_528) {
$var_529 = array();
$var_528 = $var_447['ecpm'];
}
$var_529[$var_13] = 1;
}
if ($var_528 <= 0)
{
$var_455['_MAX']['ECPM_CONTROL'] = 1;
$var_169 = _setPriorityFromWeights($var_156);
} var_149 {
$var_455['_MAX']['ECPM_SELECTION'] = 1;
$var_169 = count ($var_529);
foreach ($var_156 as $var_13 => $var_447) {
if (!empty ($var_529[$var_13])) {
$var_156[$var_13]['priority'] = 1 / $var_169;
} var_149 {
$var_156[$var_13]['priority'] = 0;
}
}
}
}
var_149
{
$var_455['_MAX']['ECPM_CONTROL'] = 1;
$var_169 = _setPriorityFromWeights($var_156);
}
}
} var_149 if (isset($var_526)) {
$var_530 = 0;
for ($var_281 = 10; $var_281 > $var_526; $var_281--)
{
if (isset ($var_524['priority_used'][$var_525][$var_281]))
{
$var_530 += $var_524['priority_used'][$var_525][$var_281];
}
}
if ($var_530 >= 1) {
var_157 $var_455['OX_adSelect_SkipOtherPriorityLevels'];
}
$var_531 = 1 - $var_530;
$var_532 = 0;
foreach ($var_156 as $var_447) {
$var_532 += $var_447['priority'] * $var_447['priority_factor'];
}
$var_524['priority_used'][$var_525][$var_281] = $var_532;
if ($var_532 <= 0) {
var_157;
}
if ($var_532 > $var_531
|| $var_517
)
{
$var_533 = $var_532;
if ($var_526 >= var_534 &&
$var_526 <= var_535 &&
!empty ($var_4['delivery']['ecpmSelectionRate']))
{
$var_527 = floatval ($var_4['delivery']['ecpmSelectionRate']);
if (!_controlTrafficEnabled ($var_156) ||
(mt_rand (0, $var_455['_MAX']['MAX_RAND']) /
$var_455['_MAX']['MAX_RAND']) <= $var_527)
{
$var_455['_MAX']['ECPM_SELECTION'] = 1;
foreach ($var_156 as $var_13 => $var_447) {
$var_536[] = $var_447['ecpm'];
$var_538[] = $var_13;
}
array_multisort ($var_536, var_537, $var_538);
$var_539 = $var_531;
$var_540 = count ($var_156);
$var_281 = 0;
while ($var_281 < $var_540) {
$var_541 = $var_281;
while ($var_541 < $var_540 - 1 &&
$var_536[$var_541 + 1] == $var_536[$var_281]) {
$var_541++;
}
$var_542 = 0;
for ($var_543 = $var_281; $var_543 <= $var_541; $var_543++) {
$var_64 = $var_538[$var_543];
$var_542 += $var_156[$var_64]['priority'] * $var_156[$var_64]['priority_factor'];
}
if ($var_542 > $var_539) {
$var_544 = $var_539 / $var_542;
for ($var_543 = $var_281; $var_543 <= $var_541; $var_543++) {
$var_64 = $var_538[$var_543];
$var_156[$var_64]['priority'] = $var_156[$var_64]['priority'] * $var_544;
}
$var_539 = 0;
for ($var_543 = $var_541 + 1; $var_543 < $var_540; $var_543++) {
$var_64 = $var_538[$var_543];
$var_156[$var_64]['priority'] = 0;
}
var_563;
} var_149 {
$var_539 -= $var_542;
$var_281 = $var_541 + 1;
}
}
$var_533 = $var_531;
} var_149 {
$var_455['_MAX']['ECPM_CONTROL'] = 1;
}
}
$var_545 = 1 / $var_533;
}
var_149
{
$var_545 = 1 / $var_531;
}
$var_169 = 0;
foreach ($var_156 as $var_13 => $var_447) {
$var_546 =
$var_447['var_168'] * $var_447['priority_factor'] * $var_545;
$var_156[$var_13]['var_168'] = $var_546;
$var_169 += $var_546;
}
} var_149 {
$var_169 = _setPriorityFromWeights($var_156);
}
var_547 $var_504;
var_548
(floor
((isset ($var_504) && strlen ($var_504) > 5
? hexdec ($var_504[0].$var_504[2].$var_504[3].$var_504[4].$var_504[5])
: 1000000) * (double) microtime ()));
$var_4 = $var_455['var_299']['var_456'];
$var_549 =
var_550 (0, $var_455['var_299']['var_551'])
/ $var_455['_MAX']['MAX_RAND'];
  if ($var_549 > $var_169) {
var_157;
}
$var_552 = 0;
$var_553 = 0;
foreach($var_156 as $var_507) {
if (!var_227($var_507['var_168'])) {
$var_552 = $var_553;
$var_553 += $var_507['var_168'];
if ($var_553 > $var_549 && $var_552 <= $var_549) {
 $var_447 = MAX_cacheGetAd($var_507['ad_id']);
$var_447['tracker_status'] = (!empty($var_507['tracker_status'])) ? $var_507['tracker_status'] : null;
if($var_447['width'] == $var_447['height'] && $var_447['width'] == -1) {
$var_447['width'] = $var_507['width'];
$var_447['height'] = $var_507['height'];
}
var_157 $var_447;
}
}
}
var_157;
}
function var_554 (&$var_156)
{
$var_555 = true;
if (empty ($var_455['_MAX']['CONF']['delivery']['enableControlOnPureCPM']))
{
$var_555 = false;
foreach ($var_156 as $var_447) {
if ($var_447['revenue_type'] != var_556)
{
$var_555 = true;
break;
}
}
}
var_157 $var_555;
}
var_161 var_557($var_118, $var_522, $var_277, $var_394)
{
$var_4 = $var_455['_MAX']['CONF'];
if (!empty ($var_118['expire_time'])) {
$var_43 = strtotime ($var_118['expire_time']);
$var_187 = MAX_commonGetTimeNow ();
if ($var_43 > 0 && $var_187 > $var_43) {
OX_Delivery_logMessage('Campaign has expired for bannerid '.$var_118['ad_id'], 7);
return false;
}
}
if (isset($var_522['banner']['exclude'][$var_118['ad_id']])) {
OX_Delivery_logMessage('List of excluded banners list contains bannerid '.$var_118['ad_id'], 7);
return false;
}
if (isset($var_522['campaign']['exclude'][$var_118['placement_id']])) {
OX_Delivery_logMessage('List of excluded campaigns contains bannerid '.$var_118['ad_id'], 7);
return false;
}
if (isset($var_522['client']['exclude'][$var_118['client_id']])) {
OX_Delivery_logMessage('List of excluded clients contains bannerid '.$var_118['ad_id'], 7);
return false;
}
if (!empty($var_522['banner']['include']) && !isset($var_522['banner']['include'][$var_118['ad_id']])) {
OX_Delivery_logMessage('List of included banners does not contain bannerid '.$var_118['ad_id'], 7);
return false;
}
if (!empty($var_522['campaign']['include']) && !isset($var_522['campaign']['include'][$var_118['placement_id']])) {
OX_Delivery_logMessage('List of included campaigns does not contain bannerid '.$var_118['ad_id'], 7);
return false;
}
if (  $var_394 == false &&
$var_118['alt_filename'] == '' &&
!($var_118['contenttype'] == 'jpeg' || $var_118['contenttype'] == 'gif' || $var_118['contenttype'] == 'png') &&
!($var_118['type'] == 'url' && $var_118['contenttype'] == '')
) {
OX_Delivery_logMessage('No alt image specified for richmedia bannerid '.$var_118['ad_id'], 7);
return false;
}
var_150 (MAX_limitationsIsAdForbidden($var_118)) {
OX_Delivery_logMessage('MAX_limitationsIsAdForbidden = true for bannerid '.$var_118['ad_id'], 7);
return false;
}
var_150 ($var_455['_MAX']['SSL_REQUEST'] && $var_118['type'] == 'html' && $var_118['html_ssl_unsafe']) {
OX_Delivery_logMessage('"http:" on SSL found for html bannerid '.$var_118['ad_id'], 7);
return false;
}
var_150 ($var_455['_MAX']['SSL_REQUEST'] && $var_118['type'] == 'url' && $var_118['url_ssl_unsafe']) {
OX_Delivery_logMessage('"http:" on SSL found in imagurl for url bannerid '.$var_118['ad_id'], 7);
return false;
}
var_150 ($var_4['delivery']['acls'] && !MAX_limitationsCheckAcl($var_118, $var_277)) {
OX_Delivery_logMessage('MAX_limitationsCheckAcl = false for bannerid '.$var_118['ad_id'], 7);
return false;
}
var_157 true;
}
var_161 var_558(&$var_559, $var_525, $var_288, $var_517 = false)
{
$var_522 = array(
'campaign' => array('exclude' => array(), 'include' => array()),
'banner' => array('exclude' => array(), 'include' => array()),
'client' => array('exclude' => array(), 'include' => array()),
);
if (is_array($var_288) && !empty($var_288)) {
$var_560 = count($var_288);
for ($var_281=0; $var_281 < $var_560; $var_281++) {
reset($var_288[$var_281]);
list ($var_13, $var_14) = each($var_288[$var_281]);
$var_561 = explode(':', $var_14);
if (count($var_561) == 1) {
list($var_14) = $var_561;
$var_20 = "";
} var_149 {
list($var_20, $var_14) = $var_561;
}
if (empty($var_14)) {
var_402;
}
switch($var_20) {
var_562 'campaignid':
switch ($var_13) {
var_562 '!=': $aContext['campaign']['exclude'][$var_14] = true; break;
case '==': $aContext['campaign']['include'][$var_14] = true; break;
}
var_563;
case 'clientid':
switch ($var_13) {
var_562 '!=': $aContext['client']['exclude'][$var_14] = true; break;
case '==': $aContext['client']['include'][$var_14] = true; break;
}
var_563;
case 'companionid':
switch ($var_13) {
var_562 '!=':
$aContext['campaign']['exclude'][$var_14] = true;
break;
case '==':
if ($companion) {
$aContext['campaign']['include'][$var_14] = true;
}
var_563;
}
var_563;
default:
switch ($var_13) {
var_562 '!=': $aContext['var_574']['exclude'][$var_14] = true; break;
case '==': $aContext['var_574']['include'][$var_14] = true; break;
}
}
}
}
var_157 $var_522;
}
function var_564($var_390, $var_288 = array()) {
if (!empty($var_390['zone_companion'])) {
$var_56 = [];
foreach ($var_288 as $var_565){
if(!isset($var_56[current($var_565)][key($var_565)])){
$var_56[current($var_565)][] = key($var_565);
}
}
foreach ($var_390['zone_companion'] AS $var_566) {
$var_14 = 'companionid:'.$var_566;
if ($var_390['placement_id'] == $var_566) {
$var_288[] = array('==' => $var_14);
if(!isset($var_56[$var_14]['=='])){
$var_56[$var_14][] = '==';
}
} var_149 {
if(!isset($var_56[$var_14]['=='])){
$var_288[] = array('!=' => $var_14);
}
}
}
}
var_150 (isset($var_390['advertiser_limitation']) && $var_390['advertiser_limitation'] == '1') {
$var_288[] = array('!=' => 'clientid:' . $var_390['client_id']);
}
var_157 $var_288;
}
var_161 var_567(&$var_156, $var_522, $var_277, $var_394)
{
if (empty($var_455['_MAX']['CONF']['delivery']['aclsDirectSelection']) && !empty($var_455['_MAX']['DIRECT_SELECTION'])) {
var_157;
}
var_568 ($var_156 as $var_58 => $var_118) {
OX_Delivery_logMessage('_adSelectDiscardNonMatchingAds: checking bannerid '.$var_118['ad_id'], 7);
if (!_adSelectCheckCriteria($var_118, $var_522, $var_277, $var_394)) {
OX_Delivery_logMessage('failed _adSelectCheckCriteria: bannerid '.$var_118['ad_id'], 7);
unset($var_156[$var_58]);
} var_149 {
OX_Delivery_logMessage('passed _adSelectCheckCriteria: bannerid '.$var_118['ad_id'], 7);
}
}
var_157;
}


var_161 var_569()
{
var_157 '';
}
var_161 var_570()
{
var_157 '';
}

var_269();
var_272(array('refresh', 'resize', 'rewrite', 'n'));
if (!isset($var_571)) $var_571 = 1;
if (!isset($var_572)) $var_572 = 0;
if (!isset($var_573)) $var_573 = 0;
$var_574 = MAX_adSelect($var_291, $var_120, $var_289, $var_277, $var_286, $var_268, $var_288, true, $var_287, $var_293, $var_294);
if (!empty($var_504)) {
if (!empty($var_574['html'])) {
$var_59 = array();
$var_59[$var_4['var']['adId']] = $var_574['bannerid'];
if ($var_96 != 0) {
$var_59[$var_4['var']['zoneId']] = $var_96;
}
if (!empty($var_277)) {
$var_59[$var_4['var']['channel']] = $var_277;
}
fn_20($var_4['var']['vars'] . "[$var_504]", json_encode($var_59, var_575));
} var_149 {
fn_17($var_4['var']['vars'] . "[$var_504]");
}
}
var_46();
var_267('text/html', $var_268);
if (isset($var_571) && $var_571 == 1) {
$var_574['html'] = var_576('
$banner['var_577'] = var_576('
}
$outputHtml = "<!DOCTYPE html PUBLIC '-
$var_578 .= "<html xmlns='http:
$var_578 .= "<var_579>\var_504";
$var_578 .= "<var_580>".(!empty($var_574['var_432']) ? $var_574['var_432'] : 'Advertisement')."</var_580>\var_504";
if (isset($var_572) && is_numeric($var_572) && $var_572 > 0) {
$var_403 = MAX_commonGetDeliveryUrl($var_4['var_41']['frame']).'?'.$_SERVER['var_581'];
parse_str($_SERVER['var_581'], $var_582);
$var_403 .= (!array_key_exists('loc', $var_582)) ? "&var_293=" . urlencode($var_293) : '';
$var_572 = (int)$var_572;
$var_583 = addcslashes(addcslashes($var_403, "\0..\37/\"\\"), "'\\");
$var_584 = htmlspecialchars($var_403, var_395);
$var_578 .= "
    <script type='text/javascript'><!--
        setTimeout('window.location.replace(\"{$var_583}\")', " . ($var_572 * 1000) . ");
    
    ";
}
if (isset($var_573) && $var_573 == 1) {
$var_585 = empty($var_574['width']) ? 0 : $var_574['width'];
$var_586 = empty($var_574['height']) ? 0 : $var_574['height'];
$var_578 .= "<script type='text/javascript'>\n";
$var_578 .= "<!--
$var_578 .= "\var_587 var_588(var_589) {\var_504";
$var_578 .= "\t\tif (document.all) {\n";
$var_578 .= "\t\t\tparent.document.all[frame.name].width = ".$var_585.";\n";
$var_578 .= "\t\t\tparent.document.all[frame.name].height = ".$var_586.";\n";
$var_578 .= "\t\t}\n";
$var_578 .= "\t\telse if (document.getElementById) {\n";
$var_578 .= "\t\t\tparent.document.getElementById(frame.name).width = ".$var_585.";\n";
$var_578 .= "\t\t\tparent.document.getElementById(frame.name).height = ".$var_586.";\n";
$var_578 .= "\t\t}\n";
$var_578 .= "\t}\n";
$var_578 .= "
$var_578 .= "</var_590>\var_504";
}
$var_578 .= "<var_413 var_20='text/css'>\var_504";
$var_578 .= "body {margin:0; height:100%; background-color:transparent; width:100%; text-align:center;}\n";
$var_578 .= "</style>\n";
$var_578 .= "</head>\n";
if (isset($var_573) && $var_573 == 1) {
$var_578 .= "<body onload=\"MAX_adjustframe(window);\">\n";
} var_149 {
$var_578 .= "<body>\n";
}
$var_578 .= $var_574['html'];
$var_578 .= "\n</body>\n";
$var_578 .= "</html>\n";

