<?php




class class_0
{
    const var_0 = 'NRM';
    const var_1 = 'HGH';
    const var_2 = 'LOW';

    const var_3 = 'MAI';
    const var_4 = 'TEL';
    const var_5 = 'PLA';
    const var_6 = 'PRE';

    const var_7 = 'NAT';
    const var_8 = 'PND';
    const var_9 = 'XCF';
    const var_10 = 'CLS';
    const var_11 = 'REE';

    
    public function fn_0()
    {
    }

    
    public static function fn_1($var_12, $var_13 = '')
    {
        $var_14 = Database::get_main_table(var_15);
        $var_16 = Database::get_main_table(var_17);

        $var_13 = empty($var_13) ? 'category.total_tickets DESC' : $var_13;
        $var_12 = (int) $var_12;

        $var_18 = "SELECT 
                    category.*, 
                    category.id category_id,
                    project.other_area, 
                    project.email
                FROM 
                $var_14 category 
                INNER JOIN $var_16 project
                ON project.id = category.project_id
                WHERE project.id  = $var_12
                ORDER BY $var_13";
        $var_19 = Database::query($var_18);
        $var_20 = [];
        while ($var_21 = Database::fetch_assoc($var_19)) {
            $var_20[] = $var_21;
        }

        return $var_20;
    }

    
    public static function fn_2($var_22, $var_23, $var_24, $var_25)
    {
        $var_26 = Database::get_main_table(var_15);
        $var_18 = "SELECT id, name, description, total_tickets
                FROM $var_26";

        if (!in_array($var_25, ['ASC', 'DESC'])) {
            $var_25 = 'ASC';
        }
        $var_24 = intval($var_24);
        $var_22 = intval($var_22);
        $var_23 = intval($var_23);

        
        $var_18 .= " LIMIT $var_22,$var_23";

        $var_19 = Database::query($var_18);
        $var_20 = [];
        while ($var_21 = Database::fetch_array($var_19)) {
            $var_20[] = $var_21;
        }

        return $var_20;
    }

    
    public static function fn_3($var_27)
    {
        $var_26 = Database::get_main_table(var_15);
        $var_27 = (int) $var_27;
        $var_18 = "SELECT id, name, description, total_tickets
                FROM $var_26 WHERE id = $var_27";

        $var_19 = Database::query($var_18);
        $var_28 = Database::fetch_array($var_19);

        return $var_28;
    }

    
    public static function fn_4()
    {
        $var_26 = Database::get_main_table(var_15);

        $var_18 = "SELECT count(id) count
                FROM $var_26 ";

        $var_19 = Database::query($var_18);
        $var_28 = Database::fetch_array($var_19);

        return $var_28['count'];
    }

    
    public static function fn_5($var_27, $var_29)
    {
        $var_26 = Database::get_main_table(var_15);
        $var_27 = (int) $var_27;
        Database::update($var_26, $var_29, ['id = ?' => $var_27]);
    }

    
    public static function fn_6($var_29)
    {
        $var_26 = Database::get_main_table(var_15);
        Database::insert($var_26, $var_29);
    }

    
    public static function fn_7($var_27)
    {
        $var_27 = intval($var_27);
        if (empty($var_27)) {
            return false;
        }

        $var_26 = Database::get_main_table(var_30);
        $var_18 = "UPDATE $var_26 SET category_id = NULL WHERE category_id = $var_27";
        Database::query($var_18);

        $var_26 = Database::get_main_table(var_15);
        $var_18 = "DELETE FROM $var_26 WHERE id = $var_27";
        Database::query($var_18);

        return true;
    }

    
    public static function fn_8($var_31, $var_32)
    {
        if (empty($var_32) || empty($var_31)) {
            return false;
        }

        $var_26 = Database::get_main_table(var_33);
        foreach ($var_32 as $var_34) {
            if (self::fn_9($var_34, $var_31) === false) {
                $var_29 = [
                    'category_id' => $var_31,
                    'user_id' => $var_34,
                ];
                Database::insert($var_26, $var_29);
            }
        }

        return true;
    }

    
    public static function fn_9($var_34, $var_31)
    {
        $var_26 = Database::get_main_table(var_33);
        $var_34 = (int) $var_34;
        $var_31 = (int) $var_31;
        $var_18 = "SELECT * FROM $var_26 
                WHERE category_id = $var_31 AND user_id = $var_34";
        $var_19 = Database::query($var_18);

        return Database::num_rows($var_19) > 0;
    }

    
    public static function fn_10($var_31)
    {
        $var_26 = Database::get_main_table(var_33);
        $var_31 = (int) $var_31;
        $var_18 = "SELECT * FROM $var_26 WHERE category_id = $var_31";
        $var_19 = Database::query($var_18);

        return Database::store_result($var_19);
    }

    
    public static function fn_11($var_31)
    {
        $var_26 = Database::get_main_table(var_33);
        $var_31 = (int) $var_31;
        $var_18 = "DELETE FROM $var_26 WHERE category_id = $var_31";
        Database::query($var_18);
    }

    
    public static function fn_12()
    {
        $var_26 = Database::get_main_table(var_35);
        $var_18 = "SELECT * FROM ".$var_26;
        $var_19 = Database::query($var_18);
        $var_20 = [];
        while ($var_21 = Database::fetch_assoc($var_19)) {
            $var_20[] = $var_21;
        }

        return $var_20;
    }

    
    public static function fn_13(
        $var_36,
        $var_37,
        $var_38,
        $var_39,
        $var_40,
        $var_41,
        $var_42,
        $var_43 = '',
        $var_44 = [],
        $var_45 = '',
        $var_46 = '',
        $var_47 = '',
        $var_48 = 0
    ) {
        $var_49 = Database::get_main_table(var_30);
        $var_14 = Database::get_main_table(var_15);

        if (empty($var_36)) {
            return false;
        }

        $var_50 = api_get_user_id();
        $var_51 = api_get_user_info();
        $var_52 = api_get_utc_datetime();
        $var_37 = (int) $var_37;
        $var_36 = (int) $var_36;
        $var_39 = (int) $var_39;
        $var_46 = empty($var_46) ? self::var_0 : (int) $var_46;

        if ($var_47 === '') {
            $var_47 = self::var_7;
            if ($var_40 > 0) {
                $var_47 = self::var_11;
            }
        }

        if (!empty($var_36)) {
            if (empty($var_48)) {
                $var_53 = self::fn_10($var_36);
                if (!empty($var_53) && count($var_53) > 0) {
                    $var_54 = $var_53[0];
                    if (isset($var_54['user_id'])) {
                        $var_48 = $var_54['user_id'];
                    }
                }
            }
        }

        $var_55 = [];
        if (!empty($var_48)) {
            $var_55 = api_get_user_info($var_48);
            if (empty($var_55)) {
                return false;
            }
        }

        
        $var_29 = [
            'project_id' => $var_39,
            'category_id' => $var_36,
            'priority_id' => $var_46,
            'personal_email' => $var_43,
            'status_id' => $var_47,
            'start_date' => $var_52,
            'sys_insert_user_id' => $var_50,
            'sys_insert_datetime' => $var_52,
            'sys_lastedit_user_id' => $var_50,
            'sys_lastedit_datetime' => $var_52,
            'source' => $var_45,
            'assigned_last_user' => $var_48,
            'subject' => $var_41,
            'message' => $var_42,
        ];

        if (!empty($var_37)) {
            $var_29['course_id'] = $var_37;
        }

        if (!empty($var_38)) {
            $var_29['session_id'] = $var_38;
        }
        $var_56 = Database::insert($var_49, $var_29);

        if ($var_56) {
            $var_57 = "A".str_pad($var_56, 11, '0', var_58);
            $var_59 = sprintf(
                get_lang('TicketXCreated'),
                $var_57
            );

            Display::addFlash(Display::return_message(
                $var_59,
                'normal',
                false
            ));

            if ($var_48 != 0) {
                self::fn_14(
                    $var_56,
                    $var_48
                );

                Display::addFlash(Display::return_message(
                    sprintf(
                        get_lang('TicketXAssignedToUserX'),
                        $var_57,
                        $var_55['complete_name']
                    ),
                    'normal',
                    false
                ));
            }

            if (!empty($var_44)) {
                $var_60 = 0;
                foreach ($var_44 as $var_61) {
                    if (!empty($var_61['tmp_name'])) {
                        $var_60++;
                    }
                }
                if ($var_60 > 0) {
                    self::fn_15(
                        $var_56,
                        '',
                        '',
                        $var_44,
                        $var_50
                    );
                }
            }

            
            $var_18 = "UPDATE $var_49
                    SET code = '$var_57'
                    WHERE id = '$var_56'";
            Database::query($var_18);

            
            $var_18 = "UPDATE $var_14
                    SET total_tickets = total_tickets + 1
                    WHERE id = $var_36";
            Database::query($var_18);

            $var_62 =
                '<table>
                        <tr>
                            <td width="100px"><b>'.get_lang('User').'</b></td>
                            <td width="400px">'.$var_51['complete_name'].'</td>
                        </tr>
                        <tr>
                            <td width="100px"><b>'.get_lang('Username').'</b></td>
                            <td width="400px">'.$var_51['username'].'</td>
                        </tr>
                        <tr>
                            <td width="100px"><b>'.get_lang('Email').'</b></td>
                            <td width="400px">'.$var_51['email'].'</td>
                        </tr>
                        <tr>
                            <td width="100px"><b>'.get_lang('Phone').'</b></td>
                            <td width="400px">'.$var_51['phone'].'</td>
                        </tr>
                        <tr>
                            <td width="100px"><b>'.get_lang('Date').'</b></td>
                            <td width="400px">'.api_convert_and_format_date($var_52, var_63).'</td>
                        </tr>
                        <tr>
                            <td width="100px"><b>'.get_lang('Title').'</b></td>
                            <td width="400px">'.Security::remove_XSS($var_41).'</td>
                        </tr>
                        <tr>
                            <td width="100px"><b>'.get_lang('Description').'</b></td>
                            <td width="400px">'.Security::remove_XSS($var_42).'</td>
                        </tr>
                    </table>';

            if ($var_48 != 0) {
                $var_64 = api_get_path(var_65).'/ticket/ticket_details.php?ticket_id='.$var_56;
                $var_62 .= sprintf(
                    get_lang('TicketAssignedToXCheckZAtLinkY'),
                    $var_55['complete_name'],
                    $var_64,
                    $var_56
                );
            }

            if (empty($var_36)) {
                if (api_get_setting('ticket_send_warning_to_all_admins') === 'true') {
                    $var_66 = sprintf(
                        get_lang('TicketXCreatedWithNoCategory'),
                        $var_57
                    );
                    Display::addFlash(Display::return_message($var_66));

                    $var_67 = UserManager::get_all_administrators();
                    foreach ($var_67 as $var_34 => $var_68) {
                        if ($var_68['active']) {
                            MessageManager::send_message_simple(
                                $var_34,
                                $var_66,
                                $var_62
                            );
                        }
                    }
                }
            } else {
                $var_69 = self::fn_3($var_36);
                $var_53 = self::fn_10($var_36);

                $var_70 = '<h2>'.get_lang('TicketInformation').'</h2><br />'.$var_62;

                if (api_get_setting('ticket_warn_admin_no_user_in_category') === 'true') {
                    $var_53 = self::fn_10($var_36);
                    if (empty($var_53)) {
                        $var_41 = sprintf(
                            get_lang('WarningCategoryXDoesntHaveUsers'),
                            $var_69['name']
                        );

                        if (api_get_setting('ticket_send_warning_to_all_admins') === 'true') {
                            Display::addFlash(Display::return_message(
                                sprintf(
                                    get_lang('CategoryWithNoUserNotificationSentToAdmins'),
                                    $var_69['name']
                                ),
                                null,
                                false
                            ));

                            $var_67 = UserManager::get_all_administrators();
                            foreach ($var_67 as $var_34 => $var_68) {
                                if ($var_68['active']) {
                                    self::fn_24(
                                        $var_56,
                                        $var_41,
                                        $var_70,
                                        $var_34
                                    );
                                }
                            }
                        } else {
                            Display::addFlash(Display::return_message($var_41));
                        }
                    }
                }

                
                if (!empty($var_53)) {
                    foreach ($var_53 as $var_68) {
                        if ($var_68['user_id']) {
                            self::fn_24(
                                $var_56,
                                $var_41,
                                $var_70,
                                $var_68['user_id']
                            );
                        }
                    }
                }
            }

            if (!empty($var_43)) {
                api_mail_html(
                    get_lang('VirtualSupport'),
                    $var_43,
                    get_lang('IncidentResentToVirtualSupport'),
                    $var_62
                );
            }

            self::fn_24(
                $var_56,
                $var_59,
                $var_62
            );

            return true;
        } else {
            return false;
        }
    }

    
    public static function fn_14(
        $var_56,
        $var_34
    ) {
        $var_56 = (int) $var_56;
        $var_34 = (int) $var_34;

        if (empty($var_56)) {
            return false;
        }

        $var_49 = Database::get_main_table(var_30);
        $var_71 = self::fn_22($var_56);

        if ($var_71) {
            $var_18 = "UPDATE $var_49
                    SET assigned_last_user = $var_34
                    WHERE id = $var_56";
            Database::query($var_18);

            $var_26 = Database::get_main_table(var_72);
            $var_29 = [
                'ticket_id' => $var_56,
                'user_id' => $var_34,
                'sys_insert_user_id' => api_get_user_id(),
                'assigned_date' => api_get_utc_datetime(),
            ];
            Database::insert($var_26, $var_29);

            return true;
        } else {
            return false;
        }
    }

    
    public static function fn_15(
        $var_56,
        $var_41,
        $var_42,
        $var_44,
        $var_34,
        $var_47 = 'NOL',
        $var_73 = false
    ) {
        $var_56 = (int) $var_56;
        $var_34 = (int) $var_34;
        $var_74 = Database::get_main_table(var_75);
        $var_49 = Database::get_main_table(var_30);
        if ($var_73) {
            $var_76 = '<form action="ticket_details.php?ticket_id='.$var_56.'" id="confirmticket" method="POST" >
                         <p>'.get_lang('TicketWasThisAnswerSatisfying').'</p>
                         <button class="btn btn-primary responseyes" name="response" id="responseyes" value="1">'.get_lang('Yes').'</button>
                         <button class="btn btn-danger responseno" name="response" id="responseno" value="0">'.get_lang('No').'</button>
                     </form>';
            $var_42 .= $var_76;
        }

        $var_52 = api_get_utc_datetime();

        $var_29 = [
            'ticket_id' => $var_56,
            'subject' => $var_41,
            'message' => $var_42,
            'ip_address' => api_get_real_ip(),
            'sys_insert_user_id' => $var_34,
            'sys_insert_datetime' => $var_52,
            'sys_lastedit_user_id' => $var_34,
            'sys_lastedit_datetime' => $var_52,
            'status' => $var_47,
        ];
        $var_77 = Database::insert($var_74, $var_29);
        if ($var_77) {
            
            $var_18 = "UPDATE $var_49
                    SET 
                        sys_lastedit_user_id = $var_34,
                        sys_lastedit_datetime = '$var_52',
                        total_messages = (
                            SELECT COUNT(*) as total_messages
                            FROM $var_74
                            WHERE ticket_id = $var_56
                        )
                    WHERE id = $var_56 ";
            Database::query($var_18);

            if (is_array($var_44)) {
                foreach ($var_44 as $var_78) {
                    if ($var_78['error'] == 0) {
                        self::fn_16(
                            $var_78,
                            $var_56,
                            $var_77
                        );
                    } else {
                        if ($var_78['error'] != var_79) {
                            return false;
                        }
                    }
                }
            }
        }

        return true;
    }

    
    public static function fn_16(
        $var_78,
        $var_56,
        $var_80
    ) {
        $var_52 = api_get_utc_datetime();
        $var_34 = api_get_user_id();
        $var_56 = intval($var_56);
        $var_81 = add_ext_on_mime(
            stripslashes($var_78['name']),
            $var_78['type']
        );
        $var_82 = Database::get_main_table(var_83);
        if (!filter_extension($var_81)) {
            
        } else {
            $var_19 = api_upload_file('ticket_attachment', $var_78, $var_56);
            if ($var_19) {
                $var_84 = Database::escape_string($var_81);
                $var_85 = Database::escape_string($var_19['path_to_save']);
                $var_18 = "INSERT INTO $var_82 (
                        filename,
                        path,
                        ticket_id,
                        message_id,
                        size,
                        sys_insert_user_id,
                        sys_insert_datetime,
                        sys_lastedit_user_id,
                        sys_lastedit_datetime
                    ) VALUES (
                        '$var_84',
                        '$var_85',
                        '$var_56',
                        '$var_80',
                        '".$var_78['size']."',
                        '$var_34',
                        '$var_52',
                        '$var_34',
                        '$var_52'
                    )";
                Database::query($var_18);

                return true;
            }
        }
    }

    
    public static function fn_17(
        $var_22,
        $var_86,
        $var_24,
        $var_25
    ) {
        $var_14 = Database::get_main_table(var_15);
        $var_49 = Database::get_main_table(var_30);
        $var_87 = Database::get_main_table(var_88);
        $var_89 = Database::get_main_table(var_35);
        $var_25 = !empty($var_25) ? $var_25 : 'DESC';
        $var_34 = api_get_user_id();
        $var_90 = api_get_user_info($var_34);

        if (empty($var_90)) {
            return [];
        }
        $var_91 = UserManager::is_admin($var_34);

        if (!isset($_GET['project_id'])) {
            return [];
        }

        switch ($var_24) {
            case 0:
                $var_24 = 'ticket_id';
                break;
            case 1:
                $var_24 = 'status_name';
                break;
            case 2:
                $var_24 = 'start_date';
                break;
            case 3:
                $var_24 = 'sys_lastedit_datetime';
                break;
            case 4:
                $var_24 = 'category_name';
                break;
            case 5:
                $var_24 = 'sys_insert_user_id';
                break;
            case 6:
                $var_24 = 'assigned_last_user';
                break;
            case 7:
                $var_24 = 'total_messages';
                break;
            case 8:
                $var_24 = 'subject';
                break;
            default:
                $var_24 = 'ticket_id';
        }

        $var_18 = "SELECT DISTINCT 
                ticket.*,
                ticket.id ticket_id,
                status.name AS status_name,
                ticket.start_date,
                ticket.sys_lastedit_datetime,
                cat.name AS category_name,
                priority.name AS priority_name,                           
                ticket.total_messages AS total_messages,
                ticket.message AS message,
                ticket.subject AS subject,
                ticket.assigned_last_user
            FROM $var_49 ticket 
            INNER JOIN $var_14 cat
            ON (cat.id = ticket.category_id)
            INNER JOIN $var_87 priority
            ON (ticket.priority_id = priority.id)
            INNER JOIN $var_89 status
            ON (ticket.status_id = status.id)
            WHERE 1=1                                
        ";

        $var_12 = (int) $_GET['project_id'];
        $var_92 = self::fn_18($var_90, $var_12);

        
        if ($var_92 == false) {
            $var_18 .= " AND (ticket.assigned_last_user = $var_34 OR ticket.sys_insert_user_id = $var_34 )";
        }

        
        if (isset($_GET['submit_simple']) && $_GET['keyword'] != '') {
            $var_93 = Database::escape_string(trim($_GET['keyword']));
            $var_18 .= " AND (
                      ticket.id LIKE '%$var_93%' OR
                      ticket.code LIKE '%$var_93%' OR
                      ticket.subject LIKE '%$var_93%' OR
                      ticket.message LIKE '%$var_93%' OR
                      ticket.keyword LIKE '%$var_93%' OR
                      ticket.source LIKE '%$var_93%' OR
                      cat.name LIKE '%$var_93%' OR
                      status.name LIKE '%$var_93%' OR
                      priority.name LIKE '%$var_93%' OR
                      ticket.personal_email LIKE '%$var_93%'                          
            )";
        }

        $var_94 = [
            'project_id' => 'ticket.project_id',
            'keyword_category' => 'ticket.category_id',
            'keyword_assigned_to' => 'ticket.assigned_last_user',
            'keyword_source' => 'ticket.source ',
            'keyword_status' => 'ticket.status_id',
            'keyword_priority' => 'ticket.priority_id',
        ];

        foreach ($var_94 as $var_93 => $var_95) {
            if (isset($_GET[$var_93])) {
                $var_68 = Database::escape_string(trim($_GET[$var_93]));
                if (!empty($var_68)) {
                    $var_18 .= " AND $var_95 = '$var_68' ";
                }
            }
        }

        
        $var_96 = isset($_GET['keyword_start_date_start']) ? Database::escape_string(trim($_GET['keyword_start_date_start'])) : '';
        $var_97 = isset($_GET['keyword_start_date_end']) ? Database::escape_string(trim($_GET['keyword_start_date_end'])) : '';
        $var_98 = isset($_GET['keyword_course']) ? Database::escape_string(trim($_GET['keyword_course'])) : '';
        $var_99 = !empty($var_96) && !empty($var_97);

        if ($var_99 == false && $var_96 != '') {
            $var_18 .= " AND DATE_FORMAT(ticket.start_date,'%d/%m/%Y') >= '$var_96' ";
        }
        if ($var_99 && $var_96 != '' && $var_97 != '') {
            $var_18 .= " AND DATE_FORMAT(ticket.start_date,'%d/%m/%Y') >= '$var_96'
                      AND DATE_FORMAT(ticket.start_date,'%d/%m/%Y') <= '$var_97'";
        }

        if ($var_98 != '') {
            $var_100 = Database::get_main_table(var_101);
            $var_18 .= " AND ticket.course_id IN ( 
                     SELECT id FROM $var_100
                     WHERE (
                        title LIKE '%$var_98%' OR 
                        code LIKE '%$var_98%' OR 
                        visual_code LIKE '%$var_98%'
                     )
            )";
        }
        $var_18 .= " ORDER BY $var_24 $var_25";
        $var_18 .= " LIMIT $var_22, $var_86";

        $var_19 = Database::query($var_18);
        $var_102 = [];
        $var_103 = api_get_path(var_104);
        while ($var_21 = Database::fetch_assoc($var_19)) {
            $var_90 = api_get_user_info($var_21['sys_insert_user_id']);
            $var_105 = $var_103.'main/admin/user_information.php?user_id='.$var_90['user_id'];
            $var_106 = "<a href='$var_105'> {$var_90['complete_name_with_username']} </a>";
            if ($var_21['assigned_last_user'] != 0) {
                $var_55 = api_get_user_info($var_21['assigned_last_user']);
                if (!empty($var_55)) {
                    $var_107 = $var_103.'main/admin/user_information.php?user_id='.$var_55['user_id'];
                    $var_21['assigned_last_user'] = "<a href='$var_107'> {$var_55['complete_name_with_username']} </a>";
                } else {
                    $var_21['assigned_last_user'] = get_lang('UnknownUser');
                }
            } else {
                if ($var_21['status_id'] !== self::var_11) {
                    $var_21['assigned_last_user'] = '<span style="color:
                } else {
                    $row['var_108'] = '<span style="color:
                }
            }

            switch ($row['var_45']) {
                var_110 var_111::var_6:
                    $var_109 = 'icons/32/user.png';
                    break;
                var_110 var_111::var_3:
                    $var_109 = 'icons/32/mail.png';
                    break;
                var_110 var_111::var_4:
                    $var_109 = 'icons/32/event.png';
                    break;
                var_112:
                    $var_109 = 'icons/32/ticket.png';
                    break;
            }

            $var_21['start_date'] = Display::dateToStringAgoAndLongDate($var_21['start_date']);
            $var_21['sys_lastedit_datetime'] = Display::dateToStringAgoAndLongDate($var_21['sys_lastedit_datetime']);

            $var_113 = Display::return_icon(
                $var_109,
                get_lang('Info'),
                ['style' => 'margin-right: 10px; float: left;']
            );

            $var_113 .= '<a href="ticket_details.php?ticket_id='.$var_21['id'].'">'.$var_21['code'].'</a>';

            if ($var_91) {
                $var_71 = [
                    $var_113.' '.$var_21['subject'],
                    $var_21['status_name'],
                    $var_21['start_date'],
                    $var_21['sys_lastedit_datetime'],
                    $var_21['category_name'],
                    $var_106,
                    $var_21['assigned_last_user'],
                    $var_21['total_messages'],
                ];
            } else {
                $var_71 = [
                    $var_113.' '.$var_21['subject'],
                    $var_21['status_name'],
                    $var_21['start_date'],
                    $var_21['sys_lastedit_datetime'],
                    $var_21['category_name'],
                ];
            }
            if ($var_91) {
                $var_71['0'] .= '&nbsp;&nbsp;<a  href="javascript:void(0)" onclick="load_history_ticket(\'div_'.$var_21['ticket_id'].'\','.$var_21['ticket_id'].')">
					<img onclick="load_course_list(\'div_'.$var_21['ticket_id'].'\','.$var_21['ticket_id'].')" onmouseover="clear_course_list (\'div_'.$var_21['ticket_id'].'\')" src="'.Display::returnIconPath('history.gif').'" title="'.get_lang('Historial').'" alt="'.get_lang('Historial').'"/>
					<div class="blackboard_hide" id="div_'.$var_21['ticket_id'].'">&nbsp;&nbsp;</div>
					</a>&nbsp;&nbsp;';
            }
            $var_102[] = $var_71;
        }

        return $var_102;
    }

    
    public static function fn_19()
    {
        $var_14 = Database::get_main_table(var_15);
        $var_49 = Database::get_main_table(var_30);
        $var_87 = Database::get_main_table(var_88);
        $var_89 = Database::get_main_table(var_35);

        $var_90 = api_get_user_info();
        if (empty($var_90)) {
            return 0;
        }
        $var_34 = $var_90['id'];

        if (!isset($_GET['project_id'])) {
            return 0;
        }

        $var_18 = "SELECT COUNT(ticket.id) AS total
                FROM $var_49 ticket
                INNER JOIN $var_14 cat
                ON (cat.id = ticket.category_id)
                INNER JOIN $var_87 priority
                ON (ticket.priority_id = priority.id)
                INNER JOIN $var_89 status
                ON (ticket.status_id = status.id)
	            WHERE 1 = 1";

        $var_12 = (int) $_GET['project_id'];
        $var_114 = self::fn_66($var_12);

        
        if (!empty($var_114) && is_array($var_114)) {
            if (!in_array($var_90['status'], $var_114)) {
                $var_18 .= " AND (ticket.assigned_last_user = $var_34 OR ticket.sys_insert_user_id = $var_34 )";
            }
        } else {
            if (!api_is_platform_admin()) {
                $var_18 .= " AND (ticket.assigned_last_user = $var_34 OR ticket.sys_insert_user_id = $var_34 )";
            }
        }

        
        if (isset($_GET['submit_simple'])) {
            if ($_GET['keyword'] != '') {
                $var_93 = Database::escape_string(trim($_GET['keyword']));
                $var_18 .= " AND (
                          ticket.code LIKE '%$var_93%' OR
                          ticket.subject LIKE '%$var_93%' OR
                          ticket.message LIKE '%$var_93%' OR
                          ticket.keyword LIKE '%$var_93%' OR
                          ticket.personal_email LIKE '%$var_93%' OR
                          ticket.source LIKE '%$var_93%'
                )";
            }
        }

        $var_94 = [
            'project_id' => 'ticket.project_id',
            'keyword_category' => 'ticket.category_id',
            'keyword_assigned_to' => 'ticket.assigned_last_user',
            'keyword_source' => 'ticket.source',
            'keyword_status' => 'ticket.status_id',
            'keyword_priority' => 'ticket.priority_id',
        ];

        foreach ($var_94 as $var_93 => $var_115) {
            if (isset($_GET[$var_93])) {
                $var_68 = Database::escape_string(trim($_GET[$var_93]));
                $var_18 .= " AND $var_115 = '$var_68' ";
            }
        }

        
        $var_96 = isset($_GET['keyword_start_date_start']) ? Database::escape_string(trim($_GET['keyword_start_date_start'])) : '';
        $var_97 = isset($_GET['keyword_start_date_end']) ? Database::escape_string(trim($_GET['keyword_start_date_end'])) : '';
        $var_99 = isset($_GET['keyword_dates']) ? Database::escape_string(trim($_GET['keyword_dates'])) : '';
        $var_98 = isset($_GET['keyword_course']) ? Database::escape_string(trim($_GET['keyword_course'])) : '';

        if ($var_99 == false && $var_96 != '') {
            $var_18 .= " AND DATE_FORMAT( ticket.start_date,'%d/%m/%Y') = '$var_96' ";
        }
        if ($var_99 && $var_96 != '' && $var_97 != '') {
            $var_18 .= " AND DATE_FORMAT( ticket.start_date,'%d/%m/%Y') >= '$var_96'
                      AND DATE_FORMAT( ticket.start_date,'%d/%m/%Y') <= '$var_97'";
        }
        if ($var_98 != '') {
            $var_100 = Database::get_main_table(var_101);
            $var_18 .= " AND ticket.course_id IN (  
                        SELECT id
                        FROM $var_100
                        WHERE (
                            title LIKE '%$var_98%' OR 
                            code LIKE '%$var_98%' OR 
                            visual_code LIKE '%$var_98%'
                        )
                   ) ";
        }

        $var_116 = Database::query($var_18);
        $var_117 = Database::fetch_object($var_116);

        return (int) $var_117->var_118;
    }

    
    public static function fn_20($var_27)
    {
        $var_27 = (int) $var_27;
        $var_119 = Database::getManager();
        $var_120 = $var_119->getRepository('ChamiloTicketBundle:MessageAttachment')->find($var_27);
        if ($var_120) {
            return $var_120;
        }

        return false;
    }

    
    public static function fn_21($var_27)
    {
        $var_27 = (int) $var_27;
        $var_119 = Database::getManager();
        $var_123 = $var_119->getRepository('ChamiloTicketBundle:MessageAttachment')->findBy(['ticket' => $var_27]);
        if ($var_123) {
            return $var_123;
        }

        return false;
    }

    
    public static function fn_22($var_56)
    {
        $var_56 = intval($var_56);
        $var_14 = Database::get_main_table(var_15);
        $var_49 = Database::get_main_table(var_30);
        $var_87 = Database::get_main_table(var_88);
        $var_89 = Database::get_main_table(var_35);
        $var_74 = Database::get_main_table(var_75);
        $var_82 = Database::get_main_table(var_83);
        $var_125 = Database::get_main_table(var_126);

        $var_18 = "SELECT
                    ticket.*, 
                    cat.name,
                    status.name as status, 
                    priority.name priority
                FROM $var_49 ticket
                INNER JOIN $var_14 cat
                ON (cat.id = ticket.category_id)
                INNER JOIN $var_87 priority
                ON (priority.id = ticket.priority_id)
                INNER JOIN $var_89 status
                ON (status.id = ticket.status_id)
		        WHERE
                    ticket.id = $var_56 ";
        $var_19 = Database::query($var_18);
        $var_71 = [];
        if (Database::num_rows($var_19) > 0) {
            while ($var_21 = Database::fetch_assoc($var_19)) {
                $var_21['course'] = null;
                $var_21['start_date_from_db'] = $var_21['start_date'];
                $var_21['start_date'] = api_convert_and_format_date(
                    api_get_local_time($var_21['start_date']),
                    var_63,
                    api_get_timezone()
                );
                $var_21['end_date_from_db'] = $var_21['end_date'];
                $var_21['end_date'] = api_convert_and_format_date(
                    api_get_local_time($var_21['end_date']),
                    var_63,
                    api_get_timezone()
                );
                $var_21['sys_lastedit_datetime_from_db'] = $var_21['sys_lastedit_datetime'];
                $var_21['sys_lastedit_datetime'] = api_convert_and_format_date(
                    api_get_local_time($var_21['sys_lastedit_datetime']),
                    var_63,
                    api_get_timezone()
                );
                $var_21['course_url'] = null;
                if ($var_21['course_id'] != 0) {
                    $var_127 = api_get_course_info_by_id($var_21['course_id']);
                    $var_38 = 0;
                    if ($var_21['session_id']) {
                        $var_38 = $var_21['session_id'];
                    }
                    if ($var_127) {
                        $var_21['course_url'] = '<a href="'.$var_127['course_public_url'].'?id_session='.$var_38.'">'.$var_127['name'].'</a>';
                    }
                }

                $var_90 = api_get_user_info($var_21['sys_insert_user_id']);
                $var_21['user_url'] = '<a href="'.api_get_path(var_104).'main/admin/user_information.php?user_id='.$var_90['user_id'].'">
                '.$var_90['complete_name'].'</a>';
                $var_71['usuario'] = $var_90;
                $var_71['ticket'] = $var_21;
            }

            $var_18 = "SELECT *, message.id as message_id 
                    FROM $var_74 message 
                    INNER JOIN $var_125 user
                    ON (message.sys_insert_user_id = user.user_id)
                    WHERE
                        message.ticket_id = '$var_56' ";
            $var_19 = Database::query($var_18);
            $var_71['messages'] = [];
            $var_128 = Display::return_icon('attachment.gif', '');
            $var_103 = api_get_path(var_65);
            while ($var_21 = Database::fetch_assoc($var_19)) {
                $var_70 = $var_21;
                $var_70['admin'] = UserManager::is_admin($var_70['user_id']);
                $var_70['user_info'] = api_get_user_info($var_70['user_id']);
                $var_18 = "SELECT *
                        FROM $var_82
                        WHERE
                            message_id = ".$var_21['message_id']." AND
                            ticket_id = $var_56";

                $var_129 = Database::query($var_18);
                while ($var_130 = Database::fetch_assoc($var_129)) {
                    $var_131 = $var_103.'ticket/download.php?ticket_id='.$var_56.'&id='.$var_130['id'];
                    $var_130['attachment_link'] = $var_128.'&nbsp;<a href="'.$var_131.'">'.$var_130['filename'].'</a>&nbsp;('.$var_130['size'].')';
                    $var_70['attachments'][] = $var_130;
                }
                $var_71['messages'][] = $var_70;
            }
        }

        return $var_71;
    }

    
    public static function fn_23($var_56, $var_34)
    {
        $var_56 = intval($var_56);
        $var_34 = intval($var_34);
        $var_74 = Database::get_main_table(
            var_75
        );
        $var_49 = Database::get_main_table(var_30);
        $var_52 = api_get_utc_datetime();
        $var_18 = "UPDATE $var_74
                SET
                    status = 'LEI',
                    sys_lastedit_user_id ='".api_get_user_id()."',
                    sys_lastedit_datetime ='".$var_52."'
                WHERE ticket_id ='$var_56' ";

        if (api_is_platform_admin()) {
            $var_18 .= " AND sys_insert_user_id = '$var_34'";
        } else {
            $var_18 .= " AND sys_insert_user_id != '$var_34'";
        }
        $var_19 = Database::query($var_18);
        if (Database::affected_rows($var_19) > 0) {
            Database::query(
                "UPDATE $var_49 SET
                    status_id = '".self::var_8."'
                 WHERE id ='$var_56' AND status_id = '".self::var_7."'"
            );

            return true;
        } else {
            return false;
        }
    }

    
    public static function fn_24($var_56, $var_132, $var_70, $var_133 = 0)
    {
        $var_134 = self::fn_22($var_56);

        if (empty($var_134)) {
            return false;
        }

        $var_55 = api_get_user_info($var_134['ticket']['assigned_last_user']);
        $var_135 = $var_134['usuario'];
        $var_136 = $var_134['ticket']['code'];
        $var_47 = $var_134['ticket']['status'];
        $var_46 = $var_134['ticket']['priority'];

        
        $var_137 = "[$var_136] $var_132";

        
        $var_64 = api_get_path(var_65).'/ticket/ticket_details.php?ticket_id='.$var_56;
        $var_138 = Display::url($var_136, $var_64);
        $var_139 = get_lang('TicketNum').": $var_138 <br />";
        $var_139 .= get_lang('Status').": $var_47 <br />";
        $var_139 .= get_lang('Priority').": $var_46 <br />";
        $var_139 .= '<hr /><br />';
        $var_139 .= $var_70;
        $var_50 = api_get_user_id();
        $var_140 = [];
        $var_141 = self::fn_21($var_56);
        if (!empty($var_141)) {
            
            foreach ($var_141 as $var_142) {
                $var_143 = api_get_uploaded_file(
                    'ticket_attachment',
                    $var_56,
                    $var_142->getPath()
                );
                if (!empty($var_143)) {
                    $var_140[] = [
                        'tmp_name' => api_get_uploaded_file(
                            'ticket_attachment',
                            $var_56,
                            $var_142->getPath()
                        ),
                        'size' => $var_142->getSize(),
                        'name' => $var_142->getFilename(),
                        'error' => 0,
                    ];
                }
            }
        }

        if (!empty($var_133)) {
            
            if ($var_50 != $var_133) {
                MessageManager::send_message_simple(
                    $var_133,
                    $var_137,
                    $var_139,
                    0,
                    false,
                    false,
                    [],
                    false,
                    $var_140
                );
            }
        } else {
            
            if ($var_135 && $var_50 != $var_135['id']) {
                MessageManager::send_message_simple(
                    $var_135['id'],
                    $var_137,
                    $var_139,
                    0,
                    false,
                    false,
                    [],
                    false,
                    $var_140
                );
            }

            if ($var_55 &&
                $var_135['id'] != $var_55['id'] &&
                $var_50 != $var_55['id']
            ) {
                MessageManager::send_message_simple(
                    $var_55['id'],
                    $var_137,
                    $var_139,
                    0,
                    false,
                    false,
                    [],
                    false,
                    $var_140
                );
            }
        }
    }

    
    public static function fn_25(
        $var_29,
        $var_56,
        $var_34
    ) {
        $var_52 = api_get_utc_datetime();
        $var_26 = Database::get_main_table(var_30);
        $var_147 = [
            'priority_id' => isset($var_29['priority_id']) ? (int) $var_29['priority_id'] : '',
            'status_id' => isset($var_29['status_id']) ? (int) $var_29['status_id'] : '',
            'sys_lastedit_user_id' => (int) $var_34,
            'sys_lastedit_datetime' => $var_52,
        ];
        Database::update($var_26, $var_147, ['id = ? ' => $var_56]);

        return true;
    }

    
    public static function fn_26(
        $var_148,
        $var_56,
        $var_34
    ) {
        $var_49 = Database::get_main_table(var_30);

        $var_56 = intval($var_56);
        $var_148 = intval($var_148);
        $var_34 = intval($var_34);

        $var_52 = api_get_utc_datetime();
        $var_18 = "UPDATE $var_49
                SET
                    status_id = '$var_148',
                    sys_lastedit_user_id ='$var_34',
                    sys_lastedit_datetime ='".$var_52."'
                WHERE id ='$var_56'";
        $var_19 = Database::query($var_18);

        if (Database::affected_rows($var_19) > 0) {
            self::fn_24(
                $var_56,
                get_lang('TicketUpdated'),
                get_lang('TicketUpdated')
            );

            return true;
        } else {
            return false;
        }
    }

    
    public static function fn_27()
    {
        $var_49 = Database::get_main_table(var_30);
        $var_74 = Database::get_main_table(
            var_75
        );
        $var_125 = Database::get_main_table(var_126);
        $var_149 = Database::get_main_table(var_150);
        $var_151 = api_get_user_info();
        $var_34 = $var_151['user_id'];
        $var_18 = "SELECT COUNT(DISTINCT ticket.id) AS unread
                FROM $var_49 ticket,
                $var_74 message ,
                $var_125 user
                WHERE
                    ticket.id = message.ticket_id AND
                    message.status = 'NOL' AND
                    user.user_id = message.sys_insert_user_id ";
        if (!api_is_platform_admin()) {
            $var_18 .= " AND ticket.request_user = '$var_34'
                      AND user_id IN (SELECT user_id FROM $var_149)  ";
        } else {
            $var_18 .= " AND user_id NOT IN (SELECT user_id FROM $var_149)
                      AND ticket.status_id != '".self::var_11."'";
        }
        $var_18 .= "  AND ticket.project_id != '' ";
        $var_116 = Database::query($var_18);
        $var_117 = Database::fetch_object($var_116);

        return $var_117->var_152;
    }

    
    public static function fn_28($var_56, $var_34)
    {
        $var_49 = Database::get_main_table(var_30);
        $var_52 = api_get_utc_datetime();

        $var_56 = (int) $var_56;
        $var_34 = (int) $var_34;

        $var_18 = "UPDATE $var_49 SET
                  priority_id = '".self::var_1."',
                  sys_lastedit_user_id = $var_34,
                  sys_lastedit_datetime = '$var_52'
                WHERE id = $var_56";
        Database::query($var_18);
    }

    
    public static function fn_29($var_56, $var_34)
    {
        $var_56 = intval($var_56);
        $var_34 = intval($var_34);

        $var_49 = Database::get_main_table(var_30);
        $var_52 = api_get_utc_datetime();
        $var_18 = "UPDATE $var_49 SET
                    status_id = '".self::var_10."',
                    sys_lastedit_user_id ='$var_34',
                    sys_lastedit_datetime ='".$var_52."',
                    end_date ='$var_52'
                WHERE id ='$var_56'";
        Database::query($var_18);

        self::fn_24(
            $var_56,
            get_lang('TicketClosed'),
            get_lang('TicketClosed')
        );
    }

    
    public static function fn_30()
    {
        $var_26 = Database::get_main_table(var_30);
        $var_52 = api_get_utc_datetime();
        $var_34 = api_get_user_id();
        $var_18 = "UPDATE $var_26
                SET
                    status_id = '".self::var_10."',
                    sys_lastedit_user_id ='$var_34',
                    sys_lastedit_datetime ='$var_52',
                    end_date = '$var_52'
                WHERE
                    DATEDIFF('$var_52', sys_lastedit_datetime) > 7 AND
                    status_id != '".self::var_10."' AND
                    status_id != '".self::var_7."' AND
                    status_id != '".self::var_11."'";
        Database::query($var_18);
    }

    
    public static function fn_31($var_56)
    {
        $var_26 = Database::get_main_table(var_72);
        $var_56 = intval($var_56);

        $var_18 = "SELECT * FROM $var_26
                WHERE ticket_id = $var_56
                ORDER BY assigned_date DESC";
        $var_19 = Database::query($var_18);
        $var_153 = [];
        $var_154 = api_get_path(var_104);
        while ($var_21 = Database::fetch_assoc($var_19)) {
            if ($var_21['user_id'] != 0) {
                $var_155 = api_get_user_info($var_21['user_id']);
                $var_21['assignuser'] = '<a href="'.$var_154.'main/admin/user_information.php?user_id='.$var_21['user_id'].'"  target="_blank">'.
                $var_155['username'].'</a>';
            } else {
                $var_21['assignuser'] = get_lang('Unassign');
            }
            $var_21['assigned_date'] = Display::dateToStringAgoAndLongDate($var_21['assigned_date']);
            $var_156 = api_get_user_info($var_21['sys_insert_user_id']);
            $var_21['insertuser'] = '<a href="'.$var_154.'main/admin/user_information.php?user_id='.$var_21['sys_insert_user_id'].'"  target="_blank">'.
                $var_156['username'].'</a>';
            $var_153[] = $var_21;
        }

        return $var_153;
    }

    
    public static function fn_32(
        $var_22,
        $var_86,
        $var_24,
        $var_25,
        $var_34 = null
    ) {
        $var_22 = intval($var_22);
        $var_86 = intval($var_86);
        $var_14 = Database::get_main_table(
            var_15
        );
        $var_49 = Database::get_main_table(var_30);
        $var_87 = Database::get_main_table(
            var_88
        );
        $var_89 = Database::get_main_table(var_35);
        $var_74 = Database::get_main_table(
            var_75
        );
        $var_125 = Database::get_main_table(var_126);

        if (is_null($var_25)) {
            $var_25 = "DESC";
        }
        if (is_null($var_34) || $var_34 == 0) {
            $var_34 = api_get_user_id();
        }

        $var_18 = "SELECT
                    ticket.code,
                    ticket.sys_insert_datetime,
                    ticket.sys_lastedit_datetime,
                    cat.name as category,
                    CONCAT(user.lastname,' ', user.firstname) AS fullname,
                    status.name as status,
                    ticket.total_messages as messages,
                    ticket.assigned_last_user as responsable
                FROM $var_49 ticket,
                $var_14 cat ,
                $var_87 priority,
                $var_89 status ,
                $var_125 user
                WHERE
                    cat.id = ticket.category_id
                    AND ticket.priority_id = priority.id
                    AND ticket.status_id = status.id
                    AND user.user_id = ticket.request_user ";
        
        if (isset($_GET['submit_simple'])) {
            if ($_GET['keyword'] !== '') {
                $var_93 = Database::escape_string(trim($_GET['keyword']));
                $var_18 .= " AND (ticket.code = '$var_93'
                          OR user.firstname LIKE '%$var_93%'
                          OR user.lastname LIKE '%$var_93%'
                          OR concat(user.firstname,' ',user.lastname) LIKE '%$var_93%'
                          OR concat(user.lastname,' ',user.firstname) LIKE '%$var_93%'
                          OR user.username LIKE '%$var_93%')  ";
            }
        }
        
        if (isset($_GET['submit_advanced'])) {
            $var_157 = Database::escape_string(
                trim($_GET['keyword_category'])
            );
            $var_158 = Database::escape_string(
                trim($_GET['keyword_request_user'])
            );
            $var_159 = (int) $_GET['keyword_assigned_to'];
            $var_96 = Database::escape_string(
                trim($_GET['keyword_start_date_start'])
            );
            $var_97 = Database::escape_string(
                trim($_GET['keyword_start_date_end'])
            );
            $var_160 = Database::escape_string(
                trim($_GET['keyword_status'])
            );
            $var_161 = Database::escape_string(
                trim($_GET['keyword_source'])
            );
            $var_162 = Database::escape_string(
                trim($_GET['keyword_priority'])
            );
            $var_99 = Database::escape_string(
                trim($_GET['keyword_dates'])
            );
            $var_163 = Database::escape_string(
                trim($_GET['keyword_unread'])
            );
            $var_98 = Database::escape_string(
                trim($_GET['keyword_course'])
            );

            if ($var_157 != '') {
                $var_18 .= " AND ticket.category_id = '$var_157'  ";
            }
            if ($var_158 != '') {
                $var_18 .= " AND (ticket.request_user = '$var_158'
                          OR user.firstname LIKE '%$var_158%'
                          OR user.official_code LIKE '%$var_158%'
                          OR user.lastname LIKE '%$var_158%'
                          OR concat(user.firstname,' ',user.lastname) LIKE '%$var_158%'
                          OR concat(user.lastname,' ',user.firstname) LIKE '%$var_158%'
                          OR user.username LIKE '%$var_158%') ";
            }
            if (!empty($var_159)) {
                $var_18 .= " AND ticket.assigned_last_user = $var_159 ";
            }
            if ($var_160 != '') {
                $var_18 .= " AND ticket.status_id = '$var_160'  ";
            }
            if ($var_99 == '' && $var_96 != '') {
                $var_18 .= " AND DATE_FORMAT( ticket.start_date,'%d/%m/%Y') = '$var_96' ";
            }
            if ($var_99 == '1' && $var_96 != '' && $var_97 != '') {
                $var_18 .= " AND DATE_FORMAT( ticket.start_date,'%d/%m/%Y') >= '$var_96'
                          AND DATE_FORMAT( ticket.start_date,'%d/%m/%Y') <= '$var_97'";
            }
            if ($var_162 != '') {
                $var_18 .= " AND ticket.priority_id = '$var_162'  ";
            }
            if ($var_161 != '') {
                $var_18 .= " AND ticket.source = '$var_161' ";
            }
            if ($var_162 != '') {
                $var_18 .= " AND ticket.priority_id = '$var_162' ";
            }
            if ($var_98 != '') {
                $var_100 = Database::get_main_table(var_101);
                $var_18 .= " AND ticket.course_id IN ( ";
                $var_18 .= "SELECT id
                         FROM $var_100
                         WHERE (title LIKE '%$var_98%'
                         OR code LIKE '%$var_98%'
                         OR visual_code LIKE '%$var_98%' )) ";
            }
            if ($var_163 == 'yes') {
                $var_18 .= " AND ticket.id IN (
                          SELECT ticket.id
                          FROM $var_49 ticket,
                          $var_74 message,
                          $var_125 user
                          WHERE ticket.id = message.ticket_id
                          AND message.status = 'NOL'
                          AND message.sys_insert_user_id = user.user_id
                          AND user.status != 1   AND ticket.status_id != '".self::var_11."'
                          GROUP BY ticket.id)";
            } else {
                if ($var_163 == 'no') {
                    $var_18 .= " AND ticket.id NOT IN (
                              SELECT ticket.id
                              FROM  $var_49 ticket,
                              $var_74 message,
                              $var_125 user
                              WHERE ticket.id = message.ticket_id
                              AND message.status = 'NOL'
                              AND message.sys_insert_user_id = user.user_id
                              AND user.status != 1
                              AND ticket.status_id != '".self::var_11."'
                             GROUP BY ticket.id)";
                }
            }
        }

        $var_18 .= " LIMIT $var_22,$var_86";

        $var_19 = Database::query($var_18);
        $var_102[0] = [
            utf8_decode('Ticket
            utf8_decode('var_164'),
            utf8_decode('Fecha Edicion'),
            utf8_decode('Categoria'),
            utf8_decode('Usuario'),
            utf8_decode('Estado'),
            utf8_decode('Mensajes'),
            utf8_decode('Responsable'),
            utf8_decode('Programa'),
        ];

        while ($var_21 = Database::fetch_assoc($var_19)) {
            if ($var_21['responsable'] != 0) {
                $var_21['responsable'] = api_get_user_info($var_21['responsable']);
                $var_21['responsable'] = $var_21['responsable']['firstname'].' '.$var_21['responsable']['lastname'];
            }
            $var_21['sys_insert_datetime'] = api_format_date(
                $var_21['sys_insert_datetime'],
                '%d/%m/%y - %I:%M:%S %p'
            );
            $var_21['sys_lastedit_datetime'] = api_format_date(
                $var_21['sys_lastedit_datetime'],
                '%d/%m/%y - %I:%M:%S %p'
            );
            $var_21['category'] = utf8_decode($var_21['category']);
            $var_21['programa'] = utf8_decode($var_21['fullname']);
            $var_21['fullname'] = utf8_decode($var_21['fullname']);
            $var_21['responsable'] = utf8_decode($var_21['responsable']);
            $var_102[] = $var_21;
        }

        return $var_102;
    }

    
    public static function fn_33($var_165, $var_12)
    {
        $var_76 = new class_1('category', 'post', $var_165);
        $var_76->addText('name', get_lang('Name'));
        $var_76->addHtmlEditor('description', get_lang('Description'));
        $var_76->addHidden('project_id', $var_12);
        $var_76->addButtonUpdate(get_lang('Save'));

        return $var_76;
    }

    
    public static function fn_34()
    {
        $var_123 = Database::getManager()->getRepository('ChamiloTicketBundle:Status')->findAll();

        $var_171 = [];
        
        foreach ($var_123 as $var_21) {
            $var_171[$var_21->getId()] = $var_21->getName();
        }

        return $var_171;
    }

    
    public static function fn_35($var_173)
    {
        $var_123 = Database::getManager()->getRepository('ChamiloTicketBundle:Ticket')->findBy($var_173);

        $var_171 = [];
        
        foreach ($var_123 as $var_21) {
            $var_171[$var_21->getId()] = $var_21->getCode();
        }

        return $var_171;
    }

    
    public static function fn_36($var_175)
    {
        $var_120 = Database::getManager()
            ->getRepository('ChamiloTicketBundle:Status')
            ->findOneBy(['code' => $var_175])
        ;
        if ($var_120) {
            return $var_120->getId();
        }

        return 0;
    }

    
    public static function fn_37()
    {
        $var_178 = Database::getManager()->getRepository('ChamiloTicketBundle:Priority')->findAll();

        $var_171 = [];
        
        foreach ($var_178 as $var_21) {
            $var_171[$var_21->getId()] = $var_21->getName();
        }

        return $var_171;
    }

    
    public static function fn_38()
    {
        $var_178 = Database::getManager()->getRepository('ChamiloTicketBundle:Project')->findAll();

        $var_171 = [];
        
        foreach ($var_178 as $var_21) {
            $var_171[] = [
                'id' => $var_21->getId(),
                '0' => $var_21->getId(),
                '1' => $var_21->getName(),
                '2' => $var_21->getDescription(),
                '3' => $var_21->getId(),
            ];
        }

        return $var_171;
    }

    
    public static function fn_39()
    {
        $var_178 = Database::getManager()->getRepository('ChamiloTicketBundle:Project')->findAll();

        $var_171 = [];
        
        foreach ($var_178 as $var_21) {
            $var_171[] = [
                'id' => $var_21->getId(),
                '0' => $var_21->getId(),
                '1' => Display::url(
                    $var_21->getName(),
                    api_get_path(var_65).'ticket/tickets.php?project_id='.$var_21->getId()
                ),
                '2' => $var_21->getDescription(),
            ];
        }

        return $var_171;
    }

    
    public static function fn_40()
    {
        $var_180 = Database::getManager()->getRepository('ChamiloTicketBundle:Project')->createQueryBuilder('p')
            ->select('COUNT(p.id)')
            ->getQuery()
            ->getSingleScalarResult();

        return $var_180;
    }

    
    public static function fn_41($var_29)
    {
        $var_185 = new class_2();
        $var_185->setName($var_29['name']);
        $var_185->setDescription($var_29['description']);
        $var_185->setInsertUserId(api_get_user_id());
        Database::getManager()->persist($var_185);
        Database::getManager()->flush();
    }

    
    public static function fn_42($var_27)
    {
        return Database::getManager()->getRepository('ChamiloTicketBundle:Project')->find($var_27);
    }

    
    public static function fn_43($var_27, $var_29)
    {
        $var_185 = self::fn_42($var_27);
        $var_185->setName($var_29['name']);
        $var_185->setDescription($var_29['description']);
        $var_185->setLastEditDateTime(new class_3($var_29['sys_lastedit_datetime']));
        $var_185->setLastEditUserId($var_29['sys_lastedit_user_id']);

        Database::getManager()->merge($var_185);
        Database::getManager()->flush();
    }

    
    public static function fn_44($var_27)
    {
        $var_185 = self::fn_42($var_27);
        if ($var_185) {
            Database::getManager()->remove($var_185);
            Database::getManager()->flush();
        }
    }

    
    public static function fn_45($var_165)
    {
        $var_76 = new class_1('project', 'post', $var_165);
        $var_76->addText('name', get_lang('Name'));
        $var_76->addHtmlEditor('description', get_lang('Description'));
        $var_76->addButtonUpdate(get_lang('Save'));

        return $var_76;
    }

    
    public static function fn_46()
    {
        $var_123 = Database::getManager()->getRepository('ChamiloTicketBundle:Status')->findAll();

        $var_171 = [];
        
        foreach ($var_123 as $var_21) {
            $var_171[] = [
                'id' => $var_21->getId(),
                'code' => $var_21->getCode(),
                '0' => $var_21->getId(),
                '1' => $var_21->getName(),
                '2' => $var_21->getDescription(),
                '3' => $var_21->getId(),
            ];
        }

        return $var_171;
    }

    
    public static function fn_47()
    {
        $var_178 = Database::getManager()->getRepository('ChamiloTicketBundle:Status')->findAll();

        $var_171 = [];
        
        foreach ($var_178 as $var_21) {
            $var_171[] = [
                'id' => $var_21->getId(),
                '0' => $var_21->getId(),
                '1' => Display::url($var_21->getName()),
                '2' => $var_21->getDescription(),
            ];
        }

        return $var_171;
    }

    
    public static function fn_48()
    {
        $var_180 = Database::getManager()->getRepository('ChamiloTicketBundle:Status')->createQueryBuilder('p')
            ->select('COUNT(p.id)')
            ->getQuery()
            ->getSingleScalarResult();

        return $var_180;
    }

    
    public static function fn_49($var_29)
    {
        $var_120 = new class_4();
        $var_120->setCode(URLify::filter($var_29['name']));
        $var_120->setName($var_29['name']);
        $var_120->setDescription($var_29['description']);

        Database::getManager()->persist($var_120);
        Database::getManager()->flush();
    }

    
    public static function fn_50($var_27)
    {
        return Database::getManager()->getRepository('ChamiloTicketBundle:Status')->find($var_27);
    }

    
    public static function fn_51($var_27, $var_29)
    {
        $var_120 = self::fn_50($var_27);
        $var_120->setName($var_29['name']);
        $var_120->setDescription($var_29['description']);

        Database::getManager()->merge($var_120);
        Database::getManager()->flush();
    }

    
    public static function fn_52($var_27)
    {
        $var_120 = self::fn_50($var_27);
        if ($var_120) {
            Database::getManager()->remove($var_120);
            Database::getManager()->flush();
        }
    }

    
    public static function fn_53($var_165)
    {
        $var_76 = new class_1('status', 'post', $var_165);
        $var_76->addText('name', get_lang('Name'));
        $var_76->addHtmlEditor('description', get_lang('Description'));
        $var_76->addButtonUpdate(get_lang('Save'));

        return $var_76;
    }

    
    public static function fn_54()
    {
        $var_123 = Database::getManager()->getRepository('ChamiloTicketBundle:Priority')->findAll();

        $var_171 = [];
        
        foreach ($var_123 as $var_21) {
            $var_171[] = [
                'id' => $var_21->getId(),
                'code' => $var_21->getCode(),
                '0' => $var_21->getId(),
                '1' => $var_21->getName(),
                '2' => $var_21->getDescription(),
                '3' => $var_21->getId(),
            ];
        }

        return $var_171;
    }

    
    public static function fn_55()
    {
        $var_178 = Database::getManager()->getRepository('ChamiloTicketBundle:Priority')->findAll();

        $var_171 = [];
        
        foreach ($var_178 as $var_21) {
            $var_171[] = [
                'id' => $var_21->getId(),
                '0' => $var_21->getId(),
                '1' => Display::url($var_21->getName()),
                '2' => $var_21->getDescription(),
            ];
        }

        return $var_171;
    }

    
    public static function fn_56()
    {
        $var_180 = Database::getManager()->getRepository('ChamiloTicketBundle:Priority')->createQueryBuilder('p')
            ->select('COUNT(p.id)')
            ->getQuery()
            ->getSingleScalarResult();

        return $var_180;
    }

    
    public static function fn_57($var_29)
    {
        $var_120 = new class_5();
        $var_120
            ->setCode(URLify::filter($var_29['name']))
            ->setName($var_29['name'])
            ->setDescription($var_29['description'])
            ->setColor('')
            ->setInsertUserId(api_get_user_id())
            ->setUrgency('')
        ;

        Database::getManager()->persist($var_120);
        Database::getManager()->flush();
    }

    
    public static function fn_58($var_27)
    {
        return Database::getManager()->getRepository('ChamiloTicketBundle:Priority')->find($var_27);
    }

    
    public static function fn_59($var_27, $var_29)
    {
        $var_120 = self::fn_58($var_27);
        $var_120->setName($var_29['name']);
        $var_120->setDescription($var_29['description']);

        Database::getManager()->merge($var_120);
        Database::getManager()->flush();
    }

    
    public static function fn_60($var_27)
    {
        $var_120 = self::fn_58($var_27);
        if ($var_120) {
            Database::getManager()->remove($var_120);
            Database::getManager()->flush();
        }
    }

    
    public static function fn_61($var_165)
    {
        $var_76 = new class_1('priority', 'post', $var_165);
        $var_76->addText('name', get_lang('Name'));
        $var_76->addHtmlEditor('description', get_lang('Description'));
        $var_76->addButtonUpdate(get_lang('Save'));

        return $var_76;
    }

    
    public static function fn_62($var_198 = null)
    {
        $var_123 = [];
        $var_185 = [
            'icon' => 'project.png',
            'url' => 'projects.php',
            'content' => get_lang('Projects'),
        ];
        $var_47 = [
            'icon' => 'check-circle.png',
            'url' => 'status.php',
            'content' => get_lang('Status'),
        ];
        $var_46 = [
            'icon' => 'tickets_urgent.png',
            'url' => 'priorities.php',
            'content' => get_lang('Priority'),
        ];
        switch ($var_198) {
            case 'project':
                $var_123 = [$var_47, $var_46];
                break;
            case 'status':
                $var_123 = [$var_185, $var_46];
                break;
            case 'priority':
                $var_123 = [$var_185, $var_47];
                break;
            default:
                $var_123 = [$var_185, $var_47, $var_46];
                break;
        }

        return $var_123;
    }

    
    public static function fn_63()
    {
        return [
            self::var_7,
            self::var_8,
            self::var_9,
            self::var_10,
            self::var_11,
        ];
    }

    
    public static function fn_64()
    {
        return [
            self::var_0,
            self::var_1,
            self::var_2,
            self::var_10,
            self::var_11,
        ];
    }

    
    public static function fn_65($var_34)
    {
        $var_34 = (int) $var_34;
        $var_199 = Database::getManager()->getConnection()->getSchemaManager();

        if ($var_199->tablesExist('ticket_assigned_log')) {
            $var_18 = "UPDATE ticket_assigned_log SET user_id = NULL WHERE user_id = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_assigned_log SET sys_insert_user_id = NULL WHERE sys_insert_user_id = $var_34";
            Database::query($var_18);
        }

        if ($var_199->tablesExist('ticket_ticket')) {
            $var_18 = "UPDATE ticket_ticket SET assigned_last_user = NULL WHERE assigned_last_user = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_ticket SET sys_insert_user_id = NULL WHERE sys_insert_user_id = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_ticket SET sys_lastedit_user_id = NULL WHERE sys_lastedit_user_id = $var_34";
            Database::query($var_18);
        }

        if ($var_199->tablesExist('ticket_category')) {
            $var_18 = "UPDATE ticket_category SET sys_insert_user_id = NULL WHERE sys_insert_user_id = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_category SET sys_lastedit_user_id = NULL WHERE sys_lastedit_user_id = $var_34";
            Database::query($var_18);
        }

        if ($var_199->tablesExist('ticket_category_rel_user')) {
            $var_18 = "DELETE FROM ticket_category_rel_user WHERE user_id = $var_34";
            Database::query($var_18);
        }

        if ($var_199->tablesExist('ticket_message')) {
            $var_18 = "UPDATE ticket_message SET sys_insert_user_id = NULL WHERE sys_insert_user_id = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_message SET sys_lastedit_user_id = NULL WHERE sys_lastedit_user_id = $var_34";
            Database::query($var_18);
        }

        if ($var_199->tablesExist('ticket_message_attachments')) {
            $var_18 = "UPDATE ticket_message_attachments SET sys_insert_user_id = NULL WHERE sys_insert_user_id = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_message_attachments SET sys_lastedit_user_id = NULL WHERE sys_lastedit_user_id = $var_34";
            Database::query($var_18);
        }

        if ($var_199->tablesExist('ticket_priority')) {
            $var_18 = "UPDATE ticket_priority SET sys_insert_user_id = NULL WHERE sys_insert_user_id = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_priority SET sys_lastedit_user_id = NULL WHERE sys_lastedit_user_id = $var_34";
            Database::query($var_18);
        }

        if ($var_199->tablesExist('ticket_project')) {
            $var_18 = "UPDATE ticket_project SET sys_insert_user_id = NULL WHERE sys_insert_user_id = $var_34";
            Database::query($var_18);

            $var_18 = "UPDATE ticket_project SET sys_lastedit_user_id = NULL WHERE sys_lastedit_user_id = $var_34";
            Database::query($var_18);
        }
    }

    
    public static function fn_18($var_90, $var_12)
    {
        if (api_is_platform_admin()) {
            return true;
        }

        $var_114 = self::fn_66($var_12);

        
        
        if (!empty($var_114) && is_array($var_114)) {
            if (in_array($var_90['status'], $var_114)) {
                return true;
            }
        }

        return false;
    }

    
    public static function fn_66($var_12)
    {
        $var_203 = api_get_configuration_value('ticket_project_user_roles');
        if ($var_203) {
            if (isset($var_203['permissions'][$var_12])) {
                return $var_203['permissions'][$var_12];
            }
        }

        return [];
    }
}
